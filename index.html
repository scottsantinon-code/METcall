<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f5f5f7">
    <meta name="color-scheme" content="light">
    <title>METmate</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23ff453a'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white'>M</text></svg>">
    
    <style>
        :root {
            --bg: #f5f5f7;
            --card: rgba(0,0,0,0.03);
            --border: rgba(0,0,0,0.08);
            --text: #1d1d1f;
            --text2: rgba(0,0,0,0.55);
            --text3: rgba(0,0,0,0.35);
            --red: #ff3b30;
            --orange: #ff9500;
            --green: #34c759;
            --blue: #007aff;
            --yellow: #ffcc00;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, sans-serif;
            background-color: #f5f5f7;
            color: var(--text);
            height: 100%;
            -webkit-font-smoothing: antialiased;
            font-size: 14px;
        }
        body { 
            height: 100%;
            overflow: hidden;
            padding-top: env(safe-area-inset-top);
            padding-top: constant(safe-area-inset-top);
            background-color: #f5f5f7;
        }
        .app { 
            height: 100%;
            display: flex; 
            flex-direction: column; 
            background-color: #f5f5f7;
        }
        .page { display:none; flex:1; flex-direction:column; overflow:hidden; max-width:500px; margin:0 auto; width:100%; background-color:#f5f5f7; }
        .page.active { display:flex; }

        .header {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
            background-color: #f5f5f7;
        }
        .header-left { display:flex; align-items:center; gap:10px; }
        .header-right { display:flex; align-items:center; }
        .back-btn { background:none; border:none; color:var(--blue); font-size:15px; cursor:pointer; padding:4px 0; }
        .home-btn { background:none; border:none; color:var(--red); font-size:13px; cursor:pointer; padding:4px 8px; display:flex; align-items:center; gap:4px; }
        .home-btn svg { width:16px; height:16px; }
        .header-title { font-size:15px; font-weight:600; }

        .content { flex:1; overflow-y:auto; padding:16px; background-color:#f5f5f7; }

        .page-title { font-size: 22px; font-weight: 700; margin-bottom: 16px; }
        .section-title { font-size: 11px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin: 16px 0 8px; }
        .section-title:first-child { margin-top: 0; }
        .section-label { font-size: 11px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }

        /* Home */
        .home-header { text-align:center; padding:40px 0 12px; }
        .home-logo {
            width:56px; height:56px;
            background: linear-gradient(135deg, var(--red), #ff6b6b);
            border-radius: 16px;
            display: flex; align-items:center; justify-content:center;
            margin: 0 auto 14px;
            box-shadow: 0 6px 24px rgba(255,59,48,0.25);
        }
        .home-logo svg { width:28px; height:28px; }
        .home-title { font-size:28px; font-weight:700; letter-spacing:-0.5px; }
        .beta-badge { display:inline-block; background:var(--orange); color:#fff; font-size:10px; font-weight:600; padding:2px 8px; border-radius:4px; margin-left:8px; vertical-align:middle; letter-spacing:0.5px; }
        .beta-disclaimer { font-size:12px; color:var(--text3); text-align:center; margin:8px 0 16px 0; line-height:1.4; }
        .trigger-list { display:flex; flex-direction:column; }
        .trigger-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .trigger-card:active { transform:scale(0.98); background:#f9f9f9; }
        .trigger-icon {
            width:44px; height:44px;
            background: rgba(255,59,48,0.08);
            border-radius: 12px;
            display:flex; align-items:center; justify-content:center;
            flex-shrink: 0;
        }
        .trigger-icon svg { width:24px; height:24px; color:var(--red); }
        .coming-soon .trigger-icon svg { stroke-width:2; }
        .trigger-icon img { width:28px; height:28px; object-fit:contain; }
        .trigger-name { font-size:15px; font-weight:600; line-height:1.3; flex:1; }
        .trigger-arrow { font-size:18px; color:var(--text3); }
        .coming-soon { opacity:0.4; pointer-events:none; }
        .soon-badge { font-size:9px; background:var(--card); padding:2px 6px; border-radius:4px; color:var(--text3); text-transform:uppercase; margin-left:8px; }

        /* Choice buttons */
        .choice-container { display:flex; gap:12px; padding-top:4px; }
        .choice-btn {
            flex: 1;
            padding: 20px 12px;
            border-radius: 14px;
            border: 2px solid var(--border);
            background: #fff;
            cursor: pointer;
            text-align: center;
        }
        .choice-btn:active { transform:scale(0.98); }
        .choice-btn.red { border-color: rgba(255,59,48,0.4); background: rgba(255,59,48,0.06); }
        .choice-btn.green { border-color: rgba(52,199,89,0.4); background: rgba(52,199,89,0.06); }
        .choice-btn.primary-choice { border-color: rgba(0,122,255,0.4); background: rgba(0,122,255,0.06); }
        .choice-title { font-size:18px; font-weight:700; margin-bottom:4px; }
        .choice-btn.red .choice-title { color: var(--red); }
        .choice-btn.green .choice-title { color: var(--green); }
        .choice-btn.primary-choice .choice-title { color: var(--blue); }
        .choice-sub { font-size:12px; color:var(--text2); }

        .page-subtitle {
            font-size: 13px;
            color: var(--text2);
            margin-top: -8px;
            margin-bottom: 16px;
        }

        /* Code Blue box */
        .code-blue-box {
            background: rgba(255,59,48,0.08);
            border: 2px solid var(--red);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .code-blue-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--red);
            margin-bottom: 10px;
        }
        .code-blue-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .code-blue-item {
            font-size: 14px;
            color: var(--text);
            padding-left: 16px;
            position: relative;
        }
        .code-blue-item::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--red);
            font-weight: bold;
        }
        .code-blue-action {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,59,48,0.2);
            font-size: 13px;
            color: var(--text2);
            font-style: italic;
        }
        .consider-cxr-box {
            background: rgba(0,122,255,0.08);
            border: 1px solid rgba(0,122,255,0.25);
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 14px;
            color: var(--text);
            margin-top: 14px;
            margin-bottom: 24px;
        }

        /* Gate buttons */
        .gate-buttons {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .gate-btn {
            flex: 1;
            padding: 14px 16px;
            font-size: 15px;
            font-weight: 600;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
        }

        .gate-btn:active {
            transform: scale(0.98);
        }

        .gate-btn.primary {
            background: var(--blue);
            color: #fff;
        }

        .gate-btn.warning {
            background: rgba(255, 149, 0, 0.15);
            color: #c45500;
            border: 1px solid rgba(255, 149, 0, 0.3);
        }

        /* Wizard progress bar */
        .wizard-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 0 8px;
        }

        .wizard-progress-step {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--text3);
            position: relative;
        }

        .wizard-progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 100%;
            top: 50%;
            width: calc(100% - 32px);
            height: 2px;
            background: var(--border);
            transform: translateY(-50%);
        }

        .wizard-progress-step.completed {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }

        .wizard-progress-step.completed::after {
            background: var(--blue);
        }

        .wizard-progress-step.active {
            border-color: var(--blue);
            color: var(--blue);
            background: rgba(0,122,255,0.1);
        }

        .wizard-progress-step.escalate {
            border-color: #ff9500;
            color: #ff9500;
            background: rgba(255,149,0,0.1);
        }

        /* Wizard question box */
        .wizard-question-box {
            text-align: center;
            padding: 24px;
            background: rgba(255,149,0,0.08);
            border: 1px solid rgba(255,149,0,0.2);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .wizard-question-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .wizard-question-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .wizard-question-hint {
            font-size: 14px;
            color: var(--text2);
        }

        /* Wizard options */
        .wizard-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .wizard-option {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
        }

        .wizard-option:active {
            transform: scale(0.98);
        }

        .wizard-option.primary {
            background: var(--blue);
            border-color: var(--blue);
        }

        .wizard-option.primary .wizard-option-title,
        .wizard-option.primary .wizard-option-hint {
            color: #fff;
        }

        .wizard-option.muted {
            background: var(--card-bg);
        }

        .wizard-option-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .wizard-option-hint {
            font-size: 13px;
            color: var(--text3);
            margin-top: 2px;
        }

        /* Wizard step card */
        .wizard-step-card {
            display: flex;
            gap: 16px;
            padding: 20px;
            background: #fff;
            border: 2px solid var(--blue);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .wizard-step-num {
            width: 40px;
            height: 40px;
            background: var(--blue);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .wizard-step-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }

        .wizard-step-hint {
            font-size: 14px;
            color: var(--text2);
            margin-top: 4px;
        }

        /* Wizard decision */
        .wizard-decision {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
        }

        .wizard-decision-question {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            text-align: center;
            margin-bottom: 16px;
        }

        .wizard-decision-buttons {
            display: flex;
            gap: 12px;
        }

        .wizard-decision-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
        }

        .wizard-decision-btn:active {
            transform: scale(0.97);
        }

        .wizard-decision-btn.success {
            background: rgba(52,199,89,0.15);
            color: #34c759;
        }

        .wizard-decision-btn.continue {
            background: rgba(0,122,255,0.1);
            color: var(--blue);
        }

        .wizard-decision-btn.escalate {
            background: rgba(255,149,0,0.15);
            color: #ff9500;
        }

        .wizard-btn-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .wizard-btn-text {
            font-size: 14px;
            font-weight: 600;
        }

        /* Wizard success box */
        .wizard-success-box {
            text-align: center;
            padding: 24px;
            background: rgba(52,199,89,0.1);
            border: 2px solid rgba(52,199,89,0.3);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .wizard-success-box.large {
            padding: 40px 24px;
        }

        .wizard-success-icon {
            width: 48px;
            height: 48px;
            background: #34c759;
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 16px;
        }

        .wizard-success-title {
            font-size: 20px;
            font-weight: 700;
            color: #34c759;
        }

        .wizard-success-hint {
            font-size: 14px;
            color: var(--text2);
            margin-top: 8px;
        }

        /* Wizard escalate box */
        .wizard-escalate-box {
            text-align: center;
            padding: 24px;
            background: rgba(255,59,48,0.1);
            border: 2px solid rgba(255,59,48,0.3);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .wizard-escalate-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .wizard-escalate-title {
            font-size: 16px;
            color: var(--text2);
            margin-bottom: 8px;
        }

        .wizard-escalate-action {
            font-size: 22px;
            font-weight: 700;
            color: #ff3b30;
        }

        /* Wizard plans */
        .wizard-plans {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .wizard-plan-card {
            padding: 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .wizard-plan-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--blue);
            margin-bottom: 4px;
        }

        .wizard-plan-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }

        .wizard-plan-hint {
            font-size: 13px;
            color: var(--text2);
            margin-top: 4px;
        }

        /* Wizard checklist */
        .wizard-checklist {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .wizard-check-item {
            padding: 10px 0;
            font-size: 14px;
            color: var(--text2);
            border-bottom: 1px solid var(--border);
        }

        .wizard-check-item:last-child {
            border-bottom: none;
        }

        /* Wizard action cards */
        .wizard-action-card {
            display: flex;
            gap: 12px;
            padding: 14px 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .wizard-action-card.escalate {
            border-color: rgba(255,149,0,0.5);
            background: rgba(255,149,0,0.05);
        }

        .wizard-action-num {
            width: 24px;
            height: 24px;
            background: var(--blue);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .wizard-action-content {
            flex: 1;
        }

        .wizard-action-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .wizard-action-hint {
            font-size: 13px;
            color: var(--text2);
            margin-top: 2px;
        }

        /* Wizard next steps */
        .wizard-next-steps {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .wizard-next-item {
            padding: 10px 0;
            font-size: 14px;
            color: var(--text2);
            border-bottom: 1px solid var(--border);
            padding-left: 20px;
            position: relative;
        }

        .wizard-next-item::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--blue);
        }

        .wizard-next-item:last-child {
            border-bottom: none;
        }

        /* Wizard prompt */
        .wizard-prompt {
            text-align: center;
            padding: 16px;
            background: var(--card-bg);
            border-radius: 12px;
            margin-top: 20px;
        }

        .wizard-prompt-text {
            font-size: 14px;
            color: var(--text2);
        }

        /* O2 modal improvements */
        .o2-modal {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .o2-device-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
        }

        .o2-device-card.highlight {
            background: rgba(0,122,255,0.06);
            border: 1px solid rgba(0,122,255,0.15);
        }

        .o2-device-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 10px;
        }

        .o2-device-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .o2-device-fio2 {
            font-size: 14px;
            font-weight: 600;
            color: var(--blue);
        }

        .o2-device-table {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .o2-device-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
        }

        .o2-device-row:last-child {
            border-bottom: none;
        }

        .o2-flow {
            font-size: 14px;
            color: var(--text2);
        }

        .o2-percent {
            font-size: 14px;
            font-weight: 600;
            color: var(--blue);
        }

        .o2-device-note {
            font-size: 12px;
            color: var(--text3);
            font-style: italic;
        }

        .o2-device-body {
            font-size: 14px;
            color: var(--text2);
            line-height: 1.5;
        }

        .choice-container.compact {
            padding-top: 0;
        }
        .choice-container.compact .choice-btn {
            flex: none;
            padding: 12px 24px;
            border-radius: 10px;
        }
        .choice-container.compact .choice-title {
            font-size: 15px;
            margin-bottom: 0;
        }

        /* Management list */
        .mgmt-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .mgmt-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
        }
        .mgmt-item:active { background: var(--card); }
        .mgmt-num {
            width: 24px;
            height: 24px;
            background: var(--blue);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .mgmt-text { flex: 1; }
        .mgmt-text strong { font-size: 14px; display: block; margin-bottom: 2px; }
        .mgmt-sub { font-size: 12px; color: var(--text2); }
        .mgmt-arrow { color: var(--text3); font-size: 18px; }

        /* Calc link */
        .calc-link {
            font-size: 13px;
            color: var(--blue);
            margin-top: 16px;
            cursor: pointer;
            text-align: center;
        }
        .calc-link:active { opacity: 0.7; }

        /* O2 targets */
        .o2-target-card {
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .o2-target-card.default {
            background: rgba(52,199,89,0.1);
            border: 1px solid rgba(52,199,89,0.3);
        }
        .o2-target-card.caution {
            background: rgba(255,149,0,0.1);
            border: 1px solid rgba(255,149,0,0.3);
        }
        .o2-target-card.high {
            background: rgba(0,122,255,0.1);
            border: 1px solid rgba(0,122,255,0.3);
        }
        .o2-target-card.expandable {
            cursor: pointer;
        }
        .o2-target-card.expandable .o2-target-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .o2-target-card.expandable .cause-arrow {
            color: var(--text3);
            font-size: 12px;
            transition: transform 0.2s;
            margin-top: 4px;
        }
        .o2-target-card.expandable.open .cause-arrow {
            transform: rotate(180deg);
        }
        .o2-target-expand {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,149,0,0.3);
        }
        .o2-target-card.expandable.open .o2-target-expand {
            display: block;
        }
        .hypercapnia-alert-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 10px;
        }
        .hypercapnia-alert-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .hypercapnia-alert-item {
            font-size: 12px;
            color: var(--text);
            line-height: 1.4;
        }

        /* Clinical choice cards */
        .clinical-choice-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .clinical-choice-card:active {
            background: var(--card);
        }
        .clinical-choice-content {
            flex: 1;
        }
        .clinical-choice-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }
        .clinical-choice-hint {
            font-size: 12px;
            color: var(--text2);
            margin-top: 2px;
        }
        .clinical-choice-card .trigger-arrow {
            color: var(--text3);
            font-size: 20px;
            margin-left: 12px;
        }

        /* All DDx link */
        .all-ddx-link {
            font-size: 13px;
            color: var(--text2);
            text-align: center;
            margin-top: 20px;
            cursor: pointer;
        }
        .all-ddx-link:active {
            color: var(--blue);
        }

        /* Action box */
        .action-box {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 14px;
        }
        .action-box.urgent {
            border-color: rgba(255,59,48,0.3);
            background: rgba(255,59,48,0.04);
        }
        .action-box-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 10px;
        }
        .action-box.urgent .action-box-title {
            color: var(--red);
        }
        .action-box-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .action-box-item {
            font-size: 13px;
            color: var(--text);
            line-height: 1.4;
            padding-left: 12px;
            position: relative;
        }
        .action-box-item::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--text3);
        }
        .action-box.urgent .action-box-item::before {
            color: var(--red);
        }

        /* Consider box */
        .consider-box {
            margin-bottom: 14px;
        }
        .consider-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 10px;
        }
        .consider-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .consider-item {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
        }
        .consider-item.highlight {
            border-color: rgba(255,149,0,0.4);
            background: rgba(255,149,0,0.06);
        }
        .consider-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }
        .consider-item-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        .consider-item-clues {
            font-size: 12px;
            color: var(--text2);
            margin-top: 6px;
            line-height: 1.4;
        }
        .o2-target-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text);
        }
        .o2-target-label {
            font-size: 14px;
            color: var(--text);
            margin-top: 4px;
        }
        .o2-target-examples {
            font-size: 12px;
            color: var(--text2);
            margin-top: 4px;
        }
        .o2-ref-note {
            font-size: 11px;
            color: var(--text3);
            margin-top: 12px;
            font-style: italic;
        }
        .o2-note {
            font-size: 13px;
            color: var(--text);
            padding: 12px;
            background: var(--card);
            border-radius: 8px;
            margin-top: 12px;
        }
        .o2-guidance {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .o2-guidance-item {
            font-size: 13px;
            color: var(--text2);
            padding: 10px 12px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        .o2-guidance-item.highlight {
            background: rgba(255,149,0,0.08);
            border-color: rgba(255,149,0,0.3);
            color: var(--text);
        }

        /* O2 device cards */
        .o2-device-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        .o2-device-header {
            padding: 12px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .o2-device-header:active { background: var(--card); }
        .o2-device-title {
            font-size: 14px;
            font-weight: 600;
            flex: 1;
        }
        .o2-device-fio2 {
            font-size: 12px;
            color: var(--blue);
            font-weight: 500;
        }
        .o2-device-body {
            display: none;
            padding: 12px 14px;
            border-top: 1px solid var(--border);
            background: var(--card);
        }
        .o2-device-card.open .o2-device-body { display: block; }
        .o2-device-card.open .cause-arrow { transform: rotate(180deg); }
        .o2-device-table {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .o2-device-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 6px 10px;
            background: #fff;
            border-radius: 4px;
        }
        .o2-device-row span:last-child {
            font-weight: 600;
            color: var(--blue);
        }
        .o2-device-note {
            font-size: 11px;
            color: var(--text2);
            margin-top: 8px;
            font-style: italic;
        }
        .o2-device-desc {
            font-size: 13px;
            color: var(--text2);
            line-height: 1.4;
        }
        .o2-device-benefits {
            margin-top: 10px;
        }
        .o2-benefit-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
        }
        .o2-benefit-item {
            font-size: 12px;
            color: var(--text2);
            padding: 6px 10px;
            background: #fff;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        /* O2 Category Cards */
        .o2-category-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .o2-category-header {
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        .o2-category-header:active { background: var(--card); }
        .o2-category-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }
        .o2-category-body {
            display: none;
            padding: 0 14px 14px;
        }
        .o2-category-card.open .o2-category-body { display: block; }
        .o2-category-card.open .cause-arrow { transform: rotate(180deg); }
        .o2-device-nested {
            background: var(--card);
            border-radius: 10px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        .o2-device-nested:last-child { margin-bottom: 0; }
        .o2-device-nested-header {
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        .o2-device-nested-header:active { background: #e5e5e5; }
        .o2-device-nested-left { flex: 1; }
        .o2-device-nested-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        .o2-device-nested-fio2 {
            font-size: 12px;
            color: var(--blue);
            font-weight: 500;
            margin-top: 2px;
        }
        .o2-device-nested-body {
            display: none;
            padding: 0 12px 12px;
        }
        .o2-device-nested.open .o2-device-nested-body { display: block; }
        .o2-device-nested .device-arrow {
            font-size: 10px;
            color: var(--text3);
            transition: transform 0.2s;
        }
        .o2-device-nested.open .device-arrow { transform: rotate(180deg); }

        /* Calculator styles */
        .calc-section {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .calc-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        .calc-desc {
            font-size: 12px;
            color: var(--text2);
            margin-bottom: 12px;
        }
        .calc-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }
        .calc-input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .calc-input-group label {
            font-size: 11px;
            color: var(--text2);
            font-weight: 500;
        }
        .calc-input-group input {
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }
        .calc-input-group input:focus {
            outline: none;
            border-color: var(--blue);
        }
        .calc-result {
            padding: 12px;
            background: var(--card);
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            min-height: 24px;
        }
        .calc-result.normal { color: var(--green); }
        .calc-result.impaired { color: #f0ad4e; }
        .calc-result.mild { color: var(--orange); }
        .calc-result.moderate { color: #e64c3c; }
        .calc-result.severe { color: var(--red); }
        .calc-interp {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 10px;
        }
        .calc-interp-item {
            font-size: 11px;
            color: var(--text2);
            padding: 6px 8px;
            background: var(--card);
            border-radius: 4px;
        }
        .calc-note {
            font-size: 12px;
            color: var(--text2);
            margin-top: 10px;
            font-style: italic;
        }

        /* Hypercapnia modal */
        .hypercapnia-warning {
            background: rgba(255,149,0,0.1);
            border: 1px solid rgba(255,149,0,0.3);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .hypercapnia-warning ul {
            margin: 8px 0 0 20px;
            padding: 0;
        }
        .hypercapnia-warning li {
            font-size: 13px;
            color: var(--text);
            margin-bottom: 4px;
        }
        .hypercapnia-section { margin-top: 12px; }
        .hypercapnia-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }
        .hypercapnia-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .hypercapnia-item {
            font-size: 13px;
            color: var(--text2);
            padding: 10px;
            background: var(--card);
            border-radius: 6px;
        }

        /* Hyperoxia modal */
        .hyperoxia-intro {
            font-size: 14px;
            color: var(--text);
            margin-bottom: 12px;
            line-height: 1.5;
        }
        .hyperoxia-section { margin-top: 12px; }
        .hyperoxia-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }
        .hyperoxia-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .hyperoxia-item {
            font-size: 13px;
            color: var(--text2);
            padding: 8px 10px;
            background: var(--card);
            border-radius: 6px;
        }

        /* Guidance box */
        .guidance-box {
            padding: 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 8px;
        }
        .guidance-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
        }
        .guidance-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .guidance-list li {
            font-size: 13px;
            color: var(--text2);
            padding: 8px 10px;
            background: var(--card);
            border-radius: 6px;
        }

        .info-box {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .info-box-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
        }

        .info-box-list {
            margin: 0;
            padding-left: 20px;
        }

        .info-box-list li {
            font-size: 14px;
            color: var(--text2);
            padding: 4px 0;
        }

        .choice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .choice-btn:active {
            transform: scale(0.98);
        }

        .choice-btn.shocked {
            background: var(--red);
            color: #fff;
        }

        .choice-btn.not-shocked {
            background: var(--green);
            color: #fff;
        }

        .choice-btn-label {
            font-size: 16px;
            font-weight: 600;
        }

        .choice-btn-sub {
            font-size: 12px;
            opacity: 0.85;
            margin-top: 2px;
        }

        .guidance-gut {
            margin-top: 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
            font-style: italic;
        }

        /* Pause page */
        .pause-box {
            padding: 16px;
            background: rgba(0,122,255,0.08);
            border: 1px solid rgba(0,122,255,0.2);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .pause-text {
            font-size: 15px;
            color: var(--text);
            font-weight: 500;
            text-align: center;
        }
        .pause-list { display: flex; flex-direction: column; gap: 8px; }
        .pause-item {
            padding: 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
        }
        .pause-item-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .pause-item-sub { font-size: 13px; color: var(--text2); }
        .pause-item-link { 
            font-size: 12px; 
            color: var(--blue); 
            margin-top: 6px; 
            cursor: pointer;
        }
        .pause-item-link:active { opacity: 0.7; }

        /* Action items */
        .action-list { display:flex; flex-direction:column; gap:6px; }
        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: rgba(255,59,48,0.06);
            border: 1px solid rgba(255,59,48,0.12);
            border-radius: 10px;
        }
        .action-num {
            width:22px; height:22px;
            margin-top: 2px;
            background: var(--red);
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            display:flex; align-items:center; justify-content:center;
            flex-shrink: 0;
        }
        .action-text { font-size:14px; line-height:1.4; flex:1; }
        .action-text strong { font-weight:600; }
        .action-sub { color:var(--text3); font-size:12px; display:block; margin-top:2px; }
        .info-btn {
            width: 18px; height: 18px;
            background: rgba(0,0,0,0.05);
            border: none;
            border-radius: 50%;
            color: var(--text3);
            font-size: 11px;
            font-family: Georgia, serif;
            font-style: italic;
            cursor: pointer;
            display: inline-flex; align-items: center; justify-content: center;
            vertical-align: middle;
            margin-left: 4px;
            flex-shrink:0;
        }
        .action-btns {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        .fluid-link-btn {
            background: #fff;
            border: 1px solid var(--border);
            color: var(--blue);
            font-size: 11px;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* Simple list */
        .simple-list { display:flex; flex-direction:column; gap:4px; }
        .simple-list-item {
            padding: 10px 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
        }
        .simple-list-item-title { font-size: 14px; font-weight: 500; color: var(--text); }
        .simple-list-item-sub { font-size: 12px; color: var(--text3); margin-top: 2px; }

        /* Cause cards */
        .cause-card {
            padding: 0;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        .cause-header {
            padding: 14px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cause-header:active { background: var(--card); }
        .cause-arrow { color: var(--text3); font-size: 12px; transition: transform 0.2s; }
        .cause-card.open .cause-arrow { transform: rotate(180deg); }
        .cause-body {
            display: none;
            padding: 12px 14px 14px 14px;
            border-top: 1px solid var(--border);
        }
        .cause-card.open .cause-body { display: block; }
        .cause-title { font-size: 15px; font-weight: 600; }
        .cause-sub { font-size: 12px; color: var(--text2); margin-top: 2px; }
        .cause-clues { font-size: 13px; color: var(--text2); line-height: 1.5; }
        .cause-clue-item { margin-bottom: 4px; }
        .cause-clue-item:last-child { margin-bottom: 0; }
        .clickable-clue { 
            color: var(--blue); 
            cursor: pointer; 
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .clickable-clue:active { opacity: 0.7; }
        .info-badge {
            font-size: 10px;
            font-family: Georgia, serif;
            font-style: italic;
            color: #fff;
            background: var(--blue);
            padding: 2px 6px;
            border-radius: 8px;
            cursor: pointer;
        }
        .future-link {
            color: var(--text3);
        }
        .coming-badge {
            font-size: 9px;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--text3);
            margin-left: 6px;
        }
        .cause-link {
            font-size: 12px;
            color: var(--blue);
            margin-top: 10px;
            cursor: pointer;
        }
        .cause-link:active { opacity: 0.7; }
        .cause-body .cause-link { margin-top: 12px; }
        .cause-info-btn {
            background: rgba(0,122,255,0.1);
            color: var(--blue);
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }
        .cause-info-btn:active { opacity: 0.7; }

        /* DDx tiles - standardized */
        .ddx-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 10px 0 6px 0;
        }
        .ddx-section-title:first-of-type {
            margin-top: 0;
        }

        /* DDx list items (replacing tiles) */
        .ddx-list-item {
            display: flex;
            align-items: center;
            padding: 10px 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 4px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text);
        }

        .ddx-list-item:active {
            background: #f5f5f5;
        }

        .ddx-list-text {
            flex: 1;
            min-width: 0;
        }

        .ddx-list-title {
            font-size: 14px;
            color: var(--text);
            display: block;
        }

        .ddx-list-sub {
            font-size: 12px;
            color: var(--text3);
            display: block;
            margin-top: 2px;
        }

        .ddx-chevron {
            color: var(--text3);
            font-size: 16px;
            flex-shrink: 0;
        }

        .ddx-info-btn {
            font-size: 12px;
            color: var(--blue);
            background: rgba(0,122,255,0.08);
            border: none;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
            margin-left: auto;
        }

        /* Blood loss section with positioned warning */
        .ddx-blood-loss-section {
            position: relative;
            padding-right: 120px;
            margin-bottom: 4px;
        }

        .ddx-hb-warning {
            position: absolute;
            top: 0;
            right: 0;
            width: 110px;
            height: 100%;
            background: rgba(255, 149, 0, 0.06);
            border: 1px solid rgba(255, 149, 0, 0.25);
            border-radius: 10px;
            padding: 8px;
            font-size: 11px;
            line-height: 1.3;
            color: var(--text2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
        }

        .ddx-hb-warning .warning-icon {
            font-size: 14px;
        }

        .ddx-hb-warning .hb-info-btn {
            font-size: 12px;
            color: var(--blue);
            cursor: pointer;
        }

        /* DDx page header with tracker */
        .ddx-page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        /* DDx tracker (mini version of DDx box) */
        .ddx-tracker {
            background: rgba(0,0,0,0.02);
            border-radius: 8px;
            padding: 8px 10px;
            width: 110px;
            flex-shrink: 0;
        }

        .ddx-tracker-item {
            font-size: 11px;
            color: var(--text3);
            padding: 1px 0;
            text-align: right;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
        }

        .ddx-tracker-item.current {
            font-weight: 600;
            color: var(--text);
        }

        .ddx-tracker-arrow {
            font-size: 9px;
            color: var(--blue);
        }

        /* Escalation box */
        .escalation-box {
            background: rgba(255, 59, 48, 0.06);
            border: 1px solid rgba(255, 59, 48, 0.2);
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 16px;
        }

        .escalation-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--red);
            margin-bottom: 6px;
        }

        .escalation-text {
            font-size: 14px;
            color: var(--text);
            line-height: 1.4;
        }

        /* Cause grid tiles */
        .cause-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .cause-tile {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .cause-tile:active {
            transform: scale(0.98);
            background: #f9f9f9;
        }
        .cause-tile-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        .cause-tile-hint {
            font-size: 12px;
            color: var(--text2);
            line-height: 1.4;
        }
        .warning-box {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 10px;
            padding: 12px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text);
        }
        .warning-icon {
            font-size: 16px;
        }

        /* Trache steps */
        .trache-step {
            display: flex;
            gap: 12px;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
        }
        .trache-step:last-of-type {
            border-bottom: none;
        }
        .trache-step-num {
            width: 28px;
            height: 28px;
            background: var(--blue);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .trache-step-content {
            flex: 1;
        }
        .trache-step-action {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        .trache-step-check {
            font-size: 13px;
            color: var(--text2);
            margin-top: 4px;
        }
        .trache-step-hint {
            font-size: 13px;
            color: var(--text3);
            margin-top: 4px;
        }

        /* Branch buttons */
        .branch-buttons {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        .branch-btn {
            flex: 1;
            padding: 14px 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text2);
            cursor: pointer;
        }
        .branch-btn.primary {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }

        /* O2 tiles */
        .o2-tiles {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .o2-tile {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .o2-tile:active {
            transform: scale(0.98);
            background: #f9f9f9;
        }
        .o2-tile-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        .o2-tile-hint {
            font-size: 12px;
            color: var(--text2);
        }
        .o2-device-section {
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .o2-device-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .o2-device-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }
        .o2-device-fio2 {
            font-size: 13px;
            color: var(--blue);
            font-weight: 500;
        }

        /* History cards */
        .history-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 14px;
            margin-bottom: 8px;
        }
        .history-q {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }
        .history-hint {
            font-size: 12px;
            color: var(--text3);
            margin-top: 2px;
        }

        /* Auscultation options */
        .auscultation-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .auscultation-btn {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
            text-align: left;
            cursor: pointer;
            transition: all 0.15s;
        }
        .auscultation-btn:active {
            transform: scale(0.98);
        }
        .auscultation-btn.active {
            background: var(--blue);
            border-color: var(--blue);
        }
        .auscultation-btn.active .auscultation-title,
        .auscultation-btn.active .auscultation-hint {
            color: #fff;
        }
        .auscultation-title {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        .auscultation-hint {
            display: block;
            font-size: 12px;
            color: var(--text3);
            margin-top: 2px;
        }
        .auscultation-tile {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
        }
        .auscultation-tile:active {
            transform: scale(0.98);
            background: #f9f9f9;
        }
        .auscultation-tile.active {
            background: var(--blue);
            border-color: var(--blue);
        }
        .auscultation-tile.active .auscultation-tile-title {
            color: #fff;
        }
        .auscultation-tile-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        /* Overview cards */
        .overview-card-static {
            padding: 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 8px;
        }
        .overview-title { font-size: 16px; font-weight: 600; }
        .overview-items { font-size: 13px; color: var(--text2); margin-top: 4px; }

        /* Clinical questions */
        .clinical-question {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .clinical-q-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
            text-align: center;
        }
        .clinical-q-buttons {
            display: flex;
            gap: 10px;
        }
        .clinical-q-buttons.three-col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }
        .clinical-q-buttons.three-col .clinical-q-btn {
            padding: 12px 8px;
            font-size: 13px;
        }
        .clinical-q-btn {
            flex: 1;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: #fff;
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s;
        }
        .clinical-q-btn:active {
            transform: scale(0.98);
        }
        .clinical-q-btn.selected {
            border-color: var(--blue);
            background: rgba(0,122,255,0.08);
            color: var(--blue);
        }
        .clinical-q-btn.warm.selected {
            border-color: var(--red);
            background: rgba(255,59,48,0.08);
            color: var(--red);
        }
        .clinical-q-btn.cool.selected {
            border-color: var(--blue);
            background: rgba(0,122,255,0.08);
            color: var(--blue);
        }

        /* Reordered category cards */
        .category-card {
            padding: 12px 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .category-rank {
            width: 22px;
            height: 22px;
            background: var(--text3);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .category-card.highlight {
            border-color: rgba(0,122,255,0.4);
            background: rgba(0,122,255,0.04);
        }
        .category-card.highlight .category-rank {
            background: var(--blue);
        }
        .category-name {
            font-size: 14px;
            font-weight: 500;
        }

        /* Pearl box */
        .pearl-box {
            display: flex;
            gap: 12px;
            padding: 14px;
            background: rgba(255,204,0,0.1);
            border: 1px solid rgba(255,204,0,0.25);
            border-radius: 10px;
            margin-top: 16px;
        }
        .pearl-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        .pearl-content { flex: 1; }
        .pearl-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        .pearl-text {
            font-size: 13px;
            color: var(--text2);
            line-height: 1.5;
        }

        /* Info link */
        .info-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: rgba(0,122,255,0.06);
            border-radius: 10px;
            font-size: 14px;
            color: var(--blue);
            cursor: pointer;
        }
        .info-link .info-btn {
            font-size: 16px;
        }

        /* Inline link button */
        .inline-link-btn {
            display: inline;
            margin-left: 4px;
            padding: 0;
            background: none;
            color: var(--blue);
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: underline;
        }

        /* GI Bleeding specific styles */
        .gi-do-dont-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }
        .gi-do-col, .gi-dont-col {
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
        }
        .gi-do-col {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
        }
        .gi-dont-col {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
        }
        .gi-col-header {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .gi-do-col .gi-col-header { color: var(--green); }
        .gi-dont-col .gi-col-header { color: var(--red); }
        .gi-col-item {
            margin-bottom: 6px;
            line-height: 1.4;
        }
        .gi-history-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 12px;
            font-size: 13px;
        }
        .gi-history-clue {
            color: var(--text2);
        }
        .gi-history-think {
            font-weight: 500;
        }

        /* Compact GI History layout */
        .gi-history-group {
            margin-bottom: 16px;
        }
        .gi-history-group-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .gi-history-compact {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
        }
        .gi-history-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            gap: 8px;
        }
        .gi-history-row:not(:last-child) {
            border-bottom: 1px solid var(--border);
        }
        .gi-history-q {
            font-size: 14px;
            color: var(--text);
            flex: 1;
        }
        .gi-history-tag {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
            white-space: nowrap;
        }
        .gi-history-tag.upper {
            background: rgba(255, 59, 48, 0.12);
            color: var(--red);
        }
        .gi-history-tag.lower {
            background: rgba(0, 122, 255, 0.12);
            color: var(--blue);
        }
        .gi-history-tag.variceal {
            background: rgba(255, 149, 0, 0.12);
            color: var(--orange);
        }
        .gi-history-tag.neutral {
            background: rgba(0, 0, 0, 0.06);
            color: var(--text2);
        }

        /* GI Management layout */
        .gi-mx-section {
            margin-bottom: 16px;
        }
        .gi-mx-section-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        .gi-mx-section-title.escalate {
            color: var(--red);
        }
        .gi-mx-clue {
            font-size: 11px;
            font-weight: 500;
            color: var(--text3);
        }
        .gi-mx-box {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
        }
        .gi-mx-box.escalate {
            background: #fff;
            border-color: var(--border);
        }

        /* Fluid resuscitation card styles */
        .fluid-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        .fluid-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .fluid-card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 10px;
        }
        .fluid-card-header .fluid-card-title {
            margin-bottom: 0;
        }
        .fluid-card-body {
            font-size: 14px;
            color: var(--text);
            line-height: 1.5;
        }
        .fluid-hint {
            font-size: 13px;
            color: var(--text3);
        }
        .fluid-list-item {
            font-size: 12px;
            color: var(--text2);
            margin-top: 2px;
        }
        .text-link-btn {
            background: none;
            border: none;
            color: var(--blue);
            font-size: 13px;
            cursor: pointer;
            padding: 0;
        }
        .gi-mx-item {
            font-size: 13px;
            color: var(--text);
            line-height: 1.5;
            padding: 4px 0;
        }
        .gi-mx-item:first-child {
            padding-top: 0;
        }
        .gi-mx-item:last-child {
            padding-bottom: 0;
        }

        /* Variceal vs Non-variceal comparison */
        .gi-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        .gi-comparison-col {
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
        }
        .gi-comparison-col.variceal {
            border: 1px solid var(--border);
        }
        .gi-comparison-col.nonvariceal {
            border: 1px solid var(--border);
        }
        .gi-comparison-header {
            padding: 10px;
            background: rgba(0, 0, 0, 0.02);
            border-bottom: 1px solid var(--border);
        }
        .gi-comparison-col.variceal .gi-comparison-header {
            background: rgba(0, 0, 0, 0.02);
            border-bottom-color: var(--border);
        }
        .gi-comparison-title {
            font-size: 13px;
            font-weight: 700;
            display: block;
        }
        .gi-comparison-col.variceal .gi-comparison-title {
            color: var(--text1);
        }
        .gi-comparison-clue {
            font-size: 10px;
            color: var(--text3);
            display: block;
            margin-top: 2px;
        }
        .gi-comparison-do,
        .gi-comparison-dont {
            padding: 8px 10px;
        }
        .gi-comparison-dont {
            border-top: 1px solid var(--border);
        }
        .gi-comparison-col.variceal .gi-comparison-dont {
            border-top-color: var(--border);
        }
        .gi-comparison-label {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .gi-comparison-label.do {
            color: var(--green);
        }
        .gi-comparison-label.dont {
            color: var(--red);
        }
        .gi-comparison-col .gi-mx-item {
            font-size: 12px;
            padding: 2px 0;
        }

        /* GI Upper/Lower toggle */
        .gi-toggle-container {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .gi-toggle-btn {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #fff;
            font-size: 14px;
            font-weight: 600;
            color: var(--text2);
            cursor: pointer;
            transition: all 0.2s;
        }
        .gi-toggle-btn.active {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }
        .gi-toggle-section {
            display: none;
        }
        .gi-toggle-section.active {
            display: block;
        }

        .gi-select-prompt {
            text-align: center;
            color: var(--text3);
            font-size: 14px;
            padding: 20px 0;
            font-style: italic;
        }

        .gi-select-prompt.hidden {
            display: none;
        }

        /* GI Hb caution one-liner */
        .gi-hb-caution {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            cursor: pointer;
        }
        .action-list .gi-hb-caution {
            margin: 0;
        }
        .gi-hb-icon {
            font-size: 16px;
        }
        .gi-hb-text {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
            color: #856404;
        }
        .gi-hb-info {
            font-size: 14px;
            color: #856404;
            opacity: 0.7;
        }

        /* Homepage Tools Section */
        .tools-section {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }
        .tools-link-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tools-link-btn:hover {
            border-color: var(--red);
            background: rgba(255,59,48,0.05);
        }
        .tools-link-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tools-link-icon svg {
            width: 24px;
            height: 24px;
            color: var(--red);
        }
        .tools-link-text {
            flex: 1;
            font-size: 14px;
            font-weight: 600;
            color: var(--text1);
            text-align: left;
        }
        .tools-link-arrow {
            font-size: 20px;
            color: var(--text2);
        }
        
        /* Tools Page */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .tool-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 12px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tool-card:hover, .tool-card:active {
            border-color: var(--blue);
            background: #f0f7ff;
        }
        .tool-card-icon {
            font-size: 32px;
        }
        .tool-card-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text1);
        }

        /* Standalone RR Counter */
        .rr-counter-standalone {
            text-align: center;
            width: 100%;
            max-width: 300px;
        }
        .rr-display-standalone {
            font-size: 72px;
            font-weight: 700;
            color: var(--blue);
            line-height: 1;
        }
        .rr-label {
            font-size: 16px;
            color: var(--text2);
            margin-bottom: 8px;
        }
        .rr-status-standalone {
            font-size: 14px;
            color: var(--text2);
            margin-bottom: 24px;
            min-height: 20px;
        }
        .rr-tap-btn-standalone {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: var(--blue);
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0,122,255,0.3);
            transition: transform 0.1s;
        }
        .rr-tap-btn-standalone:active {
            transform: scale(0.95);
        }
        .rr-controls-standalone {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        .rr-ctrl-btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        /* FiO2 Calculator */
        .fio2-calc {
            padding: 16px 0;
        }
        .fio2-section {
            margin-bottom: 20px;
        }
        .fio2-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text2);
            margin-bottom: 12px;
        }
        .fio2-devices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .fio2-device-btn {
            padding: 14px 12px;
            background: #fff;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .fio2-device-btn.active {
            border-color: var(--blue);
            background: #f0f7ff;
            color: var(--blue);
        }
        .fio2-flow-section {
            margin-bottom: 20px;
        }
        .fio2-flow-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .fio2-flow-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: #fff;
            font-size: 24px;
            cursor: pointer;
        }
        .fio2-flow-value {
            font-size: 32px;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
        }
        .fio2-result-box {
            background: linear-gradient(135deg, #007AFF, #5856D6);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            color: #fff;
            margin-bottom: 16px;
        }
        .fio2-result-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        .fio2-result-value {
            font-size: 48px;
            font-weight: 700;
        }
        .fio2-note {
            font-size: 12px;
            color: var(--text2);
            background: #f5f5f7;
            padding: 12px;
            border-radius: 8px;
        }

        /* Collapsible sections */
        .collapsible-section {
            background: white;
            border-radius: 12px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            cursor: pointer;
        }
        .collapsible-title {
            font-weight: 600;
            font-size: 15px;
        }
        .collapsible-arrow {
            font-size: 12px;
            color: var(--text2);
            transition: transform 0.2s;
        }
        .collapsible-section.open .collapsible-arrow {
            transform: rotate(180deg);
        }
        .collapsible-body {
            display: none;
            padding: 0 16px 16px;
        }
        .collapsible-section.open .collapsible-body {
            display: block;
        }

        /* Progress indicator */
        .progress-bar {
            display: flex;
            gap: 4px;
            padding: 0 16px 12px;
            background-color: #f5f5f7;
        }
        .progress-dot {
            flex: 1;
            height: 3px;
            background: var(--border);
            border-radius: 2px;
        }
        .progress-dot.active { background: var(--blue); }
        .progress-dot.done { background: var(--green); }

        /* Bottom nav */
        .bottom-nav {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
            padding-bottom: calc(12px + constant(safe-area-inset-bottom));
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            border-top: 1px solid var(--border);
            background-color: #f5f5f7;
            flex-shrink: 0;
        }
        .nav-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            min-height: 44px;
        }
        .nav-btn:active { transform:scale(0.97); }
        .nav-btn.secondary { background:#fff; border:1px solid var(--border); color:var(--text2); }
        .nav-btn.primary { background:var(--blue); color:#fff; }

        /* Hypotension Progress Bar */
        .hypo-progress-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px 20px;
            background: #f5f5f7;
        }

        .hypo-progress-track {
            display: flex;
            align-items: center;
        }

        .hypo-progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .hypo-progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: #fff;
            transition: all 0.2s;
        }

        .hypo-progress-step.completed .hypo-progress-dot {
            background: var(--green);
            border-color: var(--green);
        }

        .hypo-progress-step.current .hypo-progress-dot {
            background: var(--blue);
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(0,122,255,0.15);
        }

        .hypo-progress-line {
            width: 32px;
            height: 2px;
            background: var(--border);
            margin: 0 2px;
            margin-bottom: 18px;
        }

        .hypo-progress-step.completed + .hypo-progress-line,
        .hypo-progress-line.done {
            background: var(--green);
        }

        .hypo-progress-label {
            font-size: 9px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .hypo-progress-step.current .hypo-progress-label {
            color: var(--blue);
        }

        .hypo-progress-step.completed .hypo-progress-label {
            color: var(--green);
        }

        /* Hypotension Unified Header */
        .hypo-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f5f5f7;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .hypo-header-back {
            width: 44px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .hypo-header-back button {
            background: none;
            border: none;
            color: var(--blue);
            font-size: 24px;
            padding: 0;
            cursor: pointer;
            line-height: 1;
        }

        .hypo-header-home {
            width: 44px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .hypo-header-home button {
            background: none;
            border: none;
            color: var(--text3);
            padding: 0;
            cursor: pointer;
        }

        .hypo-header-home svg {
            width: 22px;
            height: 22px;
        }

        .hypo-seg-control {
            display: flex;
            background: rgba(0,0,0,0.06);
            border-radius: 10px;
            padding: 3px;
            gap: 2px;
        }

        .hypo-seg-item {
            padding: 7px 12px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .hypo-seg-item:active {
            opacity: 0.7;
        }

        .hypo-seg-item.current {
            background: #fff;
            color: var(--text);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .hypo-seg-item.completed {
            color: var(--text2);
            cursor: pointer;
        }

        .hypo-seg-item.completed:active {
            opacity: 0.7;
        }

        /* Killer list */
        .killer-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .killer-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .killer-card-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .killer-card-clue {
            font-size: 13px;
            color: var(--text2);
            line-height: 1.4;
        }

        /* Management cards */
        .mgmt-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mgmt-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .mgmt-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 16px;
            background: rgba(0,0,0,0.02);
            border-bottom: 1px solid var(--border);
        }

        .mgmt-card-icon {
            font-size: 18px;
        }

        .mgmt-card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }

        .mgmt-card-body {
            padding: 14px 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .mgmt-card-item {
            font-size: 14px;
            color: var(--text2);
            line-height: 1.5;
            padding-left: 12px;
            position: relative;
        }

        .mgmt-card-item::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--text3);
        }

        .mgmt-card-link {
            font-size: 13px;
            color: var(--blue);
            cursor: pointer;
            margin-top: 4px;
            padding-left: 12px;
        }

        .mgmt-card-link:active {
            opacity: 0.7;
        }

        /* Toggle buttons */
        .toggle-group {
            display: flex;
            gap: 8px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px 16px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text2);
            cursor: pointer;
            transition: all 0.15s;
        }

        .toggle-btn:active {
            transform: scale(0.98);
        }

        .toggle-btn.active {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }

        /* History list */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-item {
            padding: 12px 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .history-item-q {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .history-item-why {
            font-size: 12px;
            color: var(--text3);
            margin-top: 2px;
        }

        /* Exam checklist */
        .exam-checklist {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* ABCDE Cards */
        .abcde-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 10px;
        }

        .abcde-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .abcde-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .abcde-badge {
            width: 28px;
            height: 28px;
            background: var(--blue);
            color: #fff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .abcde-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .abcde-hints {
            text-align: right;
            font-size: 12px;
            color: var(--text3);
            line-height: 1.5;
        }

        .abcde-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .abcde-body {
            font-size: 14px;
            color: var(--text2);
            line-height: 1.5;
        }

        .abcde-body div {
            margin-bottom: 4px;
        }

        .abcde-body div:last-child {
            margin-bottom: 0;
        }

        /* Clinical toggle row */
        .clinical-toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--card);
            border-radius: 8px;
            margin-top: 10px;
        }
        .clinical-toggle-label { flex: 1; }
        .clinical-toggle-q {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        .clinical-toggle-hint {
            display: block;
            font-size: 11px;
            color: var(--text3);
            margin-top: 2px;
        }
        .toggle-btns {
            display: flex;
            gap: 6px;
        }
        .toggle-btn {
            padding: 6px 14px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: #fff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            min-width: 44px;
        }
        .toggle-btn.active {
            background: var(--blue);
            color: #fff;
            border-color: var(--blue);
        }
        .toggle-btn.active.warning {
            background: var(--orange);
            border-color: var(--orange);
        }

        /* Breathing card with RR counter */
        .breathing-card {
            display: flex;
            gap: 16px;
        }

        .abcde-card-left {
            flex: 1;
        }

        .rr-counter {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            min-width: 100px;
        }

        .rr-counter-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .rr-counter-subtitle {
            font-size: 11px;
            color: var(--text3);
            margin-bottom: 8px;
        }

        .rr-counter-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(0,122,255,0.1);
            border: none;
            color: var(--blue);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .rr-counter-btn:active {
            transform: scale(0.95);
            background: rgba(0,122,255,0.2);
        }

        .rr-counter-btn.counting {
            background: var(--blue);
            color: #fff;
        }

        .rr-counter-display {
            margin-top: 8px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .rr-unit {
            font-size: 14px;
            font-weight: 400;
            color: var(--text2);
        }

        .rr-reset-btn {
            font-size: 11px;
            color: var(--text3);
            background: none;
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Differential panel */
        .differential-panel {
            margin-top: 24px;
            padding: 16px;
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
        }

        .differential-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .differential-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .diff-tag {
            padding: 6px 12px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 13px;
            color: var(--text2);
            transition: all 0.2s;
        }

        .diff-tag.top {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }

        .differential-hint {
            font-size: 12px;
            color: var(--text3);
            margin-top: 10px;
            font-style: italic;
        }

        .differential-list {
            display: flex;
            flex-direction: column;
        }

        .diff-list-item {
            padding: 10px 14px;
            font-size: 14px;
            color: var(--text2);
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .diff-list-item:last-child {
            border-bottom: none;
        }

        .diff-list-item.top {
            font-weight: 600;
            color: var(--text);
            background: rgba(0,122,255,0.06);
        }

        /* Mini differential panel - top right */
        .page-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 12px;
        }
        .page-title-row .page-title {
            margin-bottom: 0;
            flex-shrink: 0;
        }
        /* Top row layout - Onset/Airway + DDx side by side */
        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
        }

        /* Top row with Airway + DDx */
        .assess-top-row {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .assess-top-row .abcde-card {
            flex: 1;
            margin-bottom: 0;
        }
        .assess-top-row .ddx-box {
            width: 130px;
            flex-shrink: 0;
        }
        .assess-top-left {
            flex: 1;
            min-width: 0;
        }
        .history-prompts {
            width: 100%;
        }
        .onset-section {
            flex: 1;
        }
        .section-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .onset-toggle {
            display: flex;
            gap: 8px;
        }
        .onset-btn.compact {
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        .onset-btn.compact.active {
            background: var(--blue);
            color: #fff;
            border-color: var(--blue);
        }

        /* ABCDE Cards */
        .abcde-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 10px;
        }
        .abcde-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .abcde-badge {
            width: 26px;
            height: 26px;
            background: var(--blue);
            color: #fff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .abcde-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }

        /* Items list - TIGHT spacing */
        .abcde-items {
            margin-top: 6px;
        }
        .abcde-item {
            font-size: 14px;
            color: var(--text);
            padding: 1px 0;
            line-height: 1.3;
        }

        /* Row with controls on right */
        .abcde-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1px 0;
        }
        .abcde-item-row span {
            font-size: 14px;
            color: var(--text);
        }

        .toggle-btns {
            display: flex;
            gap: 6px;
        }
        .toggle-btn {
            padding: 6px 14px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: #fff;
            font-size: 13px;
            color: var(--text);
            cursor: pointer;
        }
        .toggle-btn.active {
            background: var(--blue);
            color: #fff;
            border-color: var(--blue);
        }
        .toggle-btn.warning {
            background: var(--orange);
            border-color: var(--orange);
        }

        /* Count RR button */
        .count-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--blue);
            background: rgba(0, 122, 255, 0.08);
            font-size: 13px;
            color: var(--blue);
            cursor: pointer;
        }
        .count-btn:active {
            background: rgba(0, 122, 255, 0.15);
        }

        /* DDx box - tight spacing */
        .ddx-box {
            background: rgba(0,0,0,0.02);
            border-radius: 10px;
            padding: 10px 12px;
        }
        .ddx-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .ddx-box-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .ddx-item {
            font-size: 13px;
            color: var(--text2);
            padding: 2px 0;
            text-align: right;
        }
        .ddx-item.top {
            font-weight: 600;
            color: var(--text);
        }
        /* RR Modal button */
        .rr-modal-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 16px;
            background: rgba(0,122,255,0.08);
            border: 1px solid rgba(0,122,255,0.2);
            border-radius: 10px;
            cursor: pointer;
            min-width: 80px;
        }
        .rr-modal-btn span:first-child {
            font-weight: 600;
            font-size: 13px;
            color: var(--blue);
        }
        .rr-modal-hint {
            font-size: 11px;
            color: var(--text3);
        }

        .toggle-row {
            display: flex;
            gap: 8px;
        }

        .toggle-pill {
            flex: 1;
            padding: 14px 16px;
            background: #fff;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text2);
            cursor: pointer;
            transition: all 0.15s;
        }

        .toggle-pill:active {
            transform: scale(0.98);
        }

        .toggle-pill.active {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }

        /* Onset toggle buttons with hints */
        .onset-toggle-row {
            display: flex;
            gap: 10px;
        }

        .onset-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 14px 12px;
            background: #fff;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .onset-btn:active {
            transform: scale(0.98);
        }

        .onset-btn.active {
            border-color: var(--blue);
            background: rgba(0,122,255,0.06);
        }

        .onset-btn-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .onset-btn-hint {
            font-size: 11px;
            color: var(--text3);
            margin-top: 4px;
        }

        .onset-btn.active .onset-btn-title {
            color: var(--blue);
        }

        /* History checklist items */
        .history-checklist {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-check-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            width: 100%;
        }

        .history-check-item:active {
            transform: scale(0.99);
        }

        .history-check-item.checked {
            border-color: var(--blue);
            background: rgba(0,122,255,0.04);
        }

        .history-check-box {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 6px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2px;
            transition: all 0.15s;
        }

        .history-check-item.checked .history-check-box {
            background: var(--blue);
            border-color: var(--blue);
        }

        .history-check-item.checked .history-check-box::after {
            content: '✓';
            color: #fff;
            font-size: 14px;
            font-weight: 600;
        }

        .history-check-content {
            flex: 1;
        }

        .history-check-q {
            font-size: 15px;
            font-weight: 500;
            color: var(--text);
        }

        .history-check-hint {
            font-size: 13px;
            color: var(--text3);
            margin-top: 2px;
        }

        /* Auscultation section in B card */
        .ausc-section {
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid var(--border);
        }

        .ausc-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text2);
            margin-bottom: 10px;
        }

        .ausc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .ausc-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 8px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .ausc-btn:active {
            transform: scale(0.97);
        }

        .ausc-btn.active {
            border-color: var(--blue);
            background: rgba(0,122,255,0.08);
        }

        .ausc-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }

        .ausc-btn.active .ausc-title {
            color: var(--blue);
        }

        .ausc-hint {
            font-size: 10px;
            color: var(--text3);
            margin-top: 2px;
        }

        /* Inline toggle pills (compact style for ABCDE cards) */
        .inline-toggle-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.06);
        }
        .inline-toggle-label {
            font-size: 13px;
            color: var(--text2);
            white-space: nowrap;
        }
        .inline-toggle-pills {
            display: flex;
            gap: 6px;
        }
        .inline-pill {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text3);
            cursor: pointer;
            transition: all 0.15s;
        }
        .inline-pill:active {
            transform: scale(0.97);
        }
        .inline-pill.active {
            background: var(--blue);
            border-color: var(--blue);
            color: #fff;
        }

        .history-prompts {
            display: flex;
            flex-direction: column;
            gap: 1px;
            background: var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .history-prompt {
            padding: 14px 16px;
            background: #fff;
            font-size: 14px;
            color: var(--text);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .history-hint {
            color: var(--text3);
            font-size: 13px;
        }

        /* Exam findings */
        .exam-findings {
            display: flex;
            flex-direction: column;
            gap: 1px;
            background: var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .exam-finding {
            padding: 14px 16px;
            background: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .exam-finding-text {
            font-size: 14px;
            color: var(--text);
            flex: 1;
        }

        .exam-finding-hint {
            font-size: 13px;
            color: var(--text3);
            white-space: nowrap;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.active { display:flex; }
        .modal {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
        .modal-title { font-size:16px; font-weight:600; }
        .modal-close {
            width:28px; height:28px;
            background: var(--card);
            border: none;
            border-radius: 50%;
            color: var(--text2);
            font-size: 16px;
            cursor: pointer;
            display:flex; align-items:center; justify-content:center;
        }
        .modal-body { font-size:13px; line-height:1.5; color:var(--text2); }

        /* Disclaimer Modal */
        .disclaimer-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .disclaimer-overlay.active { display: flex; }
        .disclaimer-modal {
            background: #fff;
            border-radius: 20px;
            padding: 24px;
            max-width: 360px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .disclaimer-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--orange), #ffb340);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }
        .disclaimer-icon svg { width: 28px; height: 28px; }
        .disclaimer-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text);
        }
        .disclaimer-list {
            text-align: left;
            margin-bottom: 20px;
        }
        .disclaimer-item {
            font-size: 13px;
            color: var(--text2);
            line-height: 1.5;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .disclaimer-item:last-child { border-bottom: none; }
        .disclaimer-item-icon {
            flex-shrink: 0;
            width: 18px;
            height: 18px;
            background: var(--card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--text3);
            margin-top: 2px;
        }
        .disclaimer-btn {
            width: 100%;
            padding: 14px;
            background: var(--blue);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }
        .disclaimer-btn:active { transform: scale(0.98); }

        /* Tabs */
        .tabs-container {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--card);
            border-radius: 10px;
            margin-bottom: 16px;
        }
        .tab-btn {
            flex: 1;
            padding: 10px 8px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text2);
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: #fff;
            color: var(--text);
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* RR Counter */
        .rr-counter-box {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 16px;
        }
        .rr-counter-instruction {
            font-size: 13px;
            color: var(--text2);
            margin-bottom: 16px;
        }
        .rr-lung-btn {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--blue), #4da3ff);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 4px 20px rgba(0,122,255,0.3);
        }
        .rr-lung-btn:active { transform: scale(0.95); }
        .rr-lung-btn.counting {
            animation: pulse 0.3s ease-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .rr-lung-btn svg { width: 50px; height: 50px; }
        .rr-status {
            font-size: 14px;
            color: var(--text2);
            margin-bottom: 8px;
        }
        .rr-result {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
        }
        .rr-result-label {
            font-size: 13px;
            color: var(--text2);
        }
        .rr-reset-btn {
            margin-top: 12px;
            padding: 8px 16px;
            background: var(--card);
            border: none;
            border-radius: 8px;
            font-size: 13px;
            color: var(--text2);
            cursor: pointer;
        }

        /* Breathing section with inline RR counter */
        .breathing-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: stretch;
        }
        .breathing-row .exam-section {
            flex: 2;
            margin-bottom: 0;
        }
        .rr-counter-inline {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            text-align: center;
            min-width: 100px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .rr-counter-inline .rr-counter-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
        }
        .rr-counter-inline .rr-counter-hint {
            font-size: 10px;
            color: var(--text3);
            margin-bottom: 8px;
        }
        .rr-counter-inline .rr-lung-btn {
            width: 56px;
            height: 56px;
            margin: 0 0 8px 0;
        }
        .rr-counter-inline .rr-lung-btn svg { width: 28px; height: 28px; }
        .rr-counter-inline .rr-status {
            font-size: 10px;
            margin-bottom: 2px;
            color: var(--text2);
        }
        .rr-counter-inline .rr-result {
            font-size: 24px;
            font-weight: 600;
        }
        .rr-counter-inline .rr-result-label {
            font-size: 11px;
            color: var(--text2);
        }
        .rr-counter-inline .rr-reset-btn {
            margin-top: 6px;
            padding: 4px 10px;
            font-size: 11px;
        }
        .rr-counter-inline .rr-counter-instruction { display: none; }

        /* Exam checklist */
        .exam-section {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
        }
        .exam-section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .exam-section-letter {
            width: 24px;
            height: 24px;
            background: var(--blue);
            color: #fff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
        }
        .exam-items {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .exam-item {
            font-size: 13px;
            color: var(--text2);
            padding-left: 32px;
            line-height: 1.4;
        }

        /* History questions */
        .history-item {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 6px;
        }
        .history-item-q {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }
        .history-item-why {
            font-size: 12px;
            color: var(--text3);
            margin-top: 2px;
        }

        /* Multifactorial caution */
        .multifactorial-note {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 10px;
            padding: 12px 14px;
            font-size: 13px;
            color: var(--orange);
            margin-bottom: 16px;
            text-align: center;
        }
        
        .fluid-table { width:100%; border-collapse:collapse; font-size:12px; }
        .fluid-table th { text-align:left; padding:8px 4px; font-size:10px; color:var(--text3); text-transform:uppercase; border-bottom:1px solid var(--border); }
        .fluid-table td { padding:10px 4px; border-bottom:1px solid var(--border); color:var(--text2); }
        .fluid-table tr:last-child td { border-bottom:none; }
        .fluid-table .name { font-weight:600; color:var(--text); }
        .fluid-table .warn { color:var(--orange); }
        .fluid-row { cursor:pointer; }
        .fluid-row:active { background:var(--card); }

        /* ECG Modal */
        .ecg-selector { margin-bottom: 16px; }
        .ecg-selector-title { font-size: 12px; color: var(--text3); margin-bottom: 8px; }
        .ecg-selector-btns { display: flex; gap: 6px; }
        .ecg-btn {
            flex: 1;
            padding: 8px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text2);
            cursor: pointer;
        }
        .ecg-btn.active { background: var(--blue); border-color: var(--blue); color: #fff; }
        .ecg-section { margin-bottom: 16px; }
        .ecg-section-title { font-size: 12px; font-weight: 600; color: var(--text); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.3px; }
        .ecg-criteria { background: rgba(0,122,255,0.06); padding: 12px; border-radius: 8px; font-size: 13px; }
        .ecg-notes { margin-top: 10px; }
        .ecg-item { margin-top: 6px; }
        .ecg-item-sub { font-size: 11px; color: var(--text3); margin-top: 2px; margin-left: 12px; }
        .ecg-note { font-size: 12px; color: var(--text2); margin-bottom: 4px; }
        .ecg-note.highlight { color: var(--red); font-weight: 500; }
        .ecg-equiv { display: flex; flex-direction: column; gap: 10px; }
        .ecg-equiv-item { background: var(--card); padding: 10px; border-radius: 8px; font-size: 12px; }
        .ecg-equiv-item strong { display: block; color: var(--text); margin-bottom: 2px; }
        .ecg-equiv-item span { display: block; color: var(--text2); }
        .ecg-meaning { font-style: italic; margin-top: 4px; }

        /* AF Modal */
        .af-warning { 
            padding: 0 0 12px 0; 
            margin-bottom: 16px;
            font-size: 13px;
            color: var(--text);
            border-bottom: 1px solid var(--border);
        }
        .af-table { width: 100%; border-collapse: collapse; font-size: 11px; }
        .af-table th, .af-table td { padding: 8px 6px; text-align: left; vertical-align: top; border-bottom: 1px solid var(--border); }
        .af-table th { font-size: 10px; font-weight: 600; }
        .af-question { font-weight: 500; color: var(--text); width: 30%; }
        .af-col-bystander { background: rgba(52,199,89,0.06); color: var(--text2); }
        .af-col-cause { background: rgba(255,59,48,0.06); color: var(--text2); }
        .af-note { font-size: 10px; color: var(--text3); }

        /* Caution modal */
        .caution-list { display: flex; flex-direction: column; gap: 10px; }
        .caution-item {
            padding: 12px;
            background: var(--card);
            border-radius: 8px;
        }
        .caution-item-title { font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
        .caution-item-sub { font-size: 12px; color: var(--text2); line-height: 1.4; }

        /* ECG Dropdown sections */
        .ecg-dropdown {
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        .ecg-dropdown-header {
            padding: 12px;
            background: var(--card);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: 600;
        }
        .ecg-dropdown-header:active { background: rgba(0,0,0,0.05); }
        .ecg-dropdown-arrow { color: var(--text3); transition: transform 0.2s; }
        .ecg-dropdown.open .ecg-dropdown-arrow { transform: rotate(180deg); }
        .ecg-dropdown-content {
            display: none;
            padding: 12px;
            border-top: 1px solid var(--border);
        }
        .ecg-dropdown.open .ecg-dropdown-content { display: block; }

        /* BP Modal */
        .bp-section { margin-bottom: 16px; }
        .bp-section-title { font-size: 12px; font-weight: 600; color: var(--text); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.3px; }
        .bp-text { font-size: 13px; color: var(--text2); line-height: 1.5; }
        .bp-list { display: flex; flex-direction: column; gap: 8px; }
        .bp-item { font-size: 12px; color: var(--text2); padding: 8px; background: var(--card); border-radius: 6px; }
        .bp-pearl {
            margin-top: 16px;
            padding: 12px;
            background: rgba(255,204,0,0.1);
            border: 1px solid rgba(255,204,0,0.25);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text2);
            line-height: 1.5;
        }
        /* Action Tiles - Emergency Visual Design */
        .action-tiles {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 0;
        }
        .action-tile {
            display: flex;
            align-items: center;
            background: #fff;
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            gap: 14px;
            position: relative;
            transition: all 0.15s ease;
        }
        .action-tile:active {
            transform: scale(0.98);
        }
        .action-tile-num {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 28px;
            height: 28px;
            background: var(--red);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(255,59,48,0.3);
        }
        .action-tile-icon {
            width: 56px;
            height: 56px;
            min-width: 56px;
            background: rgba(255,59,48,0.08);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-tile-icon svg {
            width: 32px;
            height: 32px;
            color: var(--red);
            fill: currentColor;
        }
        .action-tile-content {
            flex: 1;
            min-width: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }
        .action-tile-text {
            flex: 1;
            min-width: 0;
        }
        .action-tile-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--text1);
            line-height: 1.25;
            margin-bottom: 2px;
        }
        .action-tile-sub {
            font-size: 13px;
            color: var(--text2);
            line-height: 1.35;
        }
        .action-tile-links {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
            flex-shrink: 0;
        }
        .action-tile-link {
            font-size: 12px;
            color: var(--blue);
            background: rgba(0,122,255,0.08);
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
        }
        .action-tile-link:active {
            background: rgba(0,122,255,0.15);
        }

        /* Split row for action tile + side warning */
        .action-tile-split {
            display: flex;
            gap: 10px;
            align-items: stretch;
            margin-bottom: 8px;
        }

        .action-tile-split .action-tile {
            margin-bottom: 0;
        }

        .gi-hb-side-warning {
            width: 120px;
            flex-shrink: 0;
            background: rgba(255, 149, 0, 0.08);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            font-size: 11px;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            justify-content: center;
            gap: 6px;
        }

        .gi-hb-side-warning .warning-icon {
            font-size: 18px;
        }

        /* Right-justify info buttons in action tiles */
        .action-tile-row {
            display: flex;
            justify-content: flex-end;
            margin-top: 6px;
        }

        /* Simple action tile body (used in GI Bleed) */
        .action-tile-body {
            flex: 1;
            min-width: 0;
        }

        /* Investigation cards */
        .ix-card {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            background: #fff;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 12px;
        }
        .ix-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,59,48,0.08);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .ix-icon svg {
            width: 28px;
            height: 28px;
            color: var(--red);
        }
        .ix-content {
            flex: 1;
        }
        .ix-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 4px;
        }
        .ix-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }
        .ix-info-btn {
            font-size: 13px;
            color: var(--blue);
            background: rgba(0,122,255,0.08);
            border: none;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        .ix-hint {
            font-size: 13px;
            color: var(--text3);
            line-height: 1.4;
        }
        .ix-text {
            flex: 1;
        }
        .ix-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        .ix-btn {
            font-size: 13px;
            color: var(--blue);
            background: rgba(0,122,255,0.08);
            border: none;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        /* Link cards for Management page */
        .link-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .link-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .link-card-title {
            font-size: 16px;
            font-weight: 600;
        }
        .link-chevron {
            font-size: 20px;
            color: var(--text3);
        }
        .link-card-badge {
            font-size: 12px;
            color: var(--text3);
            background: rgba(0,0,0,0.05);
            padding: 4px 8px;
            border-radius: 4px;
        }
        /* DDx tile grid for Hypovolaemic page */
    </style>
</head>
<body>
    <div class="app">
        <!-- HOME -->
        <div class="page active" id="page-home">
            <div class="content">
                <div class="home-header">
                    <div class="home-logo">
                        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M55.653.826H8.298C4.232.826.425 4.641.425 8.706v47.342c0 4.067 3.822 7.901 7.89 7.901h47.34c4.066 0 7.895-3.814 7.895-7.88V8.712c0-4.065-3.829-7.885-7.897-7.885zm1.611 39.984h-16.85v16.833H23.565V40.81H6.71V23.965h16.855V7.132h16.849v16.833h16.85V40.81z" fill="#fff"/>
                        </svg>
                    </div>
                    <h1 class="home-title">METmate</h1>
                    <div class="beta-badge">BETA</div>
                </div>
                <p class="beta-disclaimer">This app is a work in progress. Content may be incomplete or contain errors. Always use clinical judgement.</p>
                <div class="trigger-list">
                    <div class="trigger-card" onclick="goToPage('page-shock')">
                        <div class="trigger-icon"><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M35 9.5C35 7.567 36.567 6 38.5 6C40.433 6 42 7.567 42 9.5V15.5C42 17.0827 40.9495 18.4201 39.5076 18.8528C39.5158 19.9067 39.5294 20.9275 39.5426 21.9138C39.5922 25.6347 39.6352 28.8635 39.356 31.5168C38.9558 35.3206 37.865 38.3118 34.8998 40.0594C31.5327 42.0438 26.6951 42.6429 22.7287 42.1435C20.7381 41.8929 18.8728 41.3549 17.4738 40.4998C16.4595 39.8798 15.6179 39.0406 15.2301 37.9774C13.1448 37.8844 11.0703 37.5052 9.42952 36.8249C7.66523 36.0935 6 34.8246 6 32.8396V13.1221H6.00292C6.00098 13.0815 6 13.0408 6 13C6 10.2386 10.4772 8 16 8C21.5228 8 26 10.2386 26 13C26 13.0408 25.999 13.0815 25.9971 13.1221H26V19.0709C26.1274 19.0891 26.2537 19.1108 26.3788 19.1358C26.67 19.1939 26.9548 19.2702 27.2318 19.3633C30.0035 20.295 32 22.9143 32 26C32 29.5268 29.3918 32.4445 25.999 32.9293C25.9525 34.9442 24.3416 36.2197 22.5645 36.9429C21.1162 37.5323 19.3353 37.8622 17.5114 37.9649C17.752 38.2509 18.0832 38.5283 18.5169 38.7934C19.5904 39.4496 21.1519 39.9292 22.9785 40.1592C26.6466 40.621 31.0049 40.0334 33.8843 38.3364C36.027 37.0735 36.9902 34.8886 37.367 31.3076C37.6332 28.7779 37.5925 25.7354 37.5437 22.0844L37.5437 22.083C37.53 21.0566 37.5156 19.9819 37.5073 18.8572C36.0578 18.4293 35 17.0882 35 15.5V9.5ZM22.1766 14.7467C23.7737 13.9482 24 13.2151 24 13C24 12.7849 23.7737 12.0518 22.1766 11.2533C20.6992 10.5146 18.5183 10 16 10C13.4817 10 11.3008 10.5146 9.82336 11.2533C8.22632 12.0518 8 12.7849 8 13C8 13.2151 8.22632 13.9482 9.82336 14.7467C11.3008 15.4854 13.4817 16 16 16C18.5183 16 20.6992 15.4854 22.1766 14.7467ZM16 18C19.2712 18 22.1755 17.2147 24 16.0005V19.0709C23.8726 19.0891 23.7463 19.1108 23.6212 19.1358C23.33 19.1939 23.0452 19.2702 22.7682 19.3633C19.9965 20.295 18 22.9143 18 26C18 29.5256 20.6064 32.4424 23.9975 32.9287C23.9533 33.707 23.3243 34.4744 21.8105 35.0905C20.2859 35.711 18.179 36.0235 16.0114 35.9988C15.703 35.9953 15.3957 35.9849 15.0909 35.968V17.9796C15.3903 17.9931 15.6936 18 16 18ZM25 21.5L23.5 26.5L25 28.5L26.5 26.5L25 21.5Z" fill="currentColor"/>
</svg></div>
                        <span class="trigger-name">Hypotension</span>
                        <span class="trigger-arrow">›</span>
                    </div>
                    <div class="trigger-card" onclick="goToPage('page-hypoxia')">
                        <div class="trigger-icon"><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M23 6.00013C23 6.00004 23 6 24 6H24.1761C24.2533 6 24.3233 6 24.3868 6C25 6.00001 25 6.00005 25 6.00013V20.5C25 21.8977 25.5641 22.4421 26.0039 22.6987C26.053 22.7273 26.1024 22.7533 26.1516 22.777C26.1506 22.6568 26.1493 22.5316 26.1479 22.4019L26.1479 22.4003C26.1101 18.8716 26.0365 11.9997 31.4753 11.9997C38.9259 11.9997 44.2478 38.0062 41.0547 40.6599C37.8615 43.3136 31.4753 41.7214 28.2822 38.5369C25.7042 35.9659 25.9272 29.9583 26.0873 25.6457L26.0874 25.6443C26.0971 25.3819 26.1067 25.1258 26.1153 24.8771C25.79 24.7962 25.3959 24.6595 24.9962 24.4263C24.6398 24.2184 24.2975 23.9442 24 23.5919C23.7026 23.9442 23.3603 24.2184 23.0039 24.4263C22.6041 24.6595 22.2101 24.7962 21.8848 24.8771C21.8934 25.1261 21.9029 25.3826 21.9127 25.6453C22.0728 29.9579 22.2959 35.9662 19.7179 38.5372C16.5247 41.7217 10.1385 43.3139 6.94536 40.6602C3.75222 38.0065 9.07413 12 16.5247 12C21.9636 12 21.89 18.8717 21.8522 22.4003C21.852 22.4166 21.8518 22.4328 21.8516 22.4489C21.8504 22.5619 21.8493 22.6714 21.8484 22.777C21.8977 22.7534 21.9471 22.7274 21.9962 22.6987C22.436 22.4421 23 21.8977 23 20.5V6.00013ZM31.4753 13.9997C30.5212 13.9997 29.9843 14.3002 29.6086 14.6869C29.1752 15.1331 28.8132 15.8507 28.559 16.8646C28.1141 18.6395 28.133 20.6819 28.1483 22.3293C28.1509 22.6142 28.1534 22.8874 28.1534 23.1453C28.1534 23.9053 28.1196 24.8153 28.0845 25.7621C28.0707 26.1349 28.0566 26.5133 28.0443 26.8905C27.9996 28.2657 27.9741 29.7055 28.0405 31.0982C28.1072 32.4985 28.2642 33.7835 28.5573 34.8596C28.8538 35.9483 29.2509 36.6784 29.6944 37.1208C30.9726 38.3954 32.9908 39.4251 35.0492 39.8243C37.0842 40.2189 38.7224 39.9269 39.6818 39.1969C39.6868 39.1857 39.6923 39.1726 39.6984 39.1574C39.7576 39.0095 39.8294 38.7554 39.8878 38.3683C40.0047 37.5933 40.035 36.5122 39.9562 35.1803C39.7995 32.5305 39.2286 29.1689 38.3268 25.8606C37.4216 22.5396 36.2173 19.3998 34.8521 17.1383C34.1688 16.0062 33.4951 15.1786 32.8703 14.6535C32.2518 14.1337 31.7935 13.9997 31.4753 13.9997ZM16.5247 14C17.4788 14 18.0158 14.3005 18.3914 14.6872C18.8248 15.1334 19.1868 15.851 19.441 16.8649C19.8859 18.6399 19.867 20.6822 19.8518 22.3296C19.8491 22.6146 19.8466 22.8877 19.8466 23.1456C19.8466 23.9056 19.8804 24.8156 19.9155 25.7624C19.9294 26.135 19.9434 26.5138 19.9557 26.8908C20.0005 28.266 20.0259 29.7058 19.9596 31.0985C19.8929 32.4988 19.7359 33.7838 19.4427 34.8599C19.1462 35.9486 18.7492 36.6787 18.3056 37.1211C17.0275 38.3957 15.0093 39.4254 12.9509 39.8246C10.9159 40.2192 9.27768 39.9272 8.31823 39.1972C8.31326 39.186 8.3077 39.1729 8.30162 39.1577C8.24241 39.0098 8.17061 38.7557 8.11224 38.3686C7.99539 37.5936 7.965 36.5125 8.0438 35.1806C8.20056 32.5308 8.77147 29.1692 9.67324 25.8609C10.5785 22.5399 11.7827 19.4001 13.1479 17.1386C13.8313 16.0065 14.5049 15.1789 15.1298 14.6538C15.7482 14.134 16.2065 14 16.5247 14Z" fill="currentColor"/>
</svg></div>
                        <span class="trigger-name">Hypoxia</span>
                        <span class="beta-badge" style="font-size:8px; padding:1px 5px;">BETA</span>
                        <span class="trigger-arrow">›</span>
                    </div>
                    <div class="trigger-card" onclick="goToPage('page-gi-bleed')">
                        <div class="trigger-icon"><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M15.465 31.3984C15.2943 30.8716 14.7301 30.5833 14.2049 30.7545C13.6796 30.9257 13.3922 31.4915 13.5629 32.0183C14.3133 34.3348 15.7757 36.3536 17.7405 37.7853C19.7052 39.217 22.0714 39.9881 24.5 39.9881C25.0523 39.9881 25.5 39.5391 25.5 38.9852C25.5 38.4313 25.0523 37.9822 24.5 37.9822C22.4938 37.9822 20.5391 37.3452 18.916 36.1625C17.293 34.9798 16.0849 33.3121 15.465 31.3984Z" fill="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M24 4L23.3098 4.66019L23.3061 4.66378L23.2973 4.67225L23.2648 4.70364C23.2367 4.73093 23.1956 4.77088 23.1426 4.82301C23.0366 4.92726 22.8826 5.08027 22.6874 5.27825C22.297 5.67415 21.7417 6.25027 21.0763 6.9763C19.7465 8.42721 17.9719 10.4826 16.1951 12.8995C12.6815 17.6788 9 24.0808 9 30.0801C9 37.845 15.796 44 24 44C32.204 44 39 37.845 39 30.0801C39 24.0808 35.3185 17.6788 31.8049 12.8995C30.0281 10.4826 28.2535 8.42721 26.9237 6.9763C26.2583 6.25027 25.703 5.67415 25.3126 5.27825C25.1174 5.08027 24.9634 4.92726 24.8574 4.82301C24.8044 4.77088 24.7634 4.73093 24.7352 4.70364L24.7027 4.67225L24.6939 4.66378L24 4ZM22.5487 8.3338C23.1353 7.69375 23.6326 7.17503 24 6.8001C24.3674 7.17503 24.8647 7.69375 25.4513 8.3338C26.7465 9.74705 28.4719 11.746 30.1951 14.0899C33.6815 18.8321 37 24.7771 37 30.0801C37 36.5828 31.2599 41.9941 24 41.9941C16.7401 41.9941 11 36.5828 11 30.0801C11 24.7771 14.3185 18.8321 17.8049 14.0899C19.5281 11.746 21.2535 9.74705 22.5487 8.3338Z" fill="currentColor"/>
</svg></div>
                        <span class="trigger-name">GI Bleeding</span>
                        <span class="beta-badge" style="font-size:8px; padding:1px 5px;">BETA</span>
                        <span class="trigger-arrow">›</span>
                    </div>
                </div>

                <!-- Tools Section -->
                <div class="tools-section">
                    <button class="tools-link-btn" onclick="goToPage('page-tools')">
                        <span class="tools-link-icon"><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M29.0324 15.0927C28.1785 14.6817 27.1806 14.3314 26 14C27.1806 13.6686 28.1785 13.3183 29.0324 12.9073C30.8541 12.0305 32.0204 10.8775 32.9069 9.0427C33.3192 8.18948 33.6709 7.18884 34 6C34.3291 7.18884 34.6808 8.18948 35.0931 9.0427C35.9796 10.8775 37.1459 12.0305 38.9676 12.9073C39.8215 13.3183 40.8194 13.6686 42 14C40.8194 14.3314 39.8215 14.6817 38.9676 15.0927C37.1459 15.9695 35.9796 17.1225 35.0931 18.9573C34.6808 19.8105 34.3291 20.8112 34 22C33.6709 20.8112 33.3192 19.8105 32.9069 18.9573C32.0204 17.1225 30.8541 15.9695 29.0324 15.0927ZM32.7224 15.2394C32.2485 14.769 31.7324 14.3606 31.1735 14C31.7324 13.6394 32.2485 13.231 32.7224 12.7606C33.2076 12.279 33.6286 11.7522 34 11.1786C34.3714 11.7522 34.7924 12.279 35.2776 12.7606C35.7515 13.231 36.2676 13.6394 36.8265 14C36.2676 14.3606 35.7515 14.769 35.2776 15.2394C34.7924 15.721 34.3714 16.2478 34 16.8214C33.6286 16.2478 33.2076 15.721 32.7224 15.2394Z" fill="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.30387 29.0636C8.30249 28.6881 7.20569 28.3384 6 28C7.20569 27.6616 8.30249 27.3119 9.30387 26.9364C14.3869 25.0303 17.0111 22.4594 18.9365 17.3242C19.3134 16.3191 19.6635 15.2158 20 14C20.3365 15.2158 20.6866 16.3191 21.0635 17.3242C22.9889 22.4594 25.6131 25.0303 30.6961 26.9364C31.6975 27.3119 32.7943 27.6616 34 28C32.7943 28.3384 31.6975 28.6881 30.6961 29.0636C25.6131 30.9697 22.9889 33.5406 21.0635 38.6758C20.6866 39.6809 20.3365 40.7842 20 42C19.6635 40.7842 19.3134 39.6809 18.9365 38.6758C17.0111 33.5406 14.3869 30.9697 9.30387 29.0636ZM16.7074 31.2335C15.3644 29.9004 13.7907 28.8642 11.9422 28C13.7907 27.1358 15.3644 26.0996 16.7074 24.7665C18.0621 23.4217 19.1194 21.8372 20 19.9594C20.8806 21.8372 21.9379 23.4217 23.2926 24.7665C24.6356 26.0996 26.2093 27.1358 28.0578 28C26.2093 28.8642 24.6356 29.9004 23.2926 31.2335C21.9379 32.5783 20.8806 34.1628 20 36.0406C19.1194 34.1628 18.0621 32.5783 16.7074 31.2335Z" fill="currentColor"/>
</svg></span>
                        <span class="tools-link-text">Tools & Resources</span>
                        <span class="tools-link-arrow">›</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- SHOCKED? -->
        <div class="page" id="page-shock">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goHome()">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item current" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Is the patient shocked?</div>
                <div class="info-box" style="margin-bottom: 24px;">
                    <div class="info-box-title">Signs of inadequate perfusion</div>
                    <ul class="info-box-list">
                        <li>Patient symptomatic</li>
                        <li>Altered mental state</li>
                        <li>Cool peripheries / mottled skin</li>
                        <li>Cap refill >3 seconds</li>
                        <li>Oliguria</li>
                        <li>Lactate >2</li>
                    </ul>
                </div>
            </div>
            <div class="bottom-nav" style="flex-direction: column; gap: 8px;">
                <div style="display: flex; gap: 12px; width: 100%;">
                    <button class="choice-btn not-shocked" onclick="setShocked(false)" style="flex: 1;">
                        <span class="choice-btn-label">Not Shocked</span>
                        <span class="choice-btn-sub">Perfusing OK</span>
                    </button>
                    <button class="choice-btn shocked" onclick="setShocked(true)" style="flex: 1;">
                        <span class="choice-btn-label">Shocked</span>
                        <span class="choice-btn-sub">Signs present</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- NOT SHOCKED -->
        <div class="page" id="page-not-shocked">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-shock')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Pause and Assess</div>

                <div class="pearl-box">
                    <div class="pearl-icon">💡</div>
                    <div class="pearl-content">
                        <div class="pearl-text">Avoid reflexive fluids — not all hypotension needs fluid.</div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 20px;">Establish baseline</div>
                <div class="pause-list">
                    <div class="pause-item">
                        <div class="pause-item-title">What is their usual BP?</div>
                        <div class="pause-item-sub">Check previous observations & admission notes</div>
                    </div>
                    <div class="pause-item">
                        <div class="pause-item-title">Review the trend</div>
                        <div class="pause-item-sub">Is BP falling, stable, or rising? A single reading may not be actionable.</div>
                    </div>
                    <div class="pause-item">
                        <div class="pause-item-title">Check the measurement</div>
                        <div class="pause-item-sub">Cuff size, arm position, artefact.</div>
                        <div class="info-link" onclick="showBPInfo()" style="margin-top: 16px;">
                            <span>How automated BP machines work</span>
                            <span class="info-btn">ⓘ</span>
                        </div>
                    </div>
                    <div class="pause-item">
                        <div class="pause-item-title">Review medications</div>
                        <div class="pause-item-sub">New or recent antihypertensives, sedatives, opioids?</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-shock')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypo-ix')">Continue to assessment ›</button>
            </div>
        </div>

        <!-- IMMEDIATE ACTIONS -->
        <div class="page" id="page-actions">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-shock')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Immediate Actions</div>
                <div class="action-tiles">
                    <div class="action-tile">
                        <span class="action-tile-num">1</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 750 750" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="M713.737,514.877c1.523,0.019,2.982-0.85,3.734-2.166c0.979-1.715,0.567-4.128,0.567-5.988c0-6.69,0-13.382,0-20.072c0-2.755,0-5.512,0-8.268c0-0.928,0.061-1.878-0.048-2.802c-0.274-2.335-2.424-3.672-4.61-3.672c-1.989,0-3.979,0-5.97,0c-4.27,0-8.54,0-12.81,0c-6.323,0-12.646,0-18.971,0c-8.151,0-16.303,0-24.454,0c-9.754,0-19.506,0-29.259,0c-11.129,0-22.258,0-33.386,0c-12.278,0-24.557,0-36.834,0c-13.202,0-26.403,0-39.605,0c-13.899,0-27.798,0-41.697,0c-14.369,0-28.74,0-43.11,0c-14.615,0-29.23,0-43.847,0c-14.635,0-29.27,0-43.904,0c-14.428,0-28.855,0-43.283,0c-13.995,0-27.99,0-41.984,0c-13.337,0-26.673,0-40.009,0c-12.451,0-24.902,0-37.354,0c-11.34,0-22.68,0-34.02,0c-10.003,0-20.006,0-30.008,0c-8.44,0-16.88,0-25.319,0c-6.651,0-13.301,0-19.951,0c-4.635,0-9.271,0-13.905,0c-2.394,0-4.787,0-7.181,0c-1.899,0-3.746,0.461-4.684,2.335c-0.91,1.822-0.477,4.336-0.477,6.271c0,6.744,0,13.489,0,20.232c0,2.664,0,5.328,0,7.991c0,0.866-0.086,1.796,0.077,2.653c0.29,1.515,1.381,2.709,2.806,3.244c1.201,0.45,2.792,0.241,4.046,0.241c3.226,0,6.453,0,9.679,0c5.388,0,10.773,0,16.16,0c7.32,0,14.641,0,21.962,0c9.027,0,18.057,0,27.085,0c10.511,0,21.021,0,31.53,0c11.766,0,23.532,0,35.298,0c12.795,0,25.592,0,38.388,0c13.599,0,27.198,0,40.798,0c14.176,0,28.354,0,42.53,0c14.528,0,29.057,0,43.585,0c14.653,0,29.309,0,43.962,0c14.554,0,29.106,0,43.659,0c14.227,0,28.454,0,42.681,0c13.674,0,27.348,0,41.021,0c12.896,0,25.791,0,38.686,0c11.89,0,23.781,0,35.671,0c10.659,0,21.318,0,31.979,0c9.202,0,18.404,0,27.607,0c7.52,0,15.039,0,22.558,0c5.61,0,11.221,0,16.832,0c3.475,0,6.95,0,10.425,0C711.502,514.877,712.619,514.877,713.737,514.877z"/>
                                <path fill="currentColor" d="M676.354,399.251c0.209,2.977,3.429,4.859,6.128,3.596c1.9-0.891,2.291-2.678,2.746-4.551c0.509-2.083,0.81-4.231,1.478-6.272c0.292-0.893,0.67-1.873,1.409-2.496c1.216-1.216,3.43-0.35,4.684,0.315c1.664,0.883,3.117,2.176,4.039,3.829c0.731,1.312,1.124,2.777,1.511,4.22c0.691,2.585,1.323,5.187,1.978,7.781c1.043,4.136,1.887,8.286,2.149,12.553c0.276,4.482,0.072,8.996-0.396,13.458c-0.466,4.457-1.345,8.632-3.189,12.724c-3.03,6.721,0.398,14.476-1.34,21.426c-1.216,4.862-7.338,5.899-11.591,5.566c-4.444-0.349-8.752-1.849-13.009-3.077c-4.311-1.246-8.725-2.176-13.191-2.639c-1.74-0.181-3.648-0.464-5.396-0.289c-0.718,0.072-1.436,0.322-2.023,0.744c-0.729,0.521-1.053,1.139-1.504,1.862c-0.146,0.583-1.169,0.939-1.654,1.119c-2.723,1.004-5.912,0.01-8.708-0.113c-4.617-0.206-9.288,0.005-13.896,0.32c-4.702,0.324-9.36,0.845-14.031,1.479c-4.183,0.568-8.481,0.552-12.696,0.59c-10.322,0.09-20.635,0.219-30.955-0.006c-8.976-0.195-17.929-0.85-26.884-1.441c-10.508-0.693-21.012-1.442-31.53-1.947c-9.51-0.457-19.052-0.573-28.569-0.341c-10.035,0.245-19.975,1.268-29.952,2.304c-8.93,0.926-17.875,1.453-26.855,1.494c-8.162,0.037-16.321-0.093-24.481-0.179c-13.795-0.144-27.59-0.288-41.384-0.433c-3.889-0.04-7.777-0.081-11.666-0.121c-0.564-0.007-1.132-0.037-1.689,0.072c-0.722,0.143-1.252,0.557-1.912,0.83c-0.85,0.352-1.902,0.337-2.799,0.337c-2.454,0-4.909-0.136-7.362-0.216c-4.654-0.153-9.321-0.18-13.979-0.121c-4.801,0.06-9.602,0.281-14.403,0.163c-4.852-0.119-9.686-0.578-14.522-0.972c-4.539-0.368-9.014-0.763-13.572-0.553c-1.177,0.055-2.352,0.141-3.526,0.22c-0.996,0.069-1.941,0.377-2.92,0.576c-2.083,0.421-4.208,0.615-6.328,0.707c-9.504,0.411-19.026-0.838-28.526-1.033c-4.958-0.103-9.917-0.138-14.877-0.175c-1.002-0.007-1.941,0.214-2.968,0.17c-2.426-0.104-4.845-0.201-7.273-0.191c-9.396,0.037-18.751,1.297-28.156,0.857c-4.607-0.216-9.211-0.784-13.827-0.65c-4.755,0.137-9.471,0.479-14.231,0.33c-4.13-0.129-8.918-0.129-12.805-1.701c-2.316-0.938-4.277-3.025-6.909-3.087c-1.079-0.026-2.329,0.242-3.317,0.674c-0.75,0.328-1.201,0.941-1.848,1.403c-0.742,0.529-1.646,0.685-2.535,0.773c-2.229,0.223-4.507,0.335-6.742,0.443c-3.877,0.188-7.959-0.596-11.747,0.457c-1.597,0.443-3.087,1.084-4.74,1.304c-2.021,0.27-4.069,0.191-6.102,0.096c-2.186-0.104-4.356-0.212-6.544-0.065c-2.477,0.165-4.962,0.396-7.446,0.404c-2.754,0.008-5.221-0.373-7.566-1.854c-1.552-0.979-3.224-1.947-4.667-3.081c-0.527-0.414-1.031-0.908-1.276-1.545c-0.359-0.937-0.153-1.986-0.206-2.962c-0.054-0.992-0.41-1.755-0.943-2.586c-0.432-0.675-0.958-1.381-1.012-2.208c-0.062-0.969,0.46-1.873,0.602-2.814c0.313-2.079-1.271-3.913-1.057-6.05c0.213-2.122,1.765-3.679,2.176-5.736c0.383-1.911,0.777-3.808,1.176-5.717c0.245-1.175,0.344-2.331,0.253-3.527c-0.151-1.997-1.064-4.432,0.422-6.121c0.719-0.817,1.358-1.447,1.688-2.519c0.326-1.057,0.313-2.165,0.111-3.244c-0.346-1.84-0.831-3.484,0.703-4.9c1.028-0.95,2.274-1.598,3.639-1.918c1.051-0.247,2.146-0.265,3.212-0.112c1.261,0.181,2.475,0.698,3.752,0.743c1.872,0.067,3.633-1.383,5.457-0.897c1.559,0.414,3.312,0.11,4.681-0.754c1.985-1.254,3.339-3.157,5.7-3.813c2.316-0.644,4.26-0.228,6.514,0.29c1.502,0.344,2.714-0.357,3.885-1.257c0.96-0.738,1.897-1.6,2.604-2.589c1.163-1.628,2.323-3.2,3.586-4.759c1.037-1.281,1.832-2.551,3.582-1.704c1.724,0.834,1.855,2.795,2.779,4.258c0.738,1.169,2.732,1.126,3.881,0.634c0.665-0.284,0.878-0.62,1.594-0.344s1.214,0.747,2.007,0.542c0.757-0.197,1.323-0.652,2.131-0.679c0.828-0.028,1.522,0.267,2.258,0.618c1.846,0.884,3.991-0.425,5.911-0.52c1.873-0.093,3.569,0.461,4.666,2.047c1.618,2.34,2.074,5.549,2.214,8.315c0.116,2.286,0.049,4.59,0.276,6.868c0.076,0.758,0.288,1.483,0.711,2.125c0.817,1.239,2.265,1.979,3.747,1.92c2.137-0.085,3.351-1.786,4.844-3.094c6.875-6.022,15.225-10.04,23.897-12.754c8.832-2.762,18.144-4.052,27.382-4.171c9.446-0.123,18.672,1.464,28.05,2.283c4.233,0.37,8.341-0.516,12.556-0.7c4.5-0.197,9.03-0.065,13.51,0.416c4.765,0.51,9.511,1.169,14.264,1.775c3.308,0.422,6.615,0.845,9.923,1.267c1.322,0.169,2.676,0.447,4.011,0.495c1.797,0.065,2.738-1.052,4.127-1.95c1.881-1.218,4.056-1.103,6.151-1.697c1.258-0.358,2.325-1.142,3.554-1.571c0.853-0.298,1.765-0.4,2.664-0.419c1.142-0.023,1.924-0.176,3.003-0.543c1.714-0.582,3.476-0.771,5.212-1.233c2.289-0.609,4.025-2.129,6.502-1.844c1.758,0.203,3.569,0.599,5.264,1.117c1.203,0.369,2.16,0.986,3.252,1.597c1.309,0.73,2.802,1.16,4.005,2.073c0.867,0.657,1.395,1.624,2.161,2.383c0.838,0.828,1.881,1.455,2.931,1.977c0.823,0.408,1.833,0.589,2.557,1.169c1.136,0.908,1.168,2.593,2.252,3.599c1.035,0.961,2.617,1.421,3.994,1.016c1.645-0.483,3.648-1.513,5.27-0.552c2.118,1.255,4.563,0.449,6.871,0.196c9.766-1.072,19.563-1.599,29.375-2.013c9.655-0.408,19.33-0.428,28.991-0.403c9.407,0.023,18.859,0.42,28.225,1.329c9.884,0.96,19.663,2.422,29.438,4.151c9.324,1.651,18.573,3.773,27.839,5.724c9.689,2.04,19.357,4.241,29.114,5.943c9.642,1.683,19.262,2.077,29.024,2.406c4.308,0.146,8.625,0.438,12.89,1.074c4.64,0.693,9.26,1.463,13.932,1.914c9.615,0.928,19.244,1.069,28.894,0.683c2.223-0.089,4.446-0.219,6.659-0.448c2.209-0.229,4.366-0.729,6.562-1.034c1.826-0.255,3.72-0.507,5.566-0.375c0.694,0.05,1.339,0.292,2.026,0.355c2.561,0.234,4.967-2.009,6.78-3.499c3.164-2.602,5.947-5.722,8.256-9.101c5.311-7.773,7.777-17.095,10.315-26.043c0.777-2.741,2.866-10.617,7.407-8.844c0.964,0.376,1.594,1.273,2.022,2.179C675.905,393.363,676.146,396.422,676.354,399.251z"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Lie flat</div>
                                <div class="action-tile-sub">If safe & no respiratory compromise</div>
                            </div>
                        </div>
                    </div>
                    <div class="action-tile">
                        <span class="action-tile-num">2</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m509.804688 87.050781-21.210938-21.210937c-.007812-.007813-63.640625-63.640625-63.640625-63.640625-2.929687-2.929688-7.679687-2.933594-10.609375 0l-21.214844 21.210937c-1.40625 1.40625-2.195312 3.3125-2.195312 5.304688 0 1.988281.789062 3.894531 2.195312 5.300781l5.304688 5.304687-52.050782 52.046876c-12.855468 1.34375-24.921874 6.304687-35 14.390624l-79.847656-79.847656c-1.410156-1.410156-3.316406-2.199218-5.304687-2.199218-1.992188 0-3.898438.789062-5.304688 2.199218l-50.535156 50.535156c-14.621094 14.621094-14.621094 38.410157 0 53.03125l81.574219 81.574219-8.582032 25.746094-51.777343 51.78125c-1.40625 1.40625-2.199219 3.3125-2.199219 5.300781 0 1.988282.792969 3.898438 2.199219 5.304688l5.300781 5.300781-194.710938 194.714844c-2.925781 2.925781-2.925781 7.675781 0 10.605469 1.464844 1.464843 3.382813 2.195312 5.304688 2.195312 1.917969 0 3.839844-.730469 5.304688-2.195312l194.710937-194.714844 5.304687 5.304687c1.460938 1.464844 3.382813 2.195313 5.300782 2.195313 1.917968 0 3.839844-.730469 5.304687-2.195313l51.78125-51.78125 30.140625-10.046875c.042969-.015625.085938-.035156.132813-.054687.1875-.066407.375-.140625.558593-.222657.070313-.03125.144532-.0625.214844-.097656.179688-.089844.355469-.183594.53125-.285156.0625-.039062.128906-.078125.195313-.117188.175781-.113281.351562-.238281.519531-.367187.054688-.039063.105469-.074219.15625-.113281.214844-.171875.425781-.355469.625-.554688.003906-.003906 32.042969-32.046875 32.042969-32.046875 4.296875.847657 8.710937 1.28125 13.1875 1.28125 15.503906 0 30.203125-5.203125 42.125-14.765625l74.546875 74.546875-45.234375 45.230469c-8.769531 8.773438-23.046875 8.773438-31.816407 0l-63.640624-63.636719c-2.929688-2.929687-7.675782-2.929687-10.605469 0-2.929688 2.925781-2.929688 7.675781 0 10.605469l63.640625 63.640625c7.308594 7.308594 16.910156 10.964844 26.515625 10.964844 9.601562 0 19.207031-3.65625 26.515625-10.96875l50.535156-50.535157c2.929688-2.929687 2.929688-7.675781 0-10.605468l-79.851562-79.851563c8.246093-10.300781 13.023437-22.476562 14.347656-34.953125l52.09375-52.09375 5.300781 5.300782c1.464844 1.464843 3.386719 2.199218 5.304687 2.199218 1.917969 0 3.839844-.734375 5.304688-2.199218l21.214844-21.210938c2.925781-2.925781 2.925781-7.675781-.003906-10.605469zm-58.339844-15.910156 10.609375-10.605469 10.605469 10.605469-10.605469 10.605469zm0-21.214844-10.605469 10.609375-10.605469-10.609375 10.605469-10.605469zm-31.816406-31.816406 10.605468 10.605469-10.605468 10.605468-5.289063-5.289062c-.03125-.027344-5.320313-5.316406-5.320313-5.316406zm-238.648438 68.941406 45.230469-45.230469 74.546875 74.546876c-12.714844 15.890624-17.199219 36.238281-13.449219 55.269531l-26.78125 26.78125-79.550781-79.546875c-8.769532-8.773438-8.769532-23.046875.003906-31.820313zm108.089844 161.125-15.910156 5.300781-14.65625-14.65625 5.300781-15.910156zm-70.96875 56.308594-5.292969-5.292969c-.019531-.019531-5.3125-5.3125-5.3125-5.3125l42.425781-42.425781 10.605469 10.605469zm84.855468-63.640625-31.820312-31.816406 21.449219-21.453125c3.214843 6.746093 7.597656 13.066406 13.171875 18.644531 5.507812 5.503906 11.800781 9.9375 18.621094 13.203125zm37.140626-31.578125c-8.914063-2.34375-17.0625-6.984375-23.730469-13.652344-20.46875-20.46875-20.46875-53.777343 0-74.246093 9.917969-9.914063 23.101562-15.375 37.121093-15.375 14.023438 0 27.207032 5.460937 37.125 15.375 20.46875 20.46875 20.46875 53.777343 0 74.246093-9.917968 9.917969-23.101562 15.378907-37.125 15.378907-4.582031 0-9.070312-.59375-13.390624-1.726563zm79.574218-63.921875c-2.5-12.679688-8.648437-24.777344-18.449218-34.582031-9.585938-9.582031-21.542969-15.925781-34.546876-18.488281l42.34375-42.347657 47.722657 47.722657c.015625.015624 5.3125 5.3125 5.3125 5.3125zm63.59375-42.382812-5.296875-5.296876c-.007812-.011718-5.308593-5.308593-5.308593-5.308593l10.609374-10.605469 10.605469 10.605469zm0 0"/>
                                <path fill="currentColor" d="m380.027344 131.972656c-7.082032-7.082031-16.5-10.980468-26.519532-10.980468-10.015624 0-19.433593 3.898437-26.515624 10.980468-14.621094 14.621094-14.621094 38.414063 0 53.035156 7.082031 7.082032 16.5 10.984376 26.515624 10.984376 10.019532 0 19.4375-3.902344 26.519532-10.984376 14.621094-14.621093 14.621094-38.414062 0-53.035156zm-10.609375 42.429688c-4.25 4.25-9.898438 6.589844-15.910157 6.589844-6.007812 0-11.65625-2.339844-15.90625-6.589844-8.773437-8.773438-8.773437-23.046875 0-31.820313 4.25-4.25 9.898438-6.589843 15.90625-6.589843 6.011719 0 11.660157 2.339843 15.910157 6.589843 8.773437 8.773438 8.773437 23.046875 0 31.820313zm0 0"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Large bore IV access</div>
                                <div class="action-tile-sub">IO if access difficult & in extremis</div>
                            </div>
                            <div class="action-tile-links">
                                <button class="action-tile-link" onclick="event.stopPropagation();showCannula()">Does size matter?</button>
                            </div>
                        </div>
                    </div>
                    <div class="action-tile">
                        <span class="action-tile-num">3</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m324.669 146.367c-20.595 0-39.808 6.033-55.964 16.425v-89.301h14.73c5.523 0 10-4.477 10-10v-53.491c0-5.523-4.477-10-10-10h-189.839c-5.523 0-10 4.477-10 10v53.491c0 5.523 4.477 10 10 10h14.73v359.158c0 43.754 35.973 79.351 80.189 79.351s80.189-35.597 80.189-79.351v-95.237c16.156 10.392 35.369 16.425 55.964 16.425 57.2 0 103.735-46.535 103.735-103.735s-46.534-103.735-103.734-103.735zm-196.343 4.047h120.379v22.866h-120.379zm-24.73-130.414h169.839v33.491h-169.839zm145.109 53.491v56.923h-120.379v-56.923zm0 359.158c0 32.726-27.001 59.351-60.189 59.351s-60.189-26.624-60.189-59.351v-30.422h54.346c5.523 0 10-4.477 10-10v-25.919c0-5.523-4.477-10-10-10s-10 4.477-10 10v15.919h-44.346v-139.263h44.346v32.932c0 5.523 4.477 10 10 10s10-4.477 10-10v-42.932c0-5.523-4.477-10-10-10h-54.346v-29.684h109.591c-10.734 16.332-16.983 35.861-16.983 56.823 0 27.233 10.548 52.048 27.774 70.575-.001.065-.003.13-.003.195v111.776zm75.964-98.812c-46.172 0-83.735-37.564-83.735-83.735 0-46.172 37.564-83.735 83.735-83.735 46.172 0 83.735 37.564 83.735 83.735 0 46.172-37.563 83.735-83.735 83.735z"/>
                                <path fill="currentColor" d="m331.71 188.676c-3.854-3.656-9.895-3.661-13.755-.009-4.276 4.046-41.778 40.485-41.778 73.549 0 26.827 21.825 48.652 48.651 48.652 26.827 0 48.652-21.825 48.652-48.652 0-32.965-37.494-69.484-41.77-73.54zm-6.882 102.192c-15.798 0-28.651-12.853-28.651-28.652 0-16.908 16.995-39.19 28.644-51.947 11.655 12.784 28.659 35.094 28.659 51.947 0 15.799-12.853 28.652-28.652 28.652z"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Send blood gas</div>
                            </div>
                        </div>
                    </div>
                    <div class="action-tile">
                        <span class="action-tile-num">4</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m416.814 89.9h-7.921v-6.942a41.56 41.56 0 0 0 -19.175-34.992v-12.446a6 6 0 0 0 -6-6h-20a6 6 0 0 0 -6 6v7a24.977 24.977 0 0 0 -9.378 3.48v-15.249c0-8.075-6.439-16-13-16h-241.554c-13.055 0-19 8.294-19 16v32.391a4.689 4.689 0 1 1 -9.378 0v-27.622a6 6 0 0 0 -6-6h-20a6 6 0 0 0 -6 6v27.622a36.689 36.689 0 1 0 73.378 0v-16.391h88.777v445.049a6 6 0 0 0 6 6h20a6 6 0 0 0 6-6v-445.049h88.777v16.391a36.543 36.543 0 0 0 9.474 24.577l.025 2.183h-8.35a56.063 56.063 0 0 0 -56 56v196.344a56.063 56.063 0 0 0 56 56h19.268v10.763a18.02 18.02 0 0 0 -11.8 17.125c0 9.956 7.729 18.055 17.228 18.055h9.515v21.611a6 6 0 0 0 6 6h19.251a6 6 0 0 0 6-6v-21.612h9.522c9.5 0 17.227-8.1 17.227-18.055a18 18 0 0 0 -12.155-17.254v-10.633h19.269a56.063 56.063 0 0 0 56-56v-196.346a56.063 56.063 0 0 0 -56-56zm-27.114-26.237a29.431 29.431 0 0 1 7.193 19.3v6.937h-9.41l.016-6.93v-.014a20.074 20.074 0 0 0 -.749-5.372 36.612 36.612 0 0 0 2.95-13.921zm-19.982 5.48v-27.623h8v21.622a24.711 24.711 0 0 1 -18.564 23.914v-4.1a8.2 8.2 0 0 1 5.969-7.872c3.877-1.084 4.596-5.942 4.596-5.942zm-12.051-14.115v10.239a20.25 20.25 0 0 0 -10.512 17.691v6.942h-9.315l-.08-6.944a29.762 29.762 0 0 1 19.907-27.928zm-35.327-20.277h-100.777a6 6 0 0 0 -6 6v445.049h-8v-445.049a6 6 0 0 0 -6-6h-100.777a6 6 0 0 0 -6 6v22.391a24.689 24.689 0 1 1 -49.378 0v-21.622h8v21.622a16.689 16.689 0 1 0 33.378 0v-32.391c0-3.711 5.357-4 7-4h240.687a5.787 5.787 0 0 1 1.867 4v24.549a41.68 41.68 0 0 0 -7.6 12.254 24.714 24.714 0 0 1 -.4-4.413v-22.39a6 6 0 0 0 -6-6zm48.612 425.049h-7.252v-15.612h7.251zm26.748-33.667c0 3.339-2.345 6.055-5.227 6.055h-50.3c-2.883 0-5.228-2.716-5.228-6.055s2.345-6.055 5.228-6.055h50.3c2.883 0 5.227 2.716 5.227 6.055zm-48.945-18.055v-9.833h36.79v9.833zm112.059-227.892h-40.352v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v2.64a44.05 44.05 0 0 1 -44 44h-99.327a44.05 44.05 0 0 1 -44-44v-196.346a44.05 44.05 0 0 1 44-44h99.326a44.05 44.05 0 0 1 44 44z"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Fluid bolus</div>
                            </div>
                            <div class="action-tile-links">
                                <button class="action-tile-link" onclick="event.stopPropagation();showFluids()">Which fluid?</button>
                                <button class="action-tile-link" onclick="event.stopPropagation();showFluidCaution()">When NOT to give</button>
                            </div>
                        </div>
                    </div>
                    <div class="action-tile">
                        <span class="action-tile-num">5</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m37.78 6.93-1.43-4.55c-.26-.83-1.01-1.38-1.88-1.38h-4.94c-.87 0-1.62.56-1.88 1.38l-1.44 4.55c-.03.1-.05.2-.05.3v.1h-13.58c-2.16 0-3.91 1.75-3.91 3.91v47.85c0 2.16 1.75 3.91 3.91 3.91h38.81c2.16 0 3.91-1.75 3.91-3.91v-47.85c0-2.16-1.75-3.91-3.91-3.91h-13.58v-.1c0-.1-.02-.2-.05-.3zm-9.61.45 1.36-4.38 4.91-.02 1.39 4.4v1.52c0 .53.42.97.95 1 4.7.24 6.71.75 7.22 1.02.01.03.02.05.03.08l.67 1.37h-25.42l.67-1.37s.02-.05.03-.08c.52-.28 2.52-.78 7.23-1.03.53-.03.95-.47.95-1v-1.53zm18.65 6.3c.08-.13.13-.28.17-.43 0-.02.02-.03.02-.05h2.43v43.91h-34.88v-43.9h2.43s.02.03.02.05c.04.15.09.3.17.43.27.43.73.69 1.24.69h27.15c.51 0 .98-.26 1.25-.7zm4.58-4.35c1.05 0 1.91.86 1.91 1.91v47.85c0 1.05-.86 1.91-1.91 1.91h-38.81c-1.05 0-1.91-.86-1.91-1.91v-47.85c0-1.05.86-1.91 1.91-1.91h6.17s-.03.02-.04.03c-.08.06-.16.12-.22.18-.01.01-.03.02-.04.04-.07.07-.13.14-.18.22-.01.02-.02.04-.03.05-.03.06-.06.12-.09.17 0 .02-.02.04-.02.06-.02.07-.04.15-.05.22l-.45.91h-4.07c-.55 0-1 .45-1 1v45.91c0 .55.45 1 1 1h36.87c.55 0 1-.45 1-1v-45.91c0-.55-.45-1-1-1h-4.08l-.45-.91c-.01-.07-.03-.15-.05-.22 0-.02-.02-.04-.02-.06-.02-.06-.05-.12-.09-.17-.01-.02-.02-.04-.03-.06-.05-.07-.11-.14-.18-.22-.01-.01-.03-.03-.05-.04-.06-.06-.14-.12-.22-.17-.02-.01-.03-.02-.04-.03h6.18z"/>
                                <path fill="currentColor" d="m26.34 27.15h2.71v2.71c0 .86.7 1.55 1.55 1.55h2.8c.86 0 1.55-.7 1.55-1.55v-2.71h2.71c.86 0 1.55-.7 1.55-1.55v-2.8c0-.86-.7-1.55-1.55-1.55h-2.71v-2.71c0-.86-.7-1.55-1.55-1.55h-2.8c-.86 0-1.55.7-1.55 1.55v2.71h-2.71c-.86 0-1.55.7-1.55 1.55v2.8c0 .86.7 1.55 1.55 1.55zm.45-3.9h3.27c.55 0 1-.45 1-1v-3.27h1.9v3.27c0 .55.45 1 1 1h3.27v1.9h-3.27c-.55 0-1 .45-1 1v3.27h-1.9v-3.27c0-.55-.45-1-1-1h-3.27z"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Chart review</div>
                                <div class="action-tile-sub">Hold/review antihypertensives</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-shock')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypo-ix')">Next ›</button>
            </div>
        </div>

        <!-- NEW HYPO FLOW: INVESTIGATIONS -->
        <div class="page" id="page-hypo-ix">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-actions')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Investigations</div>
                <div class="page-subtitle" style="color: var(--text2); font-size: 14px; margin-top: -8px; margin-bottom: 16px;">Order while continuing assessment</div>

                <div class="ix-card">
                    <div class="ix-icon">
                        <svg viewBox="0 0 128 128" fill="currentColor" style="width:28px;height:28px;color:var(--red);">
                            <path d="M115,21H13c-5,0-9-3.74-9-8.33A8.68,8.68,0,0,1,12.67,4H62L58.4,8.8a2,2,0,0,0,.32,2.74l6,5a2,2,0,1,0,2.56-3.08L62.74,9.68,67.6,3.2A2,2,0,0,0,66,0H12.67A12.68,12.68,0,0,0,0,12.67V73c0,6.73,5.71,12,13,12H115c4.47,0,9,2.75,9,8s-4.53,8-9,8H38a13,13,0,0,0-9,3.81V91a2,2,0,0,0-4,0v23c0,7.33,6.2,14,13,14H88.83a2,2,0,0,0,1.43-3.4l-5.54-5.67,5.78-6.61a2,2,0,0,0-3-2.64l-7,8a2,2,0,0,0,.07,2.72l3.52,3.6H38c-4.63,0-9-4.86-9-10a9.24,9.24,0,0,1,9-9h77c7.41,0,13-5.16,13-12V34A13.35,13.35,0,0,0,115,21ZM4,21.56A13.34,13.34,0,0,0,13,25H115a9.24,9.24,0,0,1,9,9V56.84A12.9,12.9,0,0,0,115,53h-5.24A8.07,8.07,0,0,0,105,51a8.07,8.07,0,0,0-4.76,2H98a2,2,0,0,0-1.92,1.45L94.49,60,90,33.66A2,2,0,0,0,88,32h0a2,2,0,0,0-2,1.58L81.79,53.16A2.14,2.14,0,0,0,81,53H78.76A8.07,8.07,0,0,0,74,51a8.07,8.07,0,0,0-4.76,2H53.76A8.07,8.07,0,0,0,49,51a8.07,8.07,0,0,0-4.76,2H42a2,2,0,0,0-1.92,1.45L38.49,60,34,33.66A2,2,0,0,0,32,32a2,2,0,0,0-2,1.58l-4.2,19.61A1.88,1.88,0,0,0,25,53H22.8A7.67,7.67,0,0,0,18,51a7.67,7.67,0,0,0-4.8,2H13c-5,0-9-3.73-9-8.31ZM124,84.18A13.64,13.64,0,0,0,115,81H13c-4.42,0-9-3-9-8V53.55H4A13.34,13.34,0,0,0,13,57h1a2,2,0,0,0,1.48-.66A4.34,4.34,0,0,1,18,55a4.31,4.31,0,0,1,2.52,1.34A2,2,0,0,0,22,57h2.09l1.41,1.61a2,2,0,0,0,3.46-.9l2.82-13.15L36,69.34a2,2,0,0,0,3.89.21L43.51,57H45a2,2,0,0,0,1.41-.58A5,5,0,0,1,49,55a5,5,0,0,1,2.59,1.41A2,2,0,0,0,53,57H70a2,2,0,0,0,1.41-.58A5,5,0,0,1,74,55a5,5,0,0,1,2.59,1.41A2,2,0,0,0,78,57h2.17l1.42,1.41a2,2,0,0,0,3.36-1l2.82-12.94L92,69.34A2,2,0,0,0,93.89,71H94a2,2,0,0,0,1.92-1.45L99.51,57H101a2,2,0,0,0,1.41-.58A5,5,0,0,1,105,55a5,5,0,0,1,2.59,1.41A2,2,0,0,0,109,57h6a9.4,9.4,0,0,1,9,9.09Z"/>
                        </svg>
                    </div>
                    <div class="ix-text">
                        <div class="ix-title-row">
                            <span class="ix-title">ECG</span>
                            <button class="ix-btn" onclick="showECGChoices()">What to look for ›</button>
                        </div>
                        <div class="ix-hint">Rhythm, ischaemia, RV strain</div>
                    </div>
                </div>

                <div class="ix-card">
                    <div class="ix-icon">
                        <svg viewBox="0 0 43.3492 43.3492" fill="currentColor" style="width:28px;height:28px;color:var(--red);">
                            <path d="m29.5247 11.9269c.2672-.4628.1087-1.0546-.3541-1.3218s-1.0546-.1087-1.3218.3541l-7.51 13.0077c-.2672.4628-.1086 1.0546.3542 1.3218s1.0546.1086 1.3218-.3542zm-18.4508 6.0169c-.2672.4629-.1086 1.0547.3542 1.3219s1.0546.1086 1.3218-.3542l7.2181-12.5022c.2672-.4628.1086-1.0546-.3542-1.3218s-1.0546-.1086-1.3218.3542z"/>
                            <rect height="16.16" rx="1.327" transform="matrix(.292 .169 -.169 .292 18.926 -.487)" width="52.775"/>
                            <path d="m13.5899 15.8629 3.1339 1.8093-.7647 1.3306-3.1339-1.8094z"/>
                            <path d="m15.0952 13.2608 1.9745 1.14-.7706 1.3305-1.9746-1.14z"/>
                            <path d="m16.5945 10.6587 3.1339 1.8093-.7646 1.3306-3.1339-1.8093z"/>
                            <path d="m13.2522 40.1117 8.7626-15.1772c-1.2481-.7206-2.2044-1.9466-3.4525-2.6672-1.248-.7205-2.7879-.9357-4.036-1.6563s-2.2044-1.9466-3.4524-2.6672l-9.0544 15.6827c-1.7834 3.089-.7153 7.0754 2.3738 8.8589 3.089 1.7834 7.0755.7152 8.8589-2.3737z"/>
                            <path d="m38.6882 10.6119c-2.1815 2.6248-3.1873 4.778-3.4397 6.4596-.4585 3.0539 1.5674 4.5527 3.5475 4.4964 1.8968-.054 3.7517-1.5355 3.3395-4.4442-.2393-1.6892-1.2431-3.8598-3.4473-6.5118z"/>
                        </svg>
                    </div>
                    <div class="ix-text">
                        <div class="ix-title">Bloods</div>
                        <div class="ix-hint">Including blood gas, coags, group & hold</div>
                    </div>
                </div>

                <div class="ix-card">
                    <div class="ix-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <ellipse cx="12" cy="11" rx="4" ry="5"/>
                            <line x1="8" y1="18" x2="16" y2="18"/>
                            <line x1="8" y1="6" x2="10" y2="6"/>
                            <line x1="14" y1="6" x2="16" y2="6"/>
                        </svg>
                    </div>
                    <div class="ix-text">
                        <div class="ix-title">Mobile CXR</div>
                        <div class="ix-hint">Pneumothorax, oedema, widened mediastinum</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-actions')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypo-killers')">Next ›</button>
            </div>
        </div>

        <!-- NEW HYPO FLOW: RULE OUT KILLERS -->
        <div class="page" id="page-hypo-killers">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-ix')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Quickly consider time-critical diagnoses</div>

                <div class="killer-list">
                    <div class="killer-card">
                        <div class="killer-card-name">Cardiac tamponade</div>
                        <div class="killer-card-clue">↓BP, ↑JVP, muffled heart sounds</div>
                    </div>
                    <div class="killer-card">
                        <div class="killer-card-name">Tension pneumothorax</div>
                        <div class="killer-card-clue">Absent breath sounds, tracheal deviation, hypoxia</div>
                    </div>
                    <div class="killer-card">
                        <div class="killer-card-name">Anaphylaxis</div>
                        <div class="killer-card-clue">Urticaria, angioedema, wheeze, recent exposure</div>
                    </div>
                    <div class="killer-card">
                        <div class="killer-card-name">Unstable arrhythmia</div>
                        <div class="killer-card-clue">VT, fast AF, complete heart block</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypo-ix')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypo-history')">Next ›</button>
            </div>
        </div>

        <!-- NEW HYPO FLOW: HISTORY -->
        <div class="page" id="page-hypo-history">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-killers')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="assess-top-row">
                    <div class="assess-top-left">
                        <div class="page-title">History</div>
                        <div class="section-label">ONSET</div>
                        <div class="onset-toggle">
                            <button class="onset-btn compact" id="btn-onset-sudden" onclick="setHypoOnset('sudden')">Sudden</button>
                            <button class="onset-btn compact" id="btn-onset-progressive" onclick="setHypoOnset('progressive')">Progressive</button>
                        </div>
                    </div>
                    <div class="ddx-box" id="shock-ddx-box">
                        <div class="ddx-label">DDX</div>
                        <div class="ddx-item">Distributive</div>
                        <div class="ddx-item">Hypovolaemic</div>
                        <div class="ddx-item">Cardiogenic</div>
                        <div class="ddx-item">Obstructive</div>
                        <div class="ddx-item">Endocrine</div>
                    </div>
                </div>

                <div class="section-label">ASK ABOUT</div>
                <div class="history-prompts">
                    <div class="history-prompt">Fever, rigors, focal infective symptoms</div>
                    <div class="history-prompt">Haematemesis, melaena, diarrhoea, poor intake</div>
                    <div class="history-prompt">Chest pain, dyspnoea, cardiac history</div>
                    <div class="history-prompt">Immobility, recent surgery, malignancy</div>
                    <div class="history-prompt">Trauma, recent procedure or instrumentation</div>
                    <div class="history-prompt">Recent drug or allergen exposure</div>
                    <div class="history-prompt">Steroid use, adrenal or thyroid disease</div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypo-killers')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypo-exam')">Next ›</button>
            </div>
        </div>

        <!-- NEW HYPO FLOW: EXAM -->
        <div class="page" id="page-hypo-exam">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-history')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Examination</div>

                <div class="assess-top-row">
                    <div class="abcde-card">
                        <div class="abcde-header">
                            <span class="abcde-badge">A</span>
                            <span class="abcde-title">Airway</span>
                        </div>
                        <div class="abcde-items">
                            <div class="abcde-item">Patent?</div>
                            <div class="abcde-item">Stridor?</div>
                            <div class="abcde-item">Angioedema?</div>
                        </div>
                    </div>
                    <div class="ddx-box" id="shock-ddx-box-exam">
                        <div class="ddx-label">DDX</div>
                        <div class="ddx-item">Distributive</div>
                        <div class="ddx-item">Hypovolaemic</div>
                        <div class="ddx-item">Cardiogenic</div>
                        <div class="ddx-item">Obstructive</div>
                        <div class="ddx-item">Endocrine</div>
                    </div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">B</span>
                        <span class="abcde-title">Breathing</span>
                    </div>
                    <div class="abcde-items">
                        <div class="abcde-item-row">
                            <span>Respiratory distress or hypoxia?</span>
                            <div class="toggle-btns">
                                <button class="toggle-btn" id="resp-distress-no" onclick="setHypoRespiratory('none')">No</button>
                                <button class="toggle-btn" id="resp-distress-yes" onclick="setHypoRespiratory('distress')">Yes</button>
                            </div>
                        </div>
                        <div class="abcde-item">SpO₂</div>
                        <div class="abcde-item-row">
                            <span>Respiratory rate</span>
                            <button class="count-btn" onclick="openRRModal()">Count RR</button>
                        </div>
                        <div class="abcde-item">Work of breathing (tripoding, recession, accessory muscles)</div>
                        <div class="abcde-item">Auscultation (crackles, wheeze, reduced breath sounds)</div>
                    </div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">C</span>
                        <span class="abcde-title">Circulation</span>
                    </div>
                    <div class="abcde-items">
                        <div class="abcde-item-row">
                            <span>Peripheries</span>
                            <div class="toggle-btns">
                                <button class="toggle-btn" id="btn-periph-warm" onclick="setHypoPeripheries('warm')">Warm</button>
                                <button class="toggle-btn" id="btn-periph-cool" onclick="setHypoPeripheries('cool')">Cool</button>
                            </div>
                        </div>
                        <div class="abcde-item">Heart rate, rhythm, and blood pressure</div>
                        <div class="abcde-item">Murmur</div>
                    </div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">D</span>
                        <span class="abcde-title">Disability</span>
                    </div>
                    <div class="abcde-items">
                        <div class="abcde-item">Conscious state</div>
                        <div class="abcde-item">Pupils</div>
                        <div class="abcde-item">BSL</div>
                    </div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">E</span>
                        <span class="abcde-title">Exposure</span>
                    </div>
                    <div class="abcde-items">
                        <div class="abcde-item">Temperature</div>
                        <div class="abcde-item">Rash</div>
                        <div class="abcde-item">Abdomen</div>
                        <div class="abcde-item">Calves</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypo-history')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToFirstDDx()">Proceed to differentials ›</button>
            </div>
        </div>

        <!-- HYPOVOLAEMIC -->
        <div class="page" id="page-hypo">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-exam')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="ddx-page-header">
                    <div class="page-title">Hypovolaemic</div>
                    <div class="ddx-tracker" id="ddx-tracker-hypo">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <div class="ddx-section-title">Blood loss</div>
                <div class="ddx-blood-loss-section">
                    <div class="ddx-list-item" onclick="showExternalBleedInfo()">
                        <div class="ddx-list-text">
                            <span class="ddx-list-title">External</span>
                        </div>
                        <span class="ddx-chevron">›</span>
                    </div>
                    <div class="ddx-list-item" onclick="showOccultBleedInfo()">
                        <div class="ddx-list-text">
                            <span class="ddx-list-title">Occult</span>
                            <span class="ddx-list-sub">Retroperitoneal, intra-abdominal, fractures</span>
                        </div>
                        <span class="ddx-chevron">›</span>
                    </div>
                    <div class="ddx-hb-warning" onclick="showHbCaution()">
                        <span class="warning-icon">⚠️</span>
                        <span>Normal Hb does NOT exclude significant acute bleeding</span>
                        <span class="hb-info-btn">ⓘ</span>
                    </div>
                </div>

                <div class="ddx-section-title">Fluid losses</div>
                <div class="ddx-list-item" onclick="showGILossInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">GI losses</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
                <div class="ddx-list-item" onclick="showRenalLossInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Renal losses</span>
                        <span class="ddx-list-sub">Diuretics, DKA, diabetes insipidus</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-section-title">Other</div>
                <div class="ddx-list-item" onclick="showThirdSpacingInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Third spacing</span>
                        <span class="ddx-list-sub">Pancreatitis, burns, bowel obstruction</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
                <div class="ddx-list-item" onclick="showPoorIntakeInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Poor intake</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevShock('page-hypo')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextShock('page-hypo')">Next ›</button>
            </div>
        </div>

        <!-- OBSTRUCTIVE -->
        <div class="page" id="page-obst">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-history')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="ddx-page-header">
                    <div class="page-title">Obstructive</div>
                    <div class="ddx-tracker" id="ddx-tracker-obst">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <div class="ddx-section-title">Consider</div>

                <div class="ddx-list-item" onclick="showTensionPneumoInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Tension pneumothorax</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showPEInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Pulmonary embolism</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showTamponadeInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Cardiac tamponade</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showACSInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Abdominal compartment syndrome</span>
                        <span class="ddx-list-sub">Tense abdomen, high bladder pressures</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showLVOTInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Dynamic LVOT obstruction</span>
                        <span class="ddx-list-sub">HOCM, SAM</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevShock('page-obst')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextShock('page-obst')">Next ›</button>
            </div>
        </div>

        <!-- DISTRIBUTIVE -->
        <div class="page" id="page-dist">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-history')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="ddx-page-header">
                    <div class="page-title">Distributive</div>
                    <div class="ddx-tracker" id="ddx-tracker-dist">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <div class="ddx-section-title">Consider</div>

                <div class="ddx-list-item" onclick="showSepsisInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Sepsis</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showAnaphylaxisShockInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Anaphylaxis</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showNeurogenicInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Neurogenic shock</span>
                        <span class="ddx-list-sub">High spinal cord injury</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showLiverFailureInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Liver failure</span>
                        <span class="ddx-list-sub">Cirrhosis, splanchnic pooling</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showDrugInducedInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Drug-induced</span>
                        <span class="ddx-list-sub">Epidural, vasodilators</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevShock('page-dist')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextShock('page-dist')">Next ›</button>
            </div>
        </div>

        <!-- CARDIOGENIC -->
        <div class="page" id="page-card">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-history')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="ddx-page-header">
                    <div class="page-title">Cardiogenic</div>
                    <div class="ddx-tracker" id="ddx-tracker-card">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <div class="ddx-section-title">Consider</div>

                <div class="ddx-list-item" onclick="showIschemiaInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Acute coronary syndrome</span>
                    </div>
                    <button class="ddx-info-btn" onclick="event.stopPropagation();showIschemiaInfo()">ECG signs ›</button>
                </div>

                <div class="ddx-list-item" onclick="showUnstableArrhythmiaInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Arrhythmia</span>
                    </div>
                    <button class="ddx-info-btn" onclick="event.stopPropagation();showAFInfo()">Think before attributing to AF ›</button>
                </div>

                <div class="ddx-list-item" onclick="showValvularInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Acute valvular dysfunction</span>
                        <span class="ddx-list-sub">New murmur, papillary rupture</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showCardiomyopathyInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Decompensated cardiomyopathy</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showTakotsuboInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Takotsubo cardiomyopathy</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevShock('page-card')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextShock('page-card')">Next ›</button>
            </div>
        </div>

        <!-- ENDOCRINE -->
        <div class="page" id="page-endo">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypo-history')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="ddx-page-header">
                    <div class="page-title">Endocrine</div>
                    <div class="ddx-tracker" id="ddx-tracker-endo">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <div class="ddx-section-title">Consider</div>

                <div class="ddx-list-item" onclick="showAdrenalInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Adrenal insufficiency</span>
                        <span class="ddx-list-sub">Steroid use, Addison's</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>

                <div class="ddx-list-item" onclick="showMyxoedemaInfo()">
                    <div class="ddx-list-text">
                        <span class="ddx-list-title">Myxoedema crisis</span>
                        <span class="ddx-list-sub">Severe hypothyroidism</span>
                    </div>
                    <span class="ddx-chevron">›</span>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevShock('page-endo')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextShock('page-endo')">Next ›</button>
            </div>
        </div>

        <!-- HYPOTENSION MANAGEMENT -->
        <div class="page" id="page-hypo-mgmt">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-endo')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-shock')">Shock</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-actions')">Actions</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypo-history')">Assess</div>
                    <div class="hypo-seg-item completed" onclick="goToFirstDDx()">DDx</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypo-mgmt')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Management</div>

                <!-- Red escalation warning box -->
                <div class="escalation-box">
                    <div class="escalation-title">Escalate early</div>
                    <div class="escalation-text">
                        Obstructive, cardiogenic, and endocrine shock require
                        critical care input in a monitored environment.
                    </div>
                </div>

                <!-- Fluid Resuscitation link -->
                <div class="link-card" onclick="fluidResusSource='shock'; goToPage('page-fluid-resus')">
                    <div class="link-card-title">Fluid resuscitation guide</div>
                    <span class="link-chevron">›</span>
                </div>

                <!-- Major Haemorrhage - coming soon -->
                <div class="link-card disabled">
                    <div class="link-card-title">Major haemorrhage protocol</div>
                    <span class="link-card-badge">Coming soon</span>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-endo')">‹ Back</button>
                <button class="nav-btn primary" onclick="goHome()">Done</button>
            </div>
        </div>

        <!-- HYPOXIA LANDING -->
        <div class="page" id="page-hypoxia">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goHome()">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Check for emergencies</div>

                <div class="code-blue-box">
                    <div class="code-blue-title">Call CODE BLUE if:</div>
                    <div class="code-blue-list">
                        <div class="code-blue-item">Airway obstruction</div>
                        <div class="code-blue-item">Suspected tension pneumothorax</div>
                    </div>
                </div>

                <div class="consider-cxr-box">
                    Consider calling for mobile CXR whilst you continue assessment
                </div>

                <div class="trache-gate" style="margin-top: 20px;">
                    <div class="section-title">Does the patient have a tracheostomy?</div>
                    <div class="gate-buttons">
                        <button class="gate-btn warning" onclick="goToPage('page-hypoxia-trache-gate')">Yes</button>
                        <button class="gate-btn primary" onclick="goToPage('page-hypoxia-o2')">No → Continue</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- HYPOXIA MANAGEMENT FRAMEWORK (DEPRECATED - hidden) -->
        <!-- SUPPLEMENTAL OXYGEN -->
        <div class="page" id="page-hypoxia-o2">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Set the SpO₂ target</div>
                
                <div class="o2-target-card default">
                    <div class="o2-target-value">92-96%</div>
                    <div class="o2-target-label">Default target for most patients</div>
                    <div class="cause-link" onclick="event.stopPropagation();showHyperoxiaInfo()" style="margin-top: 8px;">Why avoid hyperoxia? ›</div>
                </div>

                <div class="o2-target-card caution">
                    <div class="o2-target-value">88-92%</div>
                    <div class="o2-target-label">At risk of hypercapnic respiratory failure</div>
                    <div class="cause-link" onclick="event.stopPropagation();showCO2RetainerRisk()" style="margin-top: 8px;">Who is at risk? ›</div>
                </div>

                <div class="o2-target-card high">
                    <div class="o2-target-value">100%</div>
                    <div class="o2-target-label">Specific indications only</div>
                    <div class="cause-link" onclick="event.stopPropagation();showO2MaxIndications()" style="margin-top: 8px;">View indications ›</div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-devices')">O₂ Delivery Devices ›</button>
            </div>
        </div>

        <!-- OXYGEN DELIVERY DEVICES -->
        <div class="page" id="page-hypoxia-devices">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-o2')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Oxygen delivery</div>

                <div class="section-title">Degree of hypoxia</div>
                <div class="o2-tiles">
                    <div class="o2-tile" onclick="showMildHypoxiaDevices()">
                        <div class="o2-tile-title">Mild</div>
                    </div>
                    <div class="o2-tile" onclick="showModSevereHypoxiaDevices()">
                        <div class="o2-tile-title">Moderate-Severe</div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 20px;">Special scenarios</div>
                <div class="o2-tiles">
                    <div class="o2-tile" onclick="showOSAAPODevices()">
                        <div class="o2-tile-title">OSA / APO</div>
                    </div>
                    <div class="o2-tile" onclick="showHypercapnicDevices()">
                        <div class="o2-tile-title">Hypercapnic failure</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-o2')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-history')">Assess ›</button>
            </div>
        </div>

        <!-- HYPOXIA HISTORY PAGE (Assess step) -->
        <div class="page" id="page-hypoxia-history">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-devices')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Focused history</div>

                <div class="section-label">ONSET</div>
                <div class="onset-toggle-row">
                    <button class="onset-btn" id="btn-hypoxia-sudden" onclick="setHypoxiaOnset('sudden')">
                        <span class="onset-btn-title">Sudden</span>
                        <span class="onset-btn-hint">PE, pneumothorax, anaphylaxis</span>
                    </button>
                    <button class="onset-btn" id="btn-hypoxia-gradual" onclick="setHypoxiaOnset('gradual')">
                        <span class="onset-btn-title">Gradual</span>
                        <span class="onset-btn-hint">Pneumonia, APO, COPD</span>
                    </button>
                </div>

                <div class="pearl-box" id="pe-pearl" style="display:none; margin-top: 16px;">
                    <span class="pearl-icon">💡</span>
                    <span>Sudden + pleuritic chest pain = <strong>PE until proven otherwise</strong></span>
                </div>

                <div class="section-label" style="margin-top: 20px;">KEY QUESTIONS</div>
                <div class="history-checklist">
                    <button class="history-check-item" id="hx-chest-pain" onclick="toggleHypoxiaHx('chest-pain')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Chest pain?</div>
                            <div class="history-check-hint">Pleuritic → PE, pneumothorax. Tight → ACS, APO</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-leg-swell" onclick="toggleHypoxiaHx('leg-swell')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Leg swelling or immobility?</div>
                            <div class="history-check-hint">DVT → PE</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-orthopnoea" onclick="toggleHypoxiaHx('orthopnoea')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Orthopnoea or PND?</div>
                            <div class="history-check-hint">Pulmonary oedema, cardiac failure</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-fever" onclick="toggleHypoxiaHx('fever')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Fever or infective symptoms?</div>
                            <div class="history-check-hint">Pneumonia, sepsis</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-resp-disease" onclick="toggleHypoxiaHx('resp-disease')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Known asthma or COPD?</div>
                            <div class="history-check-hint">Exacerbation. Remember target SpO₂ 88-92%</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-allergy" onclick="toggleHypoxiaHx('allergy')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">New medication, food, or transfusion?</div>
                            <div class="history-check-hint">Anaphylaxis, TRALI, drug-induced</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-procedure" onclick="toggleHypoxiaHx('procedure')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Recent procedure or surgery?</div>
                            <div class="history-check-hint">Central line → pneumothorax. Immobility → PE</div>
                        </div>
                    </button>

                    <button class="history-check-item" id="hx-aspiration" onclick="toggleHypoxiaHx('aspiration')">
                        <div class="history-check-box"></div>
                        <div class="history-check-content">
                            <div class="history-check-q">Witnessed aspiration or choking?</div>
                            <div class="history-check-hint">Aspiration pneumonitis, foreign body</div>
                        </div>
                    </button>
                </div>

                <div class="differential-panel" style="margin-top: 20px;">
                    <div class="differential-title">Working differential</div>
                    <div class="differential-list" id="diff-list-hypoxia-hx">
                        <div class="diff-list-item top">Pneumonia</div>
                        <div class="diff-list-item top">Pulmonary oedema</div>
                        <div class="diff-list-item">COPD / Asthma</div>
                        <div class="diff-list-item">PE</div>
                        <div class="diff-list-item">Pneumothorax</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-o2')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-exam')">Examination ›</button>
            </div>
        </div>

        <!-- HYPOXIA EXAM PAGE (Assess step) -->
        <div class="page" id="page-hypoxia-exam">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-history')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">ABCDE examination</div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">A</span>
                        <span class="abcde-title">Airway</span>
                    </div>
                    <div class="abcde-body">Patent? Stridor? Secretions? Trachea central?</div>
                </div>

                <div class="abcde-card breathing-card">
                    <div class="abcde-card-left">
                        <div class="abcde-header">
                            <span class="abcde-badge">B</span>
                            <span class="abcde-title">Breathing</span>
                        </div>
                        <div class="abcde-body">
                            <div>RR, SpO₂, work of breathing</div>
                            <div>Accessory muscles, tripod position</div>
                        </div>

                        <div class="ausc-section">
                            <div class="ausc-label">Auscultation — what do you hear?</div>
                            <div class="ausc-grid">
                                <button class="ausc-btn" id="ausc-stridor" onclick="setHypoxiaAusc('stridor')">
                                    <span class="ausc-title">Stridor / stertor</span>
                                    <span class="ausc-hint">Upper airway</span>
                                </button>
                                <button class="ausc-btn" id="ausc-wheeze" onclick="setHypoxiaAusc('wheeze')">
                                    <span class="ausc-title">Wheeze</span>
                                    <span class="ausc-hint">Bronchospasm</span>
                                </button>
                                <button class="ausc-btn" id="ausc-creps" onclick="setHypoxiaAusc('creps')">
                                    <span class="ausc-title">Crackles</span>
                                    <span class="ausc-hint">Fluid / consolidation</span>
                                </button>
                                <button class="ausc-btn" id="ausc-reduced" onclick="setHypoxiaAusc('reduced')">
                                    <span class="ausc-title">Reduced / absent</span>
                                    <span class="ausc-hint">Pneumothorax, effusion</span>
                                </button>
                            </div>
                        </div>

                        <div class="info-link" onclick="showChestDrainInfo()" style="margin-top: 12px;">
                            <span>Chest drain present? ›</span>
                        </div>
                    </div>
                    <div class="rr-counter">
                        <div class="rr-counter-title">Resp Rate</div>
                        <div class="rr-counter-subtitle">Tap on each inspiration</div>
                        <button class="rr-counter-btn" id="rr-tap-btn-hypoxia" onclick="tapRRHypoxia()">
                            <svg viewBox="0 0 64 64" fill="currentColor" style="width:28px;height:28px;">
                                <path d="m15.71136 22.98486c6.31949-5.7646 9.73989-.83438 10.36266 6.4882l-1.53619 1.6195-2.68454 1.88031-1.66742-2.61287.20778-3.4121a1.00006 1.00006 0 0 0 -1.99617-.1211l-.17481 2.86631-2.73056.207a1.00006 1.00006 0 0 0 .15143 1.99414l3.00352-.22809 1.56665 2.455-3.537 2.47738-4.4855 1.0723a1.00007 1.00007 0 0 0 .46486 1.94538l3.17955-.75991-.75711 4.15651-4.64664 2.59579a1.00011 1.00011 0 0 0 .97562 1.74616l5.05828-2.8253a1.00067 1.00067 0 0 0 .49611-.69436l1.04245-5.72407s7.86947-5.52045 7.91537-5.56831c0 0 1.97224-2.09089 2.00935-2.15241l2.32381-3.82728a1.00135 1.00135 0 0 0 .145-.51858v-6.04115h3.19494v6.04122a1.00135 1.00135 0 0 0 .145.51858l2.32381 3.82728c.03711.06152 2.00935 2.15241 2.00935 2.15241.0459.04786 7.91537 5.56831 7.91537 5.56831l1.04246 5.72407a1.00064 1.00064 0 0 0 .49611.69436l5.05828 2.8253a1.00048 1.00048 0 0 0 .97549-1.74628l-4.64647-2.59567-.75711-4.15651 3.17956.75991a1.0001 1.0001 0 0 0 .4648-1.94544l-4.48545-1.07224-3.53692-2.47732 1.567-2.4551 3.00315.22815c.02588.002.05127.00293.07666.00293a1.00068 1.00068 0 0 0 .07465-1.99713l-2.7305-.207-.17481-2.86631a.99991.99991 0 1 0 -1.99616.1211l.20826 3.4121-1.66785 2.61294-2.6846-1.88037-1.534-1.61724c.63577-7.29768 3.99636-12.29352 10.34539-6.51573a1.00031 1.00031 0 0 0 1.332-1.49242c-6.33707-5.81978-11.99468-2.857-13.32657 5.41193l-.67678-1.11485v-20.75075a1.00015 1.00015 0 0 0 -2.00007 0v3.00987h-3.19496v-3.00987a1.00015 1.00015 0 0 0 -2.00006 0v20.75071l-.67318 1.10887c-1.32024-8.27855-7.10224-11.17568-13.35617-5.37067a1.00029 1.00029 0 0 0 1.34288 1.48241zm14.68653-12.96138h3.19494v2.98936h-3.19494zm0 4.98943h3.19494v2.99033h-3.19494z"/>
                            </svg>
                        </button>
                        <div class="rr-counter-display">
                            <span id="rr-value-hypoxia">—</span><span class="rr-unit">/min</span>
                        </div>
                        <button class="rr-reset-btn" onclick="resetRRHypoxia()">Reset</button>
                    </div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">C</span>
                        <span class="abcde-title">Circulation</span>
                    </div>
                    <div class="abcde-body">HR, BP, perfusion, oedema</div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">D</span>
                        <span class="abcde-title">Disability</span>
                    </div>
                    <div class="abcde-body">Conscious state, agitation (hypoxia), drowsiness (CO₂)</div>
                </div>

                <div class="abcde-card">
                    <div class="abcde-header">
                        <span class="abcde-badge">E</span>
                        <span class="abcde-title">Exposure</span>
                    </div>
                    <div class="abcde-body">Temp, rash, calves (DVT)</div>
                </div>

                <div class="differential-panel" style="margin-top: 16px;">
                    <div class="differential-title">Working differential</div>
                    <div class="differential-list" id="diff-list-hypoxia-exam">
                        <div class="diff-list-item top">Pneumonia</div>
                        <div class="diff-list-item top">Pulmonary oedema</div>
                        <div class="diff-list-item">COPD / Asthma</div>
                        <div class="diff-list-item">PE</div>
                        <div class="diff-list-item">Pneumothorax</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-history')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-airway')">View differentials ›</button>
            </div>
        </div>

        <!-- HYPOXIA CAUSES PAGE -->
        <div class="page" id="page-hypoxia-causes">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-exam')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title" style="font-size:18px;">What do you hear?</div>

                <div class="clinical-choice-card" onclick="goToPage('page-hypoxia-stridor')">
                    <div class="clinical-choice-content">
                        <div class="clinical-choice-title">Stridor or stertor</div>
                        <div class="clinical-choice-hint">Upper airway obstruction</div>
                    </div>
                    <span class="trigger-arrow">›</span>
                </div>

                <div class="clinical-choice-card" onclick="goToPage('page-hypoxia-wheeze')">
                    <div class="clinical-choice-content">
                        <div class="clinical-choice-title">Wheeze</div>
                        <div class="clinical-choice-hint">Bronchospasm / lower airway</div>
                    </div>
                    <span class="trigger-arrow">›</span>
                </div>

                <div class="clinical-choice-card" onclick="goToPage('page-hypoxia-creps')">
                    <div class="clinical-choice-content">
                        <div class="clinical-choice-title">Crepitations</div>
                        <div class="clinical-choice-hint">Fluid / consolidation / fibrosis</div>
                    </div>
                    <span class="trigger-arrow">›</span>
                </div>

                <div class="clinical-choice-card" onclick="goToPage('page-hypoxia-quiet')">
                    <div class="clinical-choice-content">
                        <div class="clinical-choice-title">Quiet / normal breath sounds</div>
                        <div class="clinical-choice-hint">Vascular, mechanical, or other</div>
                    </div>
                    <span class="trigger-arrow">›</span>
                </div>

                <div class="all-ddx-link" onclick="goToPage('page-hypoxia-airway')">
                    View all differentials by system ›
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-exam')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-plan')">Management ›</button>
            </div>
        </div>

        <!-- HYPOXIA PLAN/MGMT PAGE -->
        <div class="page" id="page-hypoxia-plan">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-causes')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title" style="font-size:18px;">Management principles</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Upper airway obstruction</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Sit upright, suction secretions. Call anaesthetics early. If anaphylaxis → adrenaline IM. Prepare for difficult airway.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Bronchospasm</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Bronchodilators, systemic corticosteroids, supplemental O₂. If anaphylaxis → adrenaline IM. Consider NIV if tiring.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pulmonary oedema</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Sit upright, supplemental O₂. GTN if hypertensive. Diuretics. Consider NIV (CPAP). Treat underlying cause.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pneumonia</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Supplemental O₂, IV antibiotics per local guidelines, blood cultures. Assess for sepsis.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pulmonary embolism</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Supplemental O₂, anticoagulation. If massive/unstable → consider thrombolysis. Call for senior help.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Tension pneumothorax</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Immediate needle decompression or finger thoracostomy. Formal chest drain. Call Code Blue if haemodynamically unstable.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pleural effusion</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Supplemental O₂, therapeutic drainage if large and symptomatic. Investigate underlying cause.</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-causes')">‹ Back</button>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Gate Page -->
        <div class="page" id="page-hypoxia-trache-gate">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-question-box">
                    <div class="wizard-question-icon">⚠️</div>
                    <div class="wizard-question-title">Is this a laryngectomy?</div>
                    <div class="wizard-question-hint">Laryngectomy patients have NO upper airway connection — different management</div>
                </div>

                <div class="wizard-options">
                    <button class="wizard-option" onclick="goToPage('page-hypoxia-trache-laryngectomy')">
                        <span class="wizard-option-title">Yes — Laryngectomy</span>
                        <span class="wizard-option-hint">Stoma is ONLY airway</span>
                    </button>
                    <button class="wizard-option primary" onclick="goToPage('page-hypoxia-trache-step0')">
                        <span class="wizard-option-title">No — Standard tracheostomy</span>
                        <span class="wizard-option-hint">Upper airway may be intact</span>
                    </button>
                    <button class="wizard-option muted" onclick="goToPage('page-hypoxia-trache-step0')">
                        <span class="wizard-option-title">Unknown</span>
                        <span class="wizard-option-hint">Proceed as standard, reassess</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Laryngectomy Pathway -->
        <div class="page" id="page-hypoxia-trache-laryngectomy">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-gate')">‹ Back</button>
                    <span class="header-title">Laryngectomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="code-blue-box">
                    <div class="code-blue-title">Critical: Stoma is ONLY airway</div>
                    <div class="code-blue-list">
                        <div class="code-blue-item">Do NOT attempt oral/nasal ventilation</div>
                        <div class="code-blue-item">All oxygenation via stoma</div>
                    </div>
                </div>

                <div class="wizard-action-card">
                    <div class="wizard-action-num">1</div>
                    <div class="wizard-action-content">
                        <div class="wizard-action-title">Apply high-flow O₂ directly to stoma</div>
                    </div>
                </div>

                <div class="wizard-action-card">
                    <div class="wizard-action-num">2</div>
                    <div class="wizard-action-content">
                        <div class="wizard-action-title">Remove any stoma cover, HME, or speaking valve</div>
                    </div>
                </div>

                <div class="wizard-action-card">
                    <div class="wizard-action-num">3</div>
                    <div class="wizard-action-content">
                        <div class="wizard-action-title">Suction stoma</div>
                    </div>
                </div>

                <div class="wizard-action-card">
                    <div class="wizard-action-num">4</div>
                    <div class="wizard-action-content">
                        <div class="wizard-action-title">If tube present — remove inner cannula, check patency</div>
                    </div>
                </div>

                <div class="wizard-action-card escalate">
                    <div class="wizard-action-num">5</div>
                    <div class="wizard-action-content">
                        <div class="wizard-action-title">If unable to ventilate via stoma</div>
                        <div class="wizard-action-hint">Paediatric mask over stoma, or size 6 ETT/trache into stoma</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-trache-gate')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-o2')">Continue to O₂ targets ›</button>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Step 0 - Immediate Actions -->
        <div class="page" id="page-hypoxia-trache-step0">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-gate')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-progress">
                    <div class="wizard-progress-step active">Start</div>
                    <div class="wizard-progress-step">1</div>
                    <div class="wizard-progress-step">2</div>
                    <div class="wizard-progress-step">3</div>
                    <div class="wizard-progress-step">4</div>
                    <div class="wizard-progress-step">5</div>
                </div>

                <div class="code-blue-box">
                    <div class="code-blue-title">Immediate actions</div>
                    <div class="code-blue-list">
                        <div class="code-blue-item">Call Code Blue</div>
                        <div class="code-blue-item">Get bedside emergency trache box</div>
                        <div class="code-blue-item">Apply high-flow O₂ via trache AND face</div>
                    </div>
                </div>

                <div class="wizard-prompt">
                    <div class="wizard-prompt-text">Complete these actions, then proceed</div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-trache-gate')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-trache-step1')">Next step ›</button>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Step 1 -->
        <div class="page" id="page-hypoxia-trache-step1">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-step0')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-progress">
                    <div class="wizard-progress-step completed">Start</div>
                    <div class="wizard-progress-step active">1</div>
                    <div class="wizard-progress-step">2</div>
                    <div class="wizard-progress-step">3</div>
                    <div class="wizard-progress-step">4</div>
                    <div class="wizard-progress-step">5</div>
                </div>

                <div class="wizard-step-card">
                    <div class="wizard-step-num">1</div>
                    <div class="wizard-step-title">Remove speaking valve and inner cannula</div>
                </div>

                <div class="wizard-decision">
                    <div class="wizard-decision-question">Breathing improved?</div>
                    <div class="wizard-decision-buttons">
                        <button class="wizard-decision-btn success" onclick="goToPage('page-hypoxia-trache-success')">
                            <span class="wizard-btn-icon">✓</span>
                            <span class="wizard-btn-text">Yes — Improved</span>
                        </button>
                        <button class="wizard-decision-btn continue" onclick="goToPage('page-hypoxia-trache-step2')">
                            <span class="wizard-btn-icon">→</span>
                            <span class="wizard-btn-text">No — Continue</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Step 2 -->
        <div class="page" id="page-hypoxia-trache-step2">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-step1')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-progress">
                    <div class="wizard-progress-step completed">Start</div>
                    <div class="wizard-progress-step completed">1</div>
                    <div class="wizard-progress-step active">2</div>
                    <div class="wizard-progress-step">3</div>
                    <div class="wizard-progress-step">4</div>
                    <div class="wizard-progress-step">5</div>
                </div>

                <div class="wizard-step-card">
                    <div class="wizard-step-num">2</div>
                    <div class="wizard-step-title">Attempt to pass suction catheter</div>
                </div>

                <div class="wizard-decision">
                    <div class="wizard-decision-question">Does catheter pass?</div>
                    <div class="wizard-decision-buttons">
                        <button class="wizard-decision-btn success" onclick="goToPage('page-hypoxia-trache-patent')">
                            <span class="wizard-btn-icon">✓</span>
                            <span class="wizard-btn-text">Yes — Patent</span>
                        </button>
                        <button class="wizard-decision-btn continue" onclick="goToPage('page-hypoxia-trache-step3')">
                            <span class="wizard-btn-icon">✗</span>
                            <span class="wizard-btn-text">No — Blocked</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Patent Trache -->
        <div class="page" id="page-hypoxia-trache-patent">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-step2')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-success-box">
                    <div class="wizard-success-icon">✓</div>
                    <div class="wizard-success-title">Tracheostomy is patent</div>
                </div>

                <div class="wizard-action-card">
                    <div class="wizard-action-content">
                        <div class="wizard-action-title">Suction thoroughly and reassess</div>
                        <div class="wizard-action-hint">If still hypoxic after suctioning, consider other causes of respiratory distress</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-trache-step2')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-o2')">Continue assessment ›</button>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Step 3 -->
        <div class="page" id="page-hypoxia-trache-step3">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-step2')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-progress">
                    <div class="wizard-progress-step completed">Start</div>
                    <div class="wizard-progress-step completed">1</div>
                    <div class="wizard-progress-step completed">2</div>
                    <div class="wizard-progress-step active">3</div>
                    <div class="wizard-progress-step">4</div>
                    <div class="wizard-progress-step">5</div>
                </div>

                <div class="wizard-step-card">
                    <div class="wizard-step-num">3</div>
                    <div class="wizard-step-title">Deflate the cuff</div>
                    <div class="wizard-step-hint">May allow patient to breathe around blocked trache via upper airway</div>
                </div>

                <div class="wizard-decision">
                    <div class="wizard-decision-question">Breathing improved?</div>
                    <div class="wizard-decision-buttons">
                        <button class="wizard-decision-btn success" onclick="goToPage('page-hypoxia-trache-success')">
                            <span class="wizard-btn-icon">✓</span>
                            <span class="wizard-btn-text">Yes — Improved</span>
                        </button>
                        <button class="wizard-decision-btn continue" onclick="goToPage('page-hypoxia-trache-step4')">
                            <span class="wizard-btn-icon">→</span>
                            <span class="wizard-btn-text">No — Continue</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Step 4 -->
        <div class="page" id="page-hypoxia-trache-step4">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-step3')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-progress">
                    <div class="wizard-progress-step completed">Start</div>
                    <div class="wizard-progress-step completed">1</div>
                    <div class="wizard-progress-step completed">2</div>
                    <div class="wizard-progress-step completed">3</div>
                    <div class="wizard-progress-step active">4</div>
                    <div class="wizard-progress-step">5</div>
                </div>

                <div class="wizard-step-card">
                    <div class="wizard-step-num">4</div>
                    <div class="wizard-step-title">Assess position</div>
                    <div class="wizard-step-hint">Look for signs of displacement or malposition</div>
                </div>

                <div class="wizard-checklist">
                    <div class="wizard-check-item">Subcutaneous emphysema?</div>
                    <div class="wizard-check-item">Obvious migration?</div>
                    <div class="wizard-check-item">Loss of EtCO₂?</div>
                    <div class="wizard-check-item">Consider bronchoscopy if available</div>
                </div>

                <div class="wizard-decision">
                    <div class="wizard-decision-question">Able to oxygenate?</div>
                    <div class="wizard-decision-buttons">
                        <button class="wizard-decision-btn success" onclick="goToPage('page-hypoxia-trache-success')">
                            <span class="wizard-btn-icon">✓</span>
                            <span class="wizard-btn-text">Yes — Stable</span>
                        </button>
                        <button class="wizard-decision-btn escalate" onclick="goToPage('page-hypoxia-trache-step5')">
                            <span class="wizard-btn-icon">⚠</span>
                            <span class="wizard-btn-text">No — Escalate</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Step 5 - Escalation -->
        <div class="page" id="page-hypoxia-trache-step5">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-hypoxia-trache-step4')">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-progress">
                    <div class="wizard-progress-step completed">Start</div>
                    <div class="wizard-progress-step completed">1</div>
                    <div class="wizard-progress-step completed">2</div>
                    <div class="wizard-progress-step completed">3</div>
                    <div class="wizard-progress-step completed">4</div>
                    <div class="wizard-progress-step active escalate">5</div>
                </div>

                <div class="wizard-escalate-box">
                    <div class="wizard-escalate-icon">⚠️</div>
                    <div class="wizard-escalate-title">Unable to oxygenate</div>
                    <div class="wizard-escalate-action">REMOVE THE TRACHEOSTOMY</div>
                </div>

                <div class="wizard-plans">
                    <div class="wizard-plan-card">
                        <div class="wizard-plan-label">Plan A</div>
                        <div class="wizard-plan-title">O₂ via face AND stoma simultaneously</div>
                        <div class="wizard-plan-hint">BVM to face + O₂ to stoma</div>
                    </div>
                    <div class="wizard-plan-card">
                        <div class="wizard-plan-label">Plan B</div>
                        <div class="wizard-plan-title">Intubate via stoma</div>
                        <div class="wizard-plan-hint">If stoma >10 days old: size 6 ETT or trache through stoma</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-trache-step4')">‹ Back</button>
            </div>
        </div>

        <!-- TRACHEOSTOMY WIZARD: Success Page -->
        <div class="page" id="page-hypoxia-trache-success">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goBack()">‹ Back</button>
                    <span class="header-title">Tracheostomy Emergency</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="wizard-success-box large">
                    <div class="wizard-success-icon">✓</div>
                    <div class="wizard-success-title">Breathing improved</div>
                    <div class="wizard-success-hint">Continue to monitor and reassess</div>
                </div>

                <div class="wizard-next-steps">
                    <div class="section-title">Next steps</div>
                    <div class="wizard-next-item">Review what caused the obstruction</div>
                    <div class="wizard-next-item">Consider if inner cannula needs replacement</div>
                    <div class="wizard-next-item">Continue with hypoxia assessment if still hypoxic</div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goBack()">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-o2')">Continue assessment ›</button>
            </div>
        </div>

        <!-- HYPOXIA DDX OVERVIEW (DEPRECATED - to be removed) -->
        <div class="page" id="page-hypoxia-ddx" style="display:none;"></div>

        <!-- STRIDOR/STERTOR PATHWAY -->
        <div class="page" id="page-hypoxia-stridor">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-causes')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Upper airway obstruction</div>

                <div class="action-box urgent">
                    <div class="action-box-title">Immediate actions</div>
                    <div class="action-box-items">
                        <div class="action-box-item">Call for senior help / anaesthetics</div>
                        <div class="action-box-item">Sit patient upright if tolerated</div>
                        <div class="action-box-item">Suction if secretions visible</div>
                        <div class="action-box-item">High-flow O₂ / prepare BVM</div>
                    </div>
                </div>

                <div class="consider-box">
                    <div class="consider-title">Consider</div>
                    <div class="consider-grid">
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Anaphylaxis</span>
                            </div>
                            <div class="consider-item-clues">Recent drug, food, contrast, transfusion. Urticaria, angioedema, hypotension. Give adrenaline IM early if suspected.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Angioedema</span>
                            </div>
                            <div class="consider-item-clues">ACE-inhibitor use, hereditary angioedema. Lip/tongue swelling.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Foreign body</span>
                            </div>
                            <div class="consider-item-clues">Witnessed choking, unable to speak/cough.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Epiglottitis / deep neck infection</span>
                            </div>
                            <div class="consider-item-clues">Fever, drooling, muffled voice, neck swelling.</div>
                        </div>
                    </div>
                </div>

                <div class="multifactorial-note">
                    Hypoxia is often multifactorial — consider other coexistent causes
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-causes')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-airway')">All differentials ›</button>
            </div>
        </div>

        <!-- WHEEZE PATHWAY -->
        <div class="page" id="page-hypoxia-wheeze">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-causes')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Bronchospasm</div>

                <div class="consider-box">
                    <div class="consider-title">Consider</div>
                    <div class="consider-grid">
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Asthma exacerbation</span>
                            </div>
                            <div class="consider-item-clues">Known asthma, triggers.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">COPD exacerbation</span>
                            </div>
                            <div class="consider-item-clues">Known COPD, increased sputum, infective trigger.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Anaphylaxis</span>
                            </div>
                            <div class="consider-item-clues">Recent allergen exposure, urticaria, hypotension, angioedema. Give adrenaline IM early if suspected.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Cardiac wheeze</span>
                            </div>
                            <div class="consider-item-clues">Pulmonary oedema can mimic bronchospasm. Listen for fine basal crackles, ask about orthopnoea.</div>
                        </div>
                    </div>
                </div>

                <div class="multifactorial-note">
                    Hypoxia is often multifactorial — consider other coexistent causes
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-causes')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-airway')">All differentials ›</button>
            </div>
        </div>

        <!-- CREPITATIONS PATHWAY -->
        <div class="page" id="page-hypoxia-creps">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-causes')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Crepitations</div>

                <div class="consider-box">
                    <div class="consider-title">Consider</div>
                    <div class="consider-grid">
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pulmonary oedema</span>
                            </div>
                            <div class="consider-item-clues">Bilateral fine crackles, orthopnoea, peripheral oedema. Sit up, give GTN, diuretics.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pneumonia</span>
                            </div>
                            <div class="consider-item-clues">Fever, productive cough, focal coarse crackles, consolidation on CXR.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Aspiration</span>
                            </div>
                            <div class="consider-item-clues">↓GCS, dysphagia, witnessed event. Often right lower lobe.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Interstitial lung disease</span>
                            </div>
                            <div class="consider-item-clues">Fine "velcro" crackles at bases, chronic progressive dyspnoea, clubbing.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">ARDS</span>
                            </div>
                            <div class="consider-item-clues">Acute onset, bilateral infiltrates, known precipitant (sepsis, trauma, pancreatitis).</div>
                        </div>
                    </div>
                </div>

                <div class="multifactorial-note">
                    Hypoxia is often multifactorial — consider other coexistent causes
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-causes')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-airway')">All differentials ›</button>
            </div>
        </div>

        <!-- QUIET CHEST - ONSET QUESTION -->
        <div class="page" id="page-hypoxia-quiet">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-causes')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Onset?</div>
                
                <div class="clinical-choice-card" onclick="goToPage('page-hypoxia-sudden')">
                    <div class="clinical-choice-content">
                        <div class="clinical-choice-title">Sudden</div>
                        <div class="clinical-choice-hint">Think vascular / mechanical</div>
                    </div>
                    <span class="trigger-arrow">›</span>
                </div>

                <div class="clinical-choice-card" onclick="goToPage('page-hypoxia-gradual')">
                    <div class="clinical-choice-content">
                        <div class="clinical-choice-title">Gradual</div>
                        <div class="clinical-choice-hint">Think parenchymal / hypoventilation</div>
                    </div>
                    <span class="trigger-arrow">›</span>
                </div>
            </div>
        </div>

        <!-- SUDDEN ONSET PATHWAY -->
        <div class="page" id="page-hypoxia-sudden">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-quiet')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Sudden onset hypoxia</div>

                <div class="consider-box">
                    <div class="consider-title">Consider</div>
                    <div class="consider-grid">
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pulmonary embolism</span>
                            </div>
                            <div class="consider-item-clues">Pleuritic chest pain, tachycardia, DVT risk factors. CXR often normal. ECG: sinus tachy, S1Q3T3, RBBB.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Tension pneumothorax</span>
                            </div>
                            <div class="consider-item-clues">Haemodynamically unstable with unilateral ↓ air entry — decompress immediately (don't wait for CXR).</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pneumothorax</span>
                            </div>
                            <div class="consider-item-clues">Unilateral ↓ air entry, recent procedure, trauma, tall thin patient.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Aspiration</span>
                            </div>
                            <div class="consider-item-clues">Witnessed event, ↓GCS, vomiting, dysphagia. Right lower lobe common.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Flash pulmonary oedema</span>
                            </div>
                            <div class="consider-item-clues">Known cardiac disease, hypertensive crisis, new arrhythmia. Bilateral crackles.</div>
                        </div>
                    </div>
                </div>

                <div class="multifactorial-note">
                    Hypoxia is often multifactorial — consider other coexistent causes
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-quiet')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-airway')">All differentials ›</button>
            </div>
        </div>

        <!-- GRADUAL ONSET PATHWAY -->
        <div class="page" id="page-hypoxia-gradual">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-quiet')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Gradual onset hypoxia</div>

                <div class="consider-box">
                    <div class="consider-title">Consider</div>
                    <div class="consider-grid">
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pneumonia</span>
                            </div>
                            <div class="consider-item-clues">Fever, productive cough, consolidation on CXR. Start antibiotics early.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">COPD exacerbation</span>
                            </div>
                            <div class="consider-item-clues">Known COPD, increased dyspnoea/sputum. Consider NIV if hypercapnic.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pleural effusion</span>
                            </div>
                            <div class="consider-item-clues">Dullness to percussion, ↓ air entry. Consider drainage if large/symptomatic.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Pulmonary oedema</span>
                            </div>
                            <div class="consider-item-clues">Especially if no fever/infective symptoms. Orthopnoea, bilateral crackles, peripheral oedema. Check BNP.</div>
                        </div>
                        <div class="consider-item">
                            <div class="consider-item-header">
                                <span class="consider-item-name">Atelectasis</span>
                            </div>
                            <div class="consider-item-clues">Post-op, prolonged bed rest, mucus plugging. Encourage deep breathing, physio.</div>
                        </div>
                    </div>
                </div>

                <div class="multifactorial-note">
                    Hypoxia is often multifactorial — consider other coexistent causes
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPage('page-hypoxia-quiet')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-hypoxia-airway')">All differentials ›</button>
            </div>
        </div>

        <!-- HYPOXIA: AIRWAY -->
        <div class="page" id="page-hypoxia-airway">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia-exam')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="content">
                <div class="page-title">Airway</div>
                <div class="page-subtitle">Usually associated with stridor or wheeze</div>

                <div class="section-title">Consider</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Upper airway obstruction</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Angioedema</div>
                            <div class="cause-clue-item">Vocal cord dysfunction/palsy</div>
                            <div class="cause-clue-item">Foreign body</div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Lower airway: Bronchospasm</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Asthma, COPD exacerbation, anaphylaxis</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevHypoxiaDDx('page-hypoxia-airway')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextHypoxiaDDx('page-hypoxia-airway')">Next ›</button>
            </div>
        </div>

        <!-- HYPOXIA: BREATHING -->
        <div class="page" id="page-hypoxia-breathing">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPrevHypoxiaDDx('page-hypoxia-breathing')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-dot done"></div>
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="content">
                <div class="page-title">Breathing</div>
                <div class="page-subtitle">Lung parenchyma and pleura</div>

                <div class="section-title">Consider</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pneumonia</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Infectious pneumonia — fever, productive cough, consolidation</div>
                            <div class="cause-clue-item">Aspiration pneumonitis — recent aspiration event, decreased GCS</div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">ARDS / Acute lung injury</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Acute interstitial pneumonia</div>
                            <div class="cause-clue-item">TRALI (post-transfusion)</div>
                            <div class="cause-clue-item">Secondary to inflammation (pancreatitis, sepsis)</div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pulmonary oedema</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item"><strong>Cardiogenic</strong> — LV failure (see Circulation)</div>
                            <div class="cause-clue-item"><strong>Neurogenic</strong> — post head injury, stroke, seizure</div>
                            <div class="cause-clue-item"><strong>Negative pressure</strong> — post-extubation, laryngospasm</div>
                            <div class="cause-clue-item"><strong>Re-expansion</strong> — post-pneumothorax or pleural effusion drainage</div>
                            <div class="cause-clue-item"><strong>Drug/toxin</strong> — opioid overdose, aspirin toxicity</div>
                            <div class="cause-clue-item"><strong>High altitude</strong></div>
                            <div class="cause-clue-item"><strong>Immersion/drowning</strong></div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pneumothorax</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Unilateral decreased air entry, recent procedure, trauma, ventilation</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pleural effusion</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Decreased air entry, dullness to percussion, known malignancy/CCF/infection</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Atelectasis</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Post-operative, prolonged recumbency, mucus plugging</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Interstitial lung disease</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Pulmonary fibrosis, sarcoidosis — fine crackles, known ILD</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pulmonary vasculitis</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Known autoimmune disease, haemoptysis, systemic features</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevHypoxiaDDx('page-hypoxia-breathing')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextHypoxiaDDx('page-hypoxia-breathing')">Next ›</button>
            </div>
        </div>

        <!-- HYPOXIA: CIRCULATION -->
        <div class="page" id="page-hypoxia-circ">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPrevHypoxiaDDx('page-hypoxia-circ')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-dot done"></div>
                <div class="progress-dot done"></div>
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="content">
                <div class="page-title">Circulation</div>
                <div class="page-subtitle">Pulmonary vascular and cardiac</div>

                <div class="section-title">Consider</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pulmonary embolism</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Thromboembolism — DVT, immobility, malignancy</div>
                            <div class="cause-clue-item">Fat embolism — post long bone fracture</div>
                            <div class="cause-clue-item">Air embolism — post-procedure</div>
                            <div class="cause-clue-item">Amniotic fluid embolism — peripartum</div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Heart failure</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item"><strong>LV failure</strong> — pulmonary oedema, orthopnoea, pink frothy sputum, bibasal crackles, known CCF, recent ACS, fluid overload</div>
                            <div class="cause-clue-item"><strong>RV failure</strong> — inadequate pulmonary blood flow, peripheral oedema, RV infarct, pulmonary hypertension</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevHypoxiaDDx('page-hypoxia-circ')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextHypoxiaDDx('page-hypoxia-circ')">Next ›</button>
            </div>
        </div>

        <!-- HYPOXIA: DISABILITY -->
        <div class="page" id="page-hypoxia-disability">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPrevHypoxiaDDx('page-hypoxia-disability')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-dot done"></div>
                <div class="progress-dot done"></div>
                <div class="progress-dot done"></div>
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="content">
                <div class="page-title">Disability</div>
                <div class="page-subtitle">Decreased respiratory drive</div>

                <div class="section-title">Consider</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pain → Splinting</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Rib fractures, post-thoracic surgery, pleurisy — inadequate respiratory excursion due to pain</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Decreased conscious state / narcotisation</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Any cause of ↓GCS → hypoventilation, loss of airway protection</div>
                            <div class="cause-clue-item">Opioids, sedatives — check drug chart, consider reversal</div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Neuromuscular disease</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Guillain-Barré syndrome — ascending weakness</div>
                            <div class="cause-clue-item">Myasthenia gravis — fatigable weakness, known diagnosis</div>
                            <div class="cause-clue-item">Motor neurone disease</div>
                            <div class="cause-clue-item">Myopathy</div>
                        </div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Obesity hypoventilation syndrome</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Obesity, chronic hypoventilation, hypercapnia. Often coexists with OSA. May need NIV.</div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevHypoxiaDDx('page-hypoxia-disability')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextHypoxiaDDx('page-hypoxia-disability')">Next ›</button>
            </div>
        </div>

        <!-- HYPOXIA: OTHER -->
        <div class="page" id="page-hypoxia-other">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPrevHypoxiaDDx('page-hypoxia-other')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-dot done"></div>
                <div class="progress-dot done"></div>
                <div class="progress-dot done"></div>
                <div class="progress-dot done"></div>
                <div class="progress-dot active"></div>
            </div>
            <div class="content">
                <div class="page-title">Other</div>

                <div class="section-title">Shunts</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Hepatopulmonary syndrome</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Liver disease with intrapulmonary vascular dilatations — platypnoea, orthodexia</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Pulmonary AVM</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">HHT (hereditary haemorrhagic telangiectasia), known AVM</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Intracardiac shunt</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">PFO, ASD, VSD — R→L shunt with increased RA pressure</div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 20px;">Other causes</div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Obesity</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">Reduced FRC, atelectasis, increased work of breathing. See Disability for OHS.</div>
                    </div>
                </div>

                <div class="cause-card" onclick="this.classList.toggle('open')">
                    <div class="cause-header">
                        <div class="cause-title">Failure of O₂ delivery / Histotoxic hypoxia</div>
                        <span class="cause-arrow">▼</span>
                    </div>
                    <div class="cause-body">
                        <div class="cause-clues">
                            <div class="cause-clue-item">Dyshaemoglobinaemia — methaemoglobinaemia</div>
                            <div class="cause-clue-item">CO poisoning — fire, exhaust exposure</div>
                            <div class="cause-clue-item">Cyanide toxicity — fire, industrial exposure</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goToPrevHypoxiaDDx('page-hypoxia-other')">‹ Back</button>
                <button class="nav-btn primary" onclick="goToNextHypoxiaDDx('page-hypoxia-other')">Done ✓</button>
            </div>
        </div>

        <!-- HYPOXIA: CALCULATORS -->
        <div class="page" id="page-hypoxia-calc">
            <div class="hypo-header">
                <div class="hypo-header-back">
                    <button onclick="goToPage('page-hypoxia')">‹</button>
                </div>
                <div class="hypo-seg-control">
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia')">Urgent</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-o2')">O₂</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-history')">Assess</div>
                    <div class="hypo-seg-item completed" onclick="goToPage('page-hypoxia-causes')">DDx</div>
                    <div class="hypo-seg-item current" onclick="goToPage('page-hypoxia-plan')">Mgmt</div>
                </div>
                <div class="hypo-header-home">
                    <button onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Calculators</div>

                <div class="calc-section">
                    <div class="calc-title">P/F Ratio</div>
                    <div class="calc-desc">PaO₂ / FiO₂ — assesses oxygenation independent of FiO₂</div>
                    <div class="calc-inputs">
                        <div class="calc-input-group">
                            <label>PaO₂ (mmHg)</label>
                            <input type="number" id="pao2" placeholder="e.g. 80" oninput="calcPF()">
                        </div>
                        <div class="calc-input-group">
                            <label>FiO₂ (%)</label>
                            <input type="number" id="fio2" placeholder="e.g. 21" oninput="calcPF()">
                        </div>
                    </div>
                    <div class="calc-result" id="pf-result"></div>
                    <div class="calc-interp">
                        <div class="calc-interp-item">Normal: ≥400</div>
                        <div class="calc-interp-item">Impaired: 300-399</div>
                        <div class="calc-interp-item">Mild ARDS: 200-299</div>
                        <div class="calc-interp-item">Moderate ARDS: 100-199</div>
                        <div class="calc-interp-item">Severe ARDS: &lt;100</div>
                    </div>
                </div>

                <div class="calc-section">
                    <div class="calc-title">A-a Gradient</div>
                    <div class="calc-desc">Alveolar-arterial oxygen difference</div>
                    <div class="calc-inputs">
                        <div class="calc-input-group">
                            <label>Age (years)</label>
                            <input type="number" id="aa-age" placeholder="e.g. 50" oninput="calcAA()">
                        </div>
                        <div class="calc-input-group">
                            <label>PaO₂ (mmHg)</label>
                            <input type="number" id="aa-pao2" placeholder="e.g. 80" oninput="calcAA()">
                        </div>
                        <div class="calc-input-group">
                            <label>PaCO₂ (mmHg)</label>
                            <input type="number" id="aa-paco2" placeholder="e.g. 40" oninput="calcAA()">
                        </div>
                        <div class="calc-input-group">
                            <label>FiO₂ (%)</label>
                            <input type="number" id="aa-fio2" placeholder="e.g. 21" oninput="calcAA()">
                        </div>
                    </div>
                    <div class="calc-result" id="aa-result"></div>
                    <div class="calc-note">Expected A-a gradient = (Age/4) + 4 on room air</div>
                </div>
            </div>
        </div>

        <!-- GI BLEEDING -->
        <!-- GI BLEEDING - Page 1: Immediate Actions -->
        <div class="page" id="page-gi-bleed">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goHome()">‹ Back</button>
                    <span class="header-title">GI Bleeding</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="page-title">Immediate Actions</div>

                <div class="action-tiles">
                    <div class="action-tile">
                        <span class="action-tile-num">1</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m509.804688 87.050781-21.210938-21.210937c-.007812-.007813-63.640625-63.640625-63.640625-63.640625-2.929687-2.929688-7.679687-2.933594-10.609375 0l-21.214844 21.210937c-1.40625 1.40625-2.195312 3.3125-2.195312 5.304688 0 1.988281.789062 3.894531 2.195312 5.300781l5.304688 5.304687-52.050782 52.046876c-12.855468 1.34375-24.921874 6.304687-35 14.390624l-79.847656-79.847656c-1.410156-1.410156-3.316406-2.199218-5.304687-2.199218-1.992188 0-3.898438.789062-5.304688 2.199218l-50.535156 50.535156c-14.621094 14.621094-14.621094 38.410157 0 53.03125l81.574219 81.574219-8.582032 25.746094-51.777343 51.78125c-1.40625 1.40625-2.199219 3.3125-2.199219 5.300781 0 1.988282.792969 3.898438 2.199219 5.304688l5.300781 5.300781-194.710938 194.714844c-2.925781 2.925781-2.925781 7.675781 0 10.605469 1.464844 1.464843 3.382813 2.195312 5.304688 2.195312 1.917969 0 3.839844-.730469 5.304688-2.195312l194.710937-194.714844 5.304687 5.304687c1.460938 1.464844 3.382813 2.195313 5.300782 2.195313 1.917968 0 3.839844-.730469 5.304687-2.195313l51.78125-51.78125 30.140625-10.046875c.042969-.015625.085938-.035156.132813-.054687.1875-.066407.375-.140625.558593-.222657.070313-.03125.144532-.0625.214844-.097656.179688-.089844.355469-.183594.53125-.285156.0625-.039062.128906-.078125.195313-.117188.175781-.113281.351562-.238281.519531-.367187.054688-.039063.105469-.074219.15625-.113281.214844-.171875.425781-.355469.625-.554688.003906-.003906 32.042969-32.046875 32.042969-32.046875 4.296875.847657 8.710937 1.28125 13.1875 1.28125 15.503906 0 30.203125-5.203125 42.125-14.765625l74.546875 74.546875-45.234375 45.230469c-8.769531 8.773438-23.046875 8.773438-31.816407 0l-63.640624-63.636719c-2.929688-2.929687-7.675782-2.929687-10.605469 0-2.929688 2.925781-2.929688 7.675781 0 10.605469l63.640625 63.640625c7.308594 7.308594 16.910156 10.964844 26.515625 10.964844 9.601562 0 19.207031-3.65625 26.515625-10.96875l50.535156-50.535157c2.929688-2.929687 2.929688-7.675781 0-10.605468l-79.851562-79.851563c8.246093-10.300781 13.023437-22.476562 14.347656-34.953125l52.09375-52.09375 5.300781 5.300782c1.464844 1.464843 3.386719 2.199218 5.304687 2.199218 1.917969 0 3.839844-.734375 5.304688-2.199218l21.214844-21.210938c2.925781-2.925781 2.925781-7.675781-.003906-10.605469zm-58.339844-15.910156 10.609375-10.605469 10.605469 10.605469-10.605469 10.605469zm0-21.214844-10.605469 10.609375-10.605469-10.609375 10.605469-10.605469zm-31.816406-31.816406 10.605468 10.605469-10.605468 10.605468-5.289063-5.289062c-.03125-.027344-5.320313-5.316406-5.320313-5.316406zm-238.648438 68.941406 45.230469-45.230469 74.546875 74.546876c-12.714844 15.890624-17.199219 36.238281-13.449219 55.269531l-26.78125 26.78125-79.550781-79.546875c-8.769532-8.773438-8.769532-23.046875.003906-31.820313zm108.089844 161.125-15.910156 5.300781-14.65625-14.65625 5.300781-15.910156zm-70.96875 56.308594-5.292969-5.292969c-.019531-.019531-5.3125-5.3125-5.3125-5.3125l42.425781-42.425781 10.605469 10.605469zm84.855468-63.640625-31.820312-31.816406 21.449219-21.453125c3.214843 6.746093 7.597656 13.066406 13.171875 18.644531 5.507812 5.503906 11.800781 9.9375 18.621094 13.203125zm37.140626-31.578125c-8.914063-2.34375-17.0625-6.984375-23.730469-13.652344-20.46875-20.46875-20.46875-53.777343 0-74.246093 9.917969-9.914063 23.101562-15.375 37.121093-15.375 14.023438 0 27.207032 5.460937 37.125 15.375 20.46875 20.46875 20.46875 53.777343 0 74.246093-9.917968 9.917969-23.101562 15.378907-37.125 15.378907-4.582031 0-9.070312-.59375-13.390624-1.726563zm79.574218-63.921875c-2.5-12.679688-8.648437-24.777344-18.449218-34.582031-9.585938-9.582031-21.542969-15.925781-34.546876-18.488281l42.34375-42.347657 47.722657 47.722657c.015625.015624 5.3125 5.3125 5.3125 5.3125zm63.59375-42.382812-5.296875-5.296876c-.007812-.011718-5.308593-5.308593-5.308593-5.308593l10.609374-10.605469 10.605469 10.605469zm0 0"/>
                                <path fill="currentColor" d="m380.027344 131.972656c-7.082032-7.082031-16.5-10.980468-26.519532-10.980468-10.015624 0-19.433593 3.898437-26.515624 10.980468-14.621094 14.621094-14.621094 38.414063 0 53.035156 7.082031 7.082032 16.5 10.984376 26.515624 10.984376 10.019532 0 19.4375-3.902344 26.519532-10.984376 14.621094-14.621093 14.621094-38.414062 0-53.035156zm-10.609375 42.429688c-4.25 4.25-9.898438 6.589844-15.910157 6.589844-6.007812 0-11.65625-2.339844-15.90625-6.589844-8.773437-8.773438-8.773437-23.046875 0-31.820313 4.25-4.25 9.898438-6.589843 15.90625-6.589843 6.011719 0 11.660157 2.339843 15.910157 6.589843 8.773437 8.773438 8.773437 23.046875 0 31.820313zm0 0"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Large bore IV / IO access</div>
                                <div class="action-tile-sub">Consider IO if access difficult and patient in extremis</div>
                            </div>
                            <div class="action-tile-links">
                                <button class="action-tile-link" onclick="event.stopPropagation();showCannula()">Does size matter?</button>
                            </div>
                        </div>
                    </div>

                    <div class="action-tile-split">
                        <div class="action-tile" style="flex: 1;">
                            <span class="action-tile-num">2</span>
                            <div class="action-tile-icon">
                                <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor" d="m324.669 146.367c-20.595 0-39.808 6.033-55.964 16.425v-89.301h14.73c5.523 0 10-4.477 10-10v-53.491c0-5.523-4.477-10-10-10h-189.839c-5.523 0-10 4.477-10 10v53.491c0 5.523 4.477 10 10 10h14.73v359.158c0 43.754 35.973 79.351 80.189 79.351s80.189-35.597 80.189-79.351v-95.237c16.156 10.392 35.369 16.425 55.964 16.425 57.2 0 103.735-46.535 103.735-103.735s-46.534-103.735-103.734-103.735zm-196.343 4.047h120.379v22.866h-120.379zm-24.73-130.414h169.839v33.491h-169.839zm145.109 53.491v56.923h-120.379v-56.923zm0 359.158c0 32.726-27.001 59.351-60.189 59.351s-60.189-26.624-60.189-59.351v-30.422h54.346c5.523 0 10-4.477 10-10v-25.919c0-5.523-4.477-10-10-10s-10 4.477-10 10v15.919h-44.346v-139.263h44.346v32.932c0 5.523 4.477 10 10 10s10-4.477 10-10v-42.932c0-5.523-4.477-10-10-10h-54.346v-29.684h109.591c-10.734 16.332-16.983 35.861-16.983 56.823 0 27.233 10.548 52.048 27.774 70.575-.001.065-.003.13-.003.195v111.776zm75.964-98.812c-46.172 0-83.735-37.564-83.735-83.735 0-46.172 37.564-83.735 83.735-83.735 46.172 0 83.735 37.564 83.735 83.735 0 46.172-37.563 83.735-83.735 83.735z"/>
                                    <path fill="currentColor" d="m331.71 188.676c-3.854-3.656-9.895-3.661-13.755-.009-4.276 4.046-41.778 40.485-41.778 73.549 0 26.827 21.825 48.652 48.651 48.652 26.827 0 48.652-21.825 48.652-48.652 0-32.965-37.494-69.484-41.77-73.54zm-6.882 102.192c-15.798 0-28.651-12.853-28.651-28.652 0-16.908 16.995-39.19 28.644-51.947 11.655 12.784 28.659 35.094 28.659 51.947 0 15.799-12.853 28.652-28.652 28.652z"/>
                                </svg>
                            </div>
                            <div class="action-tile-content">
                                <div class="action-tile-text">
                                    <div class="action-tile-title">Bloods</div>
                                    <div class="action-tile-sub">VBG, FBE, UEC, LFTs, coags, group & hold</div>
                                </div>
                            </div>
                        </div>
                        <div class="gi-hb-side-warning" onclick="showHbCaution()">
                            <span class="warning-icon">⚠️</span>
                            <span>Normal Hb does NOT exclude significant acute bleeding</span>
                            <span class="hb-info-btn">ⓘ</span>
                        </div>
                    </div>

                    <div class="action-tile">
                        <span class="action-tile-num">3</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m416.814 89.9h-7.921v-6.942a41.56 41.56 0 0 0 -19.175-34.992v-12.446a6 6 0 0 0 -6-6h-20a6 6 0 0 0 -6 6v7a24.977 24.977 0 0 0 -9.378 3.48v-15.249c0-8.075-6.439-16-13-16h-241.554c-13.055 0-19 8.294-19 16v32.391a4.689 4.689 0 1 1 -9.378 0v-27.622a6 6 0 0 0 -6-6h-20a6 6 0 0 0 -6 6v27.622a36.689 36.689 0 1 0 73.378 0v-16.391h88.777v445.049a6 6 0 0 0 6 6h20a6 6 0 0 0 6-6v-445.049h88.777v16.391a36.543 36.543 0 0 0 9.474 24.577l.025 2.183h-8.35a56.063 56.063 0 0 0 -56 56v196.344a56.063 56.063 0 0 0 56 56h19.268v10.763a18.02 18.02 0 0 0 -11.8 17.125c0 9.956 7.729 18.055 17.228 18.055h9.515v21.611a6 6 0 0 0 6 6h19.251a6 6 0 0 0 6-6v-21.612h9.522c9.5 0 17.227-8.1 17.227-18.055a18 18 0 0 0 -12.155-17.254v-10.633h19.269a56.063 56.063 0 0 0 56-56v-196.346a56.063 56.063 0 0 0 -56-56zm-27.114-26.237a29.431 29.431 0 0 1 7.193 19.3v6.937h-9.41l.016-6.93v-.014a20.074 20.074 0 0 0 -.749-5.372 36.612 36.612 0 0 0 2.95-13.921zm-19.982 5.48v-27.623h8v21.622a24.711 24.711 0 0 1 -18.564 23.914v-4.1a8.2 8.2 0 0 1 5.969-7.872c3.877-1.084 4.596-5.942 4.596-5.942zm-12.051-14.115v10.239a20.25 20.25 0 0 0 -10.512 17.691v6.942h-9.315l-.08-6.944a29.762 29.762 0 0 1 19.907-27.928zm-35.327-20.277h-100.777a6 6 0 0 0 -6 6v445.049h-8v-445.049a6 6 0 0 0 -6-6h-100.777a6 6 0 0 0 -6 6v22.391a24.689 24.689 0 1 1 -49.378 0v-21.622h8v21.622a16.689 16.689 0 1 0 33.378 0v-32.391c0-3.711 5.357-4 7-4h240.687a5.787 5.787 0 0 1 1.867 4v24.549a41.68 41.68 0 0 0 -7.6 12.254 24.714 24.714 0 0 1 -.4-4.413v-22.39a6 6 0 0 0 -6-6zm48.612 425.049h-7.252v-15.612h7.251zm26.748-33.667c0 3.339-2.345 6.055-5.227 6.055h-50.3c-2.883 0-5.228-2.716-5.228-6.055s2.345-6.055 5.228-6.055h50.3c2.883 0 5.227 2.716 5.227 6.055zm-48.945-18.055v-9.833h36.79v9.833zm112.059-227.892h-40.352v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v2.64a44.05 44.05 0 0 1 -44 44h-99.327a44.05 44.05 0 0 1 -44-44v-196.346a44.05 44.05 0 0 1 44-44h99.326a44.05 44.05 0 0 1 44 44z"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Resuscitate</div>
                                <div class="action-tile-sub">If haemodynamically unstable, consider activating MTP</div>
                                <div class="action-tile-sub">Aim to resuscitate with blood products rather than crystalloid</div>
                            </div>
                        </div>
                    </div>

                    <div class="action-tile">
                        <span class="action-tile-num">4</span>
                        <div class="action-tile-icon">
                            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="m37.78 6.93-1.43-4.55c-.26-.83-1.01-1.38-1.88-1.38h-4.94c-.87 0-1.62.56-1.88 1.38l-1.44 4.55c-.03.1-.05.2-.05.3v.1h-13.58c-2.16 0-3.91 1.75-3.91 3.91v47.85c0 2.16 1.75 3.91 3.91 3.91h38.81c2.16 0 3.91-1.75 3.91-3.91v-47.85c0-2.16-1.75-3.91-3.91-3.91h-13.58v-.1c0-.1-.02-.2-.05-.3zm-9.61.45 1.36-4.38 4.91-.02 1.39 4.4v1.52c0 .53.42.97.95 1 4.7.24 6.71.75 7.22 1.02.01.03.02.05.03.08l.67 1.37h-25.42l.67-1.37s.02-.05.03-.08c.52-.28 2.52-.78 7.23-1.03.53-.03.95-.47.95-1v-1.53zm18.65 6.3c.08-.13.13-.28.17-.43 0-.02.02-.03.02-.05h2.43v43.91h-34.88v-43.9h2.43s.02.03.02.05c.04.15.09.3.17.43.27.43.73.69 1.24.69h27.15c.51 0 .98-.26 1.25-.7zm4.58-4.35c1.05 0 1.91.86 1.91 1.91v47.85c0 1.05-.86 1.91-1.91 1.91h-38.81c-1.05 0-1.91-.86-1.91-1.91v-47.85c0-1.05.86-1.91 1.91-1.91h6.17s-.03.02-.04.03c-.08.06-.16.12-.22.18-.01.01-.03.02-.04.04-.07.07-.13.14-.18.22-.01.02-.02.04-.03.05-.03.06-.06.12-.09.17 0 .02-.02.04-.02.06-.02.07-.04.15-.05.22l-.45.91h-4.07c-.55 0-1 .45-1 1v45.91c0 .55.45 1 1 1h36.87c.55 0 1-.45 1-1v-45.91c0-.55-.45-1-1-1h-4.08l-.45-.91c-.01-.07-.03-.15-.05-.22 0-.02-.02-.04-.02-.06-.02-.06-.05-.12-.09-.17-.01-.02-.02-.04-.03-.06-.05-.07-.11-.14-.18-.22-.01-.01-.03-.03-.05-.04-.06-.06-.14-.12-.22-.17-.02-.01-.03-.02-.04-.03h6.18z"/>
                                <path fill="currentColor" d="m26.34 27.15h2.71v2.71c0 .86.7 1.55 1.55 1.55h2.8c.86 0 1.55-.7 1.55-1.55v-2.71h2.71c.86 0 1.55-.7 1.55-1.55v-2.8c0-.86-.7-1.55-1.55-1.55h-2.71v-2.71c0-.86-.7-1.55-1.55-1.55h-2.8c-.86 0-1.55.7-1.55 1.55v2.71h-2.71c-.86 0-1.55.7-1.55 1.55v2.8c0 .86.7 1.55 1.55 1.55zm.45-3.9h3.27c.55 0 1-.45 1-1v-3.27h1.9v3.27c0 .55.45 1 1 1h3.27v1.9h-3.27c-.55 0-1 .45-1 1v3.27h-1.9v-3.27c0-.55-.45-1-1-1h-3.27z"/>
                            </svg>
                        </div>
                        <div class="action-tile-content">
                            <div class="action-tile-text">
                                <div class="action-tile-title">Optimise for haemostasis</div>
                                <div class="action-tile-sub">Consider reversing anticoagulation</div>
                                <div class="action-tile-sub">iCa >1.0 — citrate in blood products binds Ca²⁺</div>
                                <div class="action-tile-sub">pH normal — acidosis impairs clotting</div>
                                <div class="action-tile-sub">Keep patient warm — hypothermia impairs clotting</div>
                                <div class="action-tile-sub">Follow local MTP guidelines — aim for balanced transfusion</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <button class="nav-btn secondary" onclick="goHome()">‹ Back</button>
                <button class="nav-btn primary" onclick="goToPage('page-gi-assess')">Next ›</button>
            </div>
        </div>

        <!-- GI BLEEDING - Assessment (Tabs: History/Exam/DDx/Management) -->
        <div class="page" id="page-gi-assess">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-gi-bleed')">‹ Back</button>
                    <span class="header-title">GI Bleeding</span>
                </div>
                <div class="header-right">
                    <button class="home-btn" onclick="goHome()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="tabs-container">
                    <button class="tab-btn active" onclick="switchGITab('history')">History</button>
                    <button class="tab-btn" onclick="switchGITab('exam')">Exam</button>
                    <button class="tab-btn" onclick="switchGITab('ddx')">DDx</button>
                    <button class="tab-btn" onclick="switchGITab('mx')">Mx</button>
                </div>

                <!-- HISTORY TAB -->
                <div class="tab-content active" id="gi-tab-history">
                    <div class="gi-history-group">
                        <div class="gi-history-group-title">Localise the bleed</div>
                        <div class="gi-history-compact">
                            <div class="gi-history-row">
                                <span class="gi-history-q">Haematemesis / coffee grounds?</span>
                                <span class="gi-history-tag upper">Upper</span>
                            </div>
                            <div class="gi-history-row">
                                <span class="gi-history-q">Melaena?</span>
                                <span class="gi-history-tag upper">Upper</span>
                            </div>
                            <div class="gi-history-row">
                                <span class="gi-history-q">Fresh PR blood?</span>
                                <span class="gi-history-tag lower">Lower</span>
                            </div>
                        </div>
                    </div>

                    <div class="gi-history-group">
                        <div class="gi-history-group-title">Risk factors</div>
                        <div class="gi-history-compact">
                            <div class="gi-history-row">
                                <span class="gi-history-q">Liver disease / alcohol?</span>
                            </div>
                            <div class="gi-history-row">
                                <span class="gi-history-q">Anticoagulant / antiplatelet?</span>
                            </div>
                            <div class="gi-history-row">
                                <span class="gi-history-q">NSAIDs?</span>
                            </div>
                        </div>
                    </div>

                    <div class="gi-history-group">
                        <div class="gi-history-group-title">Specific clues</div>
                        <div class="gi-history-compact">
                            <div class="gi-history-row">
                                <span class="gi-history-q">Vomiting → haematemesis?</span>
                                <span class="gi-history-tag neutral">Mallory-Weiss</span>
                            </div>
                            <div class="gi-history-row">
                                <span class="gi-history-q">Weight loss / age &gt;50?</span>
                                <span class="gi-history-tag neutral">Malignancy</span>
                            </div>
                            <div class="gi-history-row">
                                <span class="gi-history-q">Epistaxis?</span>
                                <span class="gi-history-tag neutral">Swallowed blood</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- EXAM TAB -->
                <div class="tab-content" id="gi-tab-exam">
                    <div class="exam-section">
                        <div class="exam-section-title">
                            <span class="exam-section-letter">A</span>
                            Airway
                        </div>
                        <div class="exam-items">
                            <div class="exam-item">Blood in oropharynx? Able to protect airway?</div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <div class="exam-section-title">
                            <span class="exam-section-letter">B</span>
                            Breathing
                        </div>
                        <div class="exam-items">
                            <div class="exam-item">RR, SpO₂ — aspiration?</div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <div class="exam-section-title">
                            <span class="exam-section-letter">C</span>
                            Circulation
                        </div>
                        <div class="exam-items">
                            <div class="exam-item">HR, BP — signs of shock?</div>
                            <div class="exam-item">Cool peripheries = significant loss</div>
                            <div class="exam-item">Postural vital signs if safe to do so</div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <div class="exam-section-title">
                            <span class="exam-section-letter">D</span>
                            Disability
                        </div>
                        <div class="exam-items">
                            <div class="exam-item">GCS — confusion may indicate shock or encephalopathy</div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <div class="exam-section-title">
                            <span class="exam-section-letter">E</span>
                            Exposure
                        </div>
                        <div class="exam-items">
                            <div class="exam-item">Stigmata of liver disease (spider naevi, ascites, jaundice, caput medusae)</div>
                            <div class="exam-item">Abdominal tenderness, distension, peritonism</div>
                            <div class="exam-item">Surgical scars — aorto-enteric fistula, previous GI surgery</div>
                            <div class="exam-item">Bruising — coagulopathy</div>
                            <div class="exam-item">PR exam — melaena, fresh blood, haemorrhoids, mass</div>
                        </div>
                    </div>
                </div>

                <!-- DDX TAB -->
                <div class="tab-content" id="gi-tab-ddx">
                    <div class="section-title">Upper GI</div>
                    <div class="simple-list">
                        <div class="simple-list-item"><div class="simple-list-item-title">Varices</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Peptic ulcer</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Mallory-Weiss tear</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Gastritis / erosions</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Malignancy</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Dieulafoy's lesion</div></div>
                    </div>

                    <div class="section-title" style="margin-top: 16px;">Lower GI</div>
                    <div class="simple-list">
                        <div class="simple-list-item"><div class="simple-list-item-title">Diverticular</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Angiodysplasia</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Malignancy</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Colitis</div></div>
                        <div class="simple-list-item"><div class="simple-list-item-title">Haemorrhoids</div></div>
                    </div>
                </div>

                <!-- MANAGEMENT TAB -->
                <div class="tab-content" id="gi-tab-mx">
                    <!-- Upper/Lower toggle -->
                    <div class="gi-toggle-container">
                        <button class="gi-toggle-btn" id="btn-upper-gi" onclick="toggleGISection('upper')">Upper GI</button>
                        <button class="gi-toggle-btn" id="btn-lower-gi" onclick="toggleGISection('lower')">Lower GI</button>
                    </div>

                    <div class="gi-select-prompt" id="gi-select-prompt">
                        Select upper or lower GI bleed to see management
                    </div>

                    <!-- Upper GI Section -->
                    <div class="gi-toggle-section" id="section-upper-gi">
                        <div class="gi-mx-box">
                            <div class="gi-mx-item"><strong>Call Gastroenterology</strong> to arrange gastroscopy</div>
                        </div>

                        <!-- Variceal vs Non-variceal comparison -->
                        <div class="gi-comparison">
                            <div class="gi-comparison-col variceal">
                                <div class="gi-comparison-header">
                                    <span class="gi-comparison-title">Variceal</span>
                                </div>
                                <div class="gi-comparison-do">
                                    <div class="gi-comparison-label do">✓</div>
                                    <div class="gi-mx-item"><strong>Terlipressin</strong> or octreotide</div>
                                    <div class="gi-mx-item"><strong>IV antibiotics</strong> — mortality benefit</div>
                                    <div class="gi-mx-item"><strong>Avoid over-resuscitation</strong> — ↑portal pressure</div>
                                </div>
                                <div class="gi-comparison-dont">
                                    <div class="gi-comparison-label dont">✗</div>
                                    <div class="gi-mx-item"><strong>TXA</strong> — no benefit, ↑VTE <span class="info-btn" onclick="event.stopPropagation();showTXAResearch()">ⓘ</span></div>
                                    <div class="gi-mx-item"><strong>PPI</strong> — no benefit in varices</div>
                                </div>
                            </div>
                            <div class="gi-comparison-col nonvariceal">
                                <div class="gi-comparison-header">
                                    <span class="gi-comparison-title">Non-variceal</span>
                                </div>
                                <div class="gi-comparison-do">
                                    <div class="gi-comparison-label do">✓</div>
                                    <div class="gi-mx-item"><strong>High-dose IV PPI</strong></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lower GI Section -->
                    <div class="gi-toggle-section" id="section-lower-gi">
                        <div class="gi-mx-box">
                            <div class="gi-mx-item"><strong>CT angiography</strong></div>
                            <div class="gi-mx-item"><strong>Colonoscopy</strong></div>
                        </div>
                    </div>

                    <!-- Escalation -->
                    <div class="gi-mx-section" style="margin-top: 16px;">
                        <div class="gi-mx-section-title escalate">Escalate to ICU if</div>
                        <div class="gi-mx-box escalate">
                            <div class="gi-mx-item">Haemodynamic instability despite resuscitation</div>
                            <div class="gi-mx-item">Airway concerns (massive haematemesis)</div>
                            <div class="gi-mx-item">Massive transfusion required</div>
                            <div class="gi-mx-item">Vasopressor requirement</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav" id="gi-bottom-nav">
                <button class="nav-btn secondary" id="gi-back-btn" onclick="giNavBack()">‹ Actions</button>
                <button class="nav-btn primary" id="gi-next-btn" onclick="giNavNext()">Next ›</button>
            </div>
        </div>

        <!-- TOOLS & RESOURCES -->
        <div class="page" id="page-tools">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goHome()">‹ Back</button>
                    <span class="header-title">Tools & Resources</span>
                </div>
            </div>
            <div class="content">
                <div class="tools-grid">
                    <div class="tool-card" onclick="fluidResusSource='tools'; goToPage('page-fluid-resus')">
                        <div class="tool-card-icon" style="display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 500 500" style="width: 32px; height: 32px; color: var(--red);">
                                <path fill="currentColor" d="m416.814 89.9h-7.921v-6.942a41.56 41.56 0 0 0 -19.175-34.992v-12.446a6 6 0 0 0 -6-6h-20a6 6 0 0 0 -6 6v7a24.977 24.977 0 0 0 -9.378 3.48v-15.249c0-8.075-6.439-16-13-16h-241.554c-13.055 0-19 8.294-19 16v32.391a4.689 4.689 0 1 1 -9.378 0v-27.622a6 6 0 0 0 -6-6h-20a6 6 0 0 0 -6 6v27.622a36.689 36.689 0 1 0 73.378 0v-16.391h88.777v445.049a6 6 0 0 0 6 6h20a6 6 0 0 0 6-6v-445.049h88.777v16.391a36.543 36.543 0 0 0 9.474 24.577l.025 2.183h-8.35a56.063 56.063 0 0 0 -56 56v196.344a56.063 56.063 0 0 0 56 56h19.268v10.763a18.02 18.02 0 0 0 -11.8 17.125c0 9.956 7.729 18.055 17.228 18.055h9.515v21.611a6 6 0 0 0 6 6h19.251a6 6 0 0 0 6-6v-21.612h9.522c9.5 0 17.227-8.1 17.227-18.055a18 18 0 0 0 -12.155-17.254v-10.633h19.269a56.063 56.063 0 0 0 56-56v-196.346a56.063 56.063 0 0 0 -56-56zm-27.114-26.237a29.431 29.431 0 0 1 7.193 19.3v6.937h-9.41l.016-6.93v-.014a20.074 20.074 0 0 0 -.749-5.372 36.612 36.612 0 0 0 2.95-13.921zm-19.982 5.48v-27.623h8v21.622a24.711 24.711 0 0 1 -18.564 23.914v-4.1a8.2 8.2 0 0 1 5.969-7.872c3.877-1.084 4.596-5.942 4.596-5.942zm-12.051-14.115v10.239a20.25 20.25 0 0 0 -10.512 17.691v6.942h-9.315l-.08-6.944a29.762 29.762 0 0 1 19.907-27.928zm-35.327-20.277h-100.777a6 6 0 0 0 -6 6v445.049h-8v-445.049a6 6 0 0 0 -6-6h-100.777a6 6 0 0 0 -6 6v22.391a24.689 24.689 0 1 1 -49.378 0v-21.622h8v21.622a16.689 16.689 0 1 0 33.378 0v-32.391c0-3.711 5.357-4 7-4h240.687a5.787 5.787 0 0 1 1.867 4v24.549a41.68 41.68 0 0 0 -7.6 12.254 24.714 24.714 0 0 1 -.4-4.413v-22.39a6 6 0 0 0 -6-6zm48.612 425.049h-7.252v-15.612h7.251zm26.748-33.667c0 3.339-2.345 6.055-5.227 6.055h-50.3c-2.883 0-5.228-2.716-5.228-6.055s2.345-6.055 5.228-6.055h50.3c2.883 0 5.227 2.716 5.227 6.055zm-48.945-18.055v-9.833h36.79v9.833zm112.059-227.892h-40.352v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v17.484h-40.353v12h40.353v2.64a44.05 44.05 0 0 1 -44 44h-99.327a44.05 44.05 0 0 1 -44-44v-196.346a44.05 44.05 0 0 1 44-44h99.326a44.05 44.05 0 0 1 44 44z"/>
                            </svg>
                        </div>
                        <span class="tool-card-name">Fluid Resus</span>
                    </div>
                    <div class="tool-card" onclick="goToPage('page-fluid-compare')">
                        <span class="tool-card-icon">⚗️</span>
                        <span class="tool-card-name">Fluid Compare</span>
                    </div>
                    <div class="tool-card" onclick="goToPage('page-rr-counter')">
                        <span class="tool-card-icon">🫁</span>
                        <span class="tool-card-name">RR Counter</span>
                    </div>
                    <div class="tool-card" onclick="goToPage('page-fio2-calc')">
                        <span class="tool-card-icon">💨</span>
                        <span class="tool-card-name">FiO₂ Calculator</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- FLUID RESUSCITATION GUIDE -->
        <div class="page" id="page-fluid-resus">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goBackFromFluidResus()">‹ Back</button>
                    <span class="header-title">Fluid Resuscitation</span>
                </div>
            </div>
            <div class="content">
                <div class="fluid-card" style="margin-bottom: 12px;">
                    <div class="fluid-card-title">Goal</div>
                    <div class="fluid-card-body">
                        Restore perfusion without iatrogenic fluid overload.<br>
                        Treat the cause in parallel (eg: antibiotics, bleeding control).
                    </div>
                </div>

                <!-- Which fluid -->
                <div class="fluid-card" style="margin-bottom: 12px;">
                    <div class="fluid-card-header">
                        <span class="fluid-card-title">Which fluid?</span>
                        <button class="text-link-btn" onclick="showFluids()">Compare fluids ›</button>
                    </div>
                    <div class="fluid-card-body">
                        <div>Balanced crystalloid is a reasonable default <span class="info-btn" onclick="event.stopPropagation();showFluidTypeInfo()">ⓘ</span></div>
                        <div style="margin-top: 12px;">Use 0.9% saline instead for:</div>
                        <div style="margin-left: 16px; margin-top: 6px;">TBI or raised ICP <span class="info-btn" onclick="event.stopPropagation();showTBIFluidInfo()">ⓘ</span></div>
                        <div style="margin-left: 16px; margin-top: 4px;">Anuric + hyperkalaemic</div>
                    </div>
                </div>

                <!-- How much -->
                <div class="fluid-card" style="margin-bottom: 12px;">
                    <div class="fluid-card-title">How much?</div>
                    <div class="fluid-card-body">
                        <div>500 mL aliquots <span class="info-btn" onclick="event.stopPropagation();showFluidVolumeInfo()">ⓘ</span></div>
                        <div style="margin-top: 6px;">Consider 250 mL aliquots for severe HF / CKD <span class="info-btn" onclick="event.stopPropagation();showHighRiskFluidInfo()">ⓘ</span></div>
                    </div>
                </div>

                <!-- How fast -->
                <div class="fluid-card" style="margin-bottom: 12px;">
                    <div class="fluid-card-title">How fast?</div>
                    <div class="fluid-card-body">
                        <div>As fast as possible — deliver fast enough to test physiology <span class="info-btn" onclick="event.stopPropagation();showFluidRateInfo()">ⓘ</span></div>
                        <div class="fluid-hint" style="margin-top: 10px;">
                            Standard ward infusion pumps max out at 999 mL/hr → 500 mL takes ~30 min
                        </div>
                        <div class="fluid-hint" style="margin-top: 4px;">
                            For faster delivery: hand-pump a primed giving set (ensure primed to avoid air embolism)
                        </div>
                    </div>
                </div>

                <!-- Reassess -->
                <div class="fluid-card" style="margin-bottom: 12px;">
                    <div class="fluid-card-title">Reassess after each aliquot <span class="info-btn" onclick="event.stopPropagation();showReassessInfo()">ⓘ</span></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px;">
                        <div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--green); margin-bottom: 4px;">Response</div>
                            <div class="fluid-list-item">↑ BP / pulse pressure</div>
                            <div class="fluid-list-item">↓ HR</div>
                            <div class="fluid-list-item">Improved cap refill</div>
                            <div class="fluid-list-item">Warmer peripheries</div>
                            <div class="fluid-list-item">↓ Lactate</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--red); margin-bottom: 4px;">Harm</div>
                            <div class="fluid-list-item">↑ O₂ requirement</div>
                            <div class="fluid-list-item">New crackles</div>
                            <div class="fluid-list-item">Worsening WOB</div>
                        </div>
                    </div>
                </div>

                <!-- Escalation -->
                <div class="fluid-card" style="background: rgba(255, 59, 48, 0.04); border-color: rgba(255, 59, 48, 0.2);">
                    <div class="fluid-card-title" style="color: var(--red);">Call ICU / consider vasopressors if</div>
                    <div class="fluid-card-body" style="color: var(--text2);">
                        <div>No clear fluid responsiveness</div>
                        <div style="margin-top: 4px;">Profound hypotension</div>
                        <div style="margin-top: 4px;">Fluid overload / pulmonary oedema</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FLUID COMPARISON TABLE -->
        <div class="page" id="page-fluid-compare">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-tools')">‹ Back</button>
                    <span class="header-title">Fluid Comparison</span>
                </div>
            </div>
            <div class="content">
                <div style="overflow-x: auto; margin-bottom: 16px;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px; min-width: 320px;">
                        <thead>
                            <tr style="background: var(--bg2);">
                                <th style="padding: 10px 8px; text-align: left; border-bottom: 1px solid var(--border); font-weight: 600;">Fluid</th>
                                <th style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border); font-weight: 600;">Na⁺</th>
                                <th style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border); font-weight: 600;">K⁺</th>
                                <th style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border); font-weight: 600;">Cl⁻</th>
                                <th style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border); font-weight: 600;">Buffer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px 8px; border-bottom: 1px solid var(--border); font-weight: 500;">0.9% Saline</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">154</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">0</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">154</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">—</td>
                            </tr>
                            <tr style="background: var(--bg2);">
                                <td style="padding: 10px 8px; border-bottom: 1px solid var(--border); font-weight: 500;">Hartmann's</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">131</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">5</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">111</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">Lactate 29</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px 8px; border-bottom: 1px solid var(--border); font-weight: 500;">Plasma-Lyte</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">140</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">5</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">98</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">Acetate 27, Gluconate 23</td>
                            </tr>
                            <tr style="background: var(--bg2);">
                                <td style="padding: 10px 8px; border-bottom: 1px solid var(--border); font-weight: 500;">CSL</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">140</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">5</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">98</td>
                                <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border);">Acetate 27, Gluconate 23</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px 8px; font-weight: 500; color: var(--text3);">Plasma</td>
                                <td style="padding: 10px 8px; text-align: center; color: var(--text3);">135–145</td>
                                <td style="padding: 10px 8px; text-align: center; color: var(--text3);">3.5–5</td>
                                <td style="padding: 10px 8px; text-align: center; color: var(--text3);">95–105</td>
                                <td style="padding: 10px 8px; text-align: center; color: var(--text3);">HCO₃⁻ 22–26</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="font-size: 11px; color: var(--text3); line-height: 1.5;">
                    <p>All values in mmol/L. CSL = Compound Sodium Lactate (similar to Plasma-Lyte composition).</p>
                </div>
            </div>
        </div>

        <!-- RR COUNTER STANDALONE -->
        <div class="page" id="page-rr-counter">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-tools')">‹ Back</button>
                    <span class="header-title">RR Counter</span>
                </div>
            </div>
            <div class="content" style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:calc(100vh - 60px);">
                <div class="rr-counter-standalone">
                    <div class="rr-display-standalone" id="rr-display-standalone">—</div>
                    <div class="rr-label">breaths/min</div>
                    <div class="rr-status-standalone" id="rr-status-standalone">Tap for each breath</div>
                    <button class="rr-tap-btn-standalone" id="rr-tap-standalone" onclick="handleRRTapStandalone()">TAP</button>
                    <div class="rr-controls-standalone">
                        <button class="rr-ctrl-btn" onclick="calculateRRStandalone()">Calculate</button>
                        <button class="rr-ctrl-btn" onclick="resetRRStandalone()">Reset</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FIO2 CALCULATOR -->
        <div class="page" id="page-fio2-calc">
            <div class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="goToPage('page-tools')">‹ Back</button>
                    <span class="header-title">FiO₂ Calculator</span>
                </div>
            </div>
            <div class="content">
                <div class="fio2-calc">
                    <div class="fio2-section">
                        <div class="fio2-label">Select O₂ delivery device</div>
                        <div class="fio2-devices">
                            <button class="fio2-device-btn active" onclick="selectFio2Device(this, 'room-air')">Room Air</button>
                            <button class="fio2-device-btn" onclick="selectFio2Device(this, 'nasal-prongs')">Nasal Prongs</button>
                            <button class="fio2-device-btn" onclick="selectFio2Device(this, 'hudson')">Hudson Mask</button>
                        </div>
                    </div>
                    <div class="fio2-flow-section" id="fio2-flow-section" style="display:none;">
                        <div class="fio2-label">Flow rate (L/min)</div>
                        <div class="fio2-flow-input">
                            <button class="fio2-flow-btn" onclick="adjustFlow(-1)">−</button>
                            <span class="fio2-flow-value" id="fio2-flow-value">2</span>
                            <button class="fio2-flow-btn" onclick="adjustFlow(1)">+</button>
                        </div>
                    </div>
                    <div class="fio2-result-box">
                        <div class="fio2-result-label">Estimated FiO₂</div>
                        <div class="fio2-result-value" id="fio2-result">21%</div>
                    </div>
                    <div class="fio2-note">
                        <strong>Note:</strong> FiO₂ is approximate — actual delivery depends on respiratory rate, tidal volume, and mouth breathing.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modal" onclick="closeModalFully()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="modal-title"></span>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <!-- Disclaimer Modal -->
    <div class="disclaimer-overlay" id="disclaimer">
        <div class="disclaimer-modal">
            <div class="disclaimer-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
            </div>
            <div class="disclaimer-title">Before you continue</div>
            <div class="disclaimer-list">
                <div class="disclaimer-item">
                    <span class="disclaimer-item-icon">1</span>
                    <span>For use by <strong>healthcare professionals</strong> only</span>
                </div>
                <div class="disclaimer-item">
                    <span class="disclaimer-item-icon">2</span>
                    <span>Clinical decision <strong>support tool</strong> — does not replace clinical judgement</span>
                </div>
                <div class="disclaimer-item">
                    <span class="disclaimer-item-icon">3</span>
                    <span>Always follow your <strong>local policies</strong> and guidelines</span>
                </div>
                <div class="disclaimer-item">
                    <span class="disclaimer-item-icon">4</span>
                    <span>Not a substitute for <strong>senior review</strong> or specialist consultation</span>
                </div>
            </div>
            <button class="disclaimer-btn" onclick="acceptDisclaimer()">I understand</button>
        </div>
    </div>

    <script>
        // Disclaimer
        function showDisclaimer() {
            if (!sessionStorage.getItem('disclaimerAccepted')) {
                document.getElementById('disclaimer').classList.add('active');
            }
        }
        
        function acceptDisclaimer() {
            sessionStorage.setItem('disclaimerAccepted', 'true');
            document.getElementById('disclaimer').classList.remove('active');
        }
        
        // Show disclaimer on load
        window.addEventListener('DOMContentLoaded', showDisclaimer);

        // Shock order for DDx navigation (single declaration)
        let shockOrder = ['dist', 'hypo', 'card', 'obst', 'endo'];

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        const giTabOrder = ['history', 'exam', 'ddx', 'mx'];
        let currentGITab = 'history';

        function switchGITab(tabName) {
            currentGITab = tabName;
            const page = document.getElementById('page-gi-assess');

            // Update tab buttons
            const tabLabels = { history: 'History', exam: 'Exam', ddx: 'DDx', mx: 'Mx' };
            page.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === tabLabels[tabName]);
            });

            // Update tab content
            page.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('gi-tab-' + tabName).classList.add('active');

            // Update bottom nav
            updateGIBottomNav();

            // Scroll to top
            page.querySelector('.content').scrollTop = 0;
        }

        function giNavNext() {
            const idx = giTabOrder.indexOf(currentGITab);
            if (idx < giTabOrder.length - 1) {
                switchGITab(giTabOrder[idx + 1]);
            }
        }

        function giNavBack() {
            const idx = giTabOrder.indexOf(currentGITab);
            if (idx === 0) {
                goToPage('page-gi-bleed');
            } else {
                switchGITab(giTabOrder[idx - 1]);
            }
        }

        function updateGIBottomNav() {
            const idx = giTabOrder.indexOf(currentGITab);
            const backBtn = document.getElementById('gi-back-btn');
            const nextBtn = document.getElementById('gi-next-btn');

            if (backBtn) {
                backBtn.textContent = idx === 0 ? '‹ Actions' : '‹ Back';
            }
            if (nextBtn) {
                nextBtn.style.display = idx === giTabOrder.length - 1 ? 'none' : '';
            }
        }

        function toggleGISection(section) {
            // Hide the prompt when user selects
            const prompt = document.getElementById('gi-select-prompt');
            if (prompt) prompt.classList.add('hidden');

            // Update toggle buttons
            document.getElementById('btn-upper-gi').classList.toggle('active', section === 'upper');
            document.getElementById('btn-lower-gi').classList.toggle('active', section === 'lower');

            // Update sections
            document.getElementById('section-upper-gi').classList.toggle('active', section === 'upper');
            document.getElementById('section-lower-gi').classList.toggle('active', section === 'lower');
        }

        function showHbCaution() {
            showModal('Hb in acute bleeding', `
                <p style="margin-bottom:12px;"><strong>A normal Hb does not exclude significant haemorrhage.</strong></p>
                <p style="margin-bottom:12px;">Think of it like cordial: if you pour out half a glass of cordial, what's left is still the same concentration. Only when you top it up with water does it become diluted.</p>
                <p style="margin-bottom:12px;">In acute blood loss, Hb remains stable until interstitial fluid shifts into the vascular space to restore volume — this takes hours.</p>
                <p><strong>Trust clinical signs over initial Hb.</strong></p>
            `);
        }

        function showGIFluid() {
            showModal('Fluid caution in varices', `
                <p style="margin-bottom:12px;"><strong>Be cautious with fluid resuscitation if variceal bleed suspected.</strong></p>
                <p style="margin-bottom:12px;">Aggressive fluid resuscitation increases portal pressure, which can worsen variceal bleeding.</p>
                <p><strong>Prefer blood products over crystalloid.</strong></p>
            `);
        }

        // Hypovolaemic cause info modals
        function showExternalBleedInfo() {
            showModal('External Blood Loss', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Sources to check:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Surgical wounds and drains</li>
                        <li>GI — haematemesis, melaena, PR bleeding</li>
                        <li>Urological — haematuria (rarely significant volume)</li>
                        <li>Obstetric — postpartum haemorrhage</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Management principles:</strong></p>
                    <ul style="margin-left:20px;">
                        <li>Direct pressure to wounds</li>
                        <li>Quantify drain losses</li>
                        <li>Group & hold / crossmatch early</li>
                        <li>Activate massive transfusion if needed</li>
                    </ul>
                </div>
            `);
        }

        function showOccultBleedInfo() {
            showModal('Occult Blood Loss', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">When to suspect:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Recent surgery or trauma</li>
                        <li>Anticoagulation</li>
                        <li>Known AAA or aortic pathology</li>
                        <li>Ectopic pregnancy risk</li>
                        <li>Pelvic or long bone fractures</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Where to look:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li><strong>Retroperitoneal</strong> — ruptured AAA, renal, pancreatic</li>
                        <li><strong>Intra-abdominal</strong> — splenic, hepatic, mesenteric</li>
                        <li><strong>Pelvis</strong> — pelvic fractures can lose litres</li>
                        <li><strong>Thigh</strong> — femur fractures (1-2L per side)</li>
                        <li><strong>Chest</strong> — haemothorax</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Key investigations:</strong></p>
                    <ul style="margin-left:20px;">
                        <li>Serial Hb (may be initially normal)</li>
                        <li>Lactate, base excess</li>
                        <li>Bedside USS (FAST scan)</li>
                        <li>CT if stable enough</li>
                    </ul>
                </div>
            `);
        }

        function showFocalInfectiveInfo() {
            showModal('Focal Infective Symptoms & Signs', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Respiratory:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Cough — productive, haemoptysis</li>
                        <li>Pleuritic chest pain</li>
                        <li>Dyspnoea, tachypnoea</li>
                        <li>Crackles, bronchial breathing, dullness</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Urinary:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Dysuria, frequency, urgency</li>
                        <li>Suprapubic or loin pain</li>
                        <li>Cloudy/offensive urine</li>
                        <li>Renal angle tenderness</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Skin & soft tissue:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Erythema, warmth, swelling</li>
                        <li>Wound breakdown or discharge</li>
                        <li>Crepitus (necrotising fasciitis)</li>
                        <li>Pain out of proportion to signs</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Abdominal:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>RUQ pain (cholecystitis/cholangitis)</li>
                        <li>Peritonism, guarding</li>
                        <li>Absent bowel sounds</li>
                        <li>Jaundice (biliary sepsis)</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">CNS:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Headache, photophobia, neck stiffness</li>
                        <li>Altered conscious state</li>
                        <li>Focal neurological signs</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Lines & devices:</strong></p>
                    <ul style="margin-left:20px;">
                        <li>Erythema, tenderness, discharge at line sites</li>
                        <li>IDC — cloudy urine, suprapubic pain</li>
                        <li>Drains — purulent output</li>
                    </ul>
                </div>
            `);
        }

        function showGILossInfo() {
            showModal('GI Fluid Losses', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Common causes:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Vomiting — pyloric obstruction, ileus, gastroenteritis</li>
                        <li>Diarrhoea — infective, inflammatory, overflow</li>
                        <li>High NG aspirates — bowel obstruction</li>
                        <li>Stoma losses</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Assessment:</strong></p>
                    <ul style="margin-left:20px;">
                        <li>Quantify losses (NGT, stoma output)</li>
                        <li>Check electrolytes — particularly K⁺, Mg²⁺</li>
                        <li>Assess for metabolic alkalosis (vomiting) or acidosis (diarrhoea)</li>
                    </ul>
                </div>
            `);
        }

        function showRenalLossInfo() {
            showModal('Renal Fluid Losses', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Common causes:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Diuretics — especially loop diuretics</li>
                        <li>Osmotic diuresis — DKA, HHS, mannitol</li>
                        <li>Post-obstructive diuresis</li>
                        <li>Diabetes insipidus</li>
                        <li>Salt-wasting nephropathy</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Assessment:</strong></p>
                    <ul style="margin-left:20px;">
                        <li>Urine output — often inappropriately high</li>
                        <li>Urine osmolality and sodium</li>
                        <li>Serum sodium and osmolality</li>
                    </ul>
                </div>
            `);
        }

        function showThirdSpacingInfo() {
            showModal('Third Spacing', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;">Fluid shifts from intravascular space into interstitium or body cavities.</p>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Common causes:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Pancreatitis</li>
                        <li>Burns</li>
                        <li>Bowel obstruction</li>
                        <li>Major surgery</li>
                        <li>Sepsis (capillary leak)</li>
                    </ul>
                    <p><strong style="color:var(--text);">Note:</strong> May have oedema despite being intravascularly depleted.</p>
                </div>
            `);
        }

        function showPoorIntakeInfo() {
            showModal('Poor Oral Intake', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Risk factors:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Prolonged NBM status</li>
                        <li>Dysphagia</li>
                        <li>Reduced conscious state</li>
                        <li>Elderly with poor access to fluids</li>
                        <li>Nausea limiting intake</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Clinical signs:</strong></p>
                    <ul style="margin-left:20px;">
                        <li>Dry mucous membranes</li>
                        <li>Reduced skin turgor</li>
                        <li>Thirst (if alert)</li>
                        <li>Concentrated urine</li>
                    </ul>
                </div>
            `);
        }

        // RR Counter
        let rrBreaths = 0;
        let rrStartTime = null;
        let rrTimeout = null;
        let rrInterval = null;
        const RR_COUNT_DURATION = 15; // seconds

        function countBreath() {
            const btn = document.getElementById('rr-lung-btn');
            const status = document.getElementById('rr-status');
            const result = document.getElementById('rr-result');
            
            // Pulse animation
            btn.classList.remove('counting');
            void btn.offsetWidth; // Trigger reflow
            btn.classList.add('counting');
            
            // Haptic feedback if available
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
            
            if (!rrStartTime) {
                // First breath - start counting
                rrStartTime = Date.now();
                rrBreaths = 1;
                result.textContent = '...';
                
                // Update countdown every second
                rrInterval = setInterval(() => {
                    const elapsed = Math.round((Date.now() - rrStartTime) / 1000);
                    const remaining = RR_COUNT_DURATION - elapsed;
                    if (remaining > 0) {
                        status.textContent = `Counting... ${remaining}s remaining`;
                    }
                }, 1000);
                status.textContent = `Counting... ${RR_COUNT_DURATION}s remaining`;
                
                // Auto-calculate after duration
                rrTimeout = setTimeout(() => {
                    finishRRCount();
                }, RR_COUNT_DURATION * 1000);
            } else {
                rrBreaths++;
            }
        }

        function finishRRCount() {
            const status = document.getElementById('rr-status');
            const result = document.getElementById('rr-result');
            
            if (rrInterval) {
                clearInterval(rrInterval);
                rrInterval = null;
            }
            
            if (rrBreaths > 0 && rrStartTime) {
                const elapsed = (Date.now() - rrStartTime) / 1000;
                const rrPerMin = Math.round((rrBreaths / elapsed) * 60);
                result.textContent = rrPerMin;
                status.textContent = `Counted ${rrBreaths} breaths in ${Math.round(elapsed)}s`;
            }
            
            rrStartTime = null;
        }

        function resetRRCounter() {
            rrBreaths = 0;
            rrStartTime = null;
            if (rrTimeout) {
                clearTimeout(rrTimeout);
                rrTimeout = null;
            }
            if (rrInterval) {
                clearInterval(rrInterval);
                rrInterval = null;
            }
            const statusEl = document.getElementById('rr-status');
            const resultEl = document.getElementById('rr-result');
            if (statusEl) statusEl.textContent = 'Ready';
            if (resultEl) resultEl.textContent = '—';
        }

        // Shock RR Counter (separate instance)
        let shockRrBreaths = 0;
        let shockRrStartTime = null;
        let shockRrTimeout = null;
        let shockRrInterval = null;

        function countBreathShock() {
            const btn = document.getElementById('shock-rr-lung-btn');
            const status = document.getElementById('shock-rr-status');
            const result = document.getElementById('shock-rr-result');
            
            // Pulse animation
            btn.classList.remove('counting');
            void btn.offsetWidth;
            btn.classList.add('counting');
            
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
            
            if (!shockRrStartTime) {
                shockRrStartTime = Date.now();
                shockRrBreaths = 1;
                result.textContent = '...';
                
                shockRrInterval = setInterval(() => {
                    const elapsed = Math.round((Date.now() - shockRrStartTime) / 1000);
                    const remaining = RR_COUNT_DURATION - elapsed;
                    if (remaining > 0) {
                        status.textContent = `${remaining}s`;
                    }
                }, 1000);
                status.textContent = `${RR_COUNT_DURATION}s`;
                
                shockRrTimeout = setTimeout(() => {
                    finishShockRRCount();
                }, RR_COUNT_DURATION * 1000);
            } else {
                shockRrBreaths++;
            }
        }

        function finishShockRRCount() {
            const status = document.getElementById('shock-rr-status');
            const result = document.getElementById('shock-rr-result');
            
            if (shockRrInterval) {
                clearInterval(shockRrInterval);
                shockRrInterval = null;
            }
            
            if (shockRrBreaths > 0 && shockRrStartTime) {
                const elapsed = (Date.now() - shockRrStartTime) / 1000;
                const rrPerMin = Math.round((shockRrBreaths / elapsed) * 60);
                result.textContent = rrPerMin;
                status.textContent = `${shockRrBreaths} in ${Math.round(elapsed)}s`;
            }
            
            shockRrStartTime = null;
        }

        function resetRRCounterShock() {
            shockRrBreaths = 0;
            shockRrStartTime = null;
            if (shockRrTimeout) {
                clearTimeout(shockRrTimeout);
                shockRrTimeout = null;
            }
            if (shockRrInterval) {
                clearInterval(shockRrInterval);
                shockRrInterval = null;
            }
            const statusEl = document.getElementById('shock-rr-status');
            const resultEl = document.getElementById('shock-rr-result');
            if (statusEl) statusEl.textContent = 'Ready';
            if (resultEl) resultEl.textContent = '—';
        }

        let isShocked = false;
        
        function goToPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            // Update shock differential progress bars and trackers dynamically
            const shockPageKeys = {
                'page-hypo': 'hypo',
                'page-obst': 'obst',
                'page-dist': 'dist',
                'page-card': 'card',
                'page-endo': 'endo'
            };
            if (shockPageKeys[id]) {
                updateShockProgressBar(id);
                updateDDxTrackers();
            }
            
            // Reset tabs and RR counter when going to hypoxia-ddx
            if (id === 'page-hypoxia-ddx') {
                document.querySelectorAll('#page-hypoxia-ddx .tab-btn').forEach((btn, i) => {
                    btn.classList.toggle('active', i === 0);
                });
                document.querySelectorAll('#page-hypoxia-ddx .tab-content').forEach((content, i) => {
                    content.classList.toggle('active', i === 0);
                });
                resetRRCounter();
            }
        }
        
        function updateShockProgressBar(pageId) {
            const currentKey = getShockKeyFromPage(pageId);
            const currentIndex = shockOrder.indexOf(currentKey);
            const page = document.getElementById(pageId);
            const dots = page.querySelectorAll('.progress-dot');
            
            dots.forEach((dot, i) => {
                dot.classList.remove('active', 'done');
                if (i < currentIndex) {
                    dot.classList.add('done');
                } else if (i === currentIndex) {
                    dot.classList.add('active');
                }
            });
        }
        
        function startShockWalkthrough() {
            // Start from first category in current order
            const firstCategory = shockCategories[shockOrder[0]];
            goToPage(firstCategory.page);
        }

        function goHome() {
            isShocked = false;
            // Reset shock assessment
            peripheriesState = null;
            isHypoxic = null;
            shockOrder = ['dist', 'hypo', 'card', 'obst', 'endo'];
            const warmBtn = document.getElementById('btn-warm');
            const coolBtn = document.getElementById('btn-cool');
            const hypoxicBtn = document.getElementById('btn-hypoxic');
            const notHypoxicBtn = document.getElementById('btn-not-hypoxic');
            const hypoxiaQ = document.getElementById('hypoxia-question');
            const categories = document.getElementById('shock-categories');
            
            if (warmBtn) warmBtn.classList.remove('selected', 'warm');
            if (coolBtn) coolBtn.classList.remove('selected', 'cool');
            if (hypoxicBtn) hypoxicBtn.classList.remove('selected');
            if (notHypoxicBtn) notHypoxicBtn.classList.remove('selected');
            if (hypoxiaQ) hypoxiaQ.style.display = 'none';
            if (categories) categories.style.display = 'none';
            
            // Reset RR counters
            resetRRCounter();
            resetRRCounterShock();
            
            goToPage('page-home');
        }

        function goBack() {
            goToPage(isShocked ? 'page-actions' : 'page-not-shocked');
        }

        function setShocked(shocked) {
            isShocked = shocked;
            goToPage(shocked ? 'page-actions' : 'page-not-shocked');
        }

        // Hypotension assessment state
        let hypoOnset = null;
        let hypoPeripheries = null;
        let hypoRespiratory = null;

        // RR counter state for hypo exam
        let rrTaps = [];

        function tapRR() {
            const now = Date.now();
            rrTaps.push(now);

            // Update button state
            document.getElementById('rr-tap-btn')?.classList.add('counting');

            // Calculate rate if we have at least 2 taps
            if (rrTaps.length >= 2) {
                const intervals = [];
                for (let i = 1; i < rrTaps.length; i++) {
                    intervals.push(rrTaps[i] - rrTaps[i-1]);
                }
                const avgInterval = intervals.reduce((a,b) => a+b, 0) / intervals.length;
                const rate = Math.round(60000 / avgInterval);
                document.getElementById('rr-value').textContent = rate;
            }

            // Reset after 10 seconds of no taps
            clearTimeout(rrTimeout);
            rrTimeout = setTimeout(() => {
                document.getElementById('rr-tap-btn')?.classList.remove('counting');
            }, 10000);
        }

        function resetRR() {
            rrTaps = [];
            document.getElementById('rr-value').textContent = '—';
            document.getElementById('rr-tap-btn')?.classList.remove('counting');
            clearTimeout(rrTimeout);
        }

        // Hypoxia state variables
        let hypoxiaOnset = null;
        let hypoxiaHx = {};
        let hypoxiaAusc = null;
        let rrTapsHypoxia = [];
        let rrTimeoutHypoxia = null;

        function setHypoxiaOnset(value) {
            hypoxiaOnset = value;
            document.getElementById('btn-hypoxia-sudden')?.classList.toggle('active', value === 'sudden');
            document.getElementById('btn-hypoxia-gradual')?.classList.toggle('active', value === 'gradual');
            updateHypoxiaPearl();
            updateHypoxiaDDx();
        }

        function toggleHypoxiaHx(item) {
            hypoxiaHx[item] = !hypoxiaHx[item];
            document.getElementById('hx-' + item)?.classList.toggle('checked', hypoxiaHx[item]);
            updateHypoxiaPearl();
            updateHypoxiaDDx();
        }

        function updateHypoxiaPearl() {
            const pearl = document.getElementById('pe-pearl');
            if (pearl) {
                const show = hypoxiaOnset === 'sudden' && hypoxiaHx['chest-pain'];
                pearl.style.display = show ? 'flex' : 'none';
            }
        }

        function setHypoxiaAusc(value) {
            hypoxiaAusc = value;
            ['stridor', 'wheeze', 'creps', 'reduced'].forEach(s => {
                document.getElementById('ausc-' + s)?.classList.toggle('active', value === s);
            });
            updateHypoxiaDDx();
        }

        function updateHypoxiaDDx() {
            let order = ['Pneumonia', 'Pulmonary oedema', 'COPD / Asthma', 'PE', 'Pneumothorax'];

            // Auscultation is key discriminator
            if (hypoxiaAusc === 'stridor') {
                order = ['Upper airway obstruction', 'Anaphylaxis', 'Foreign body', 'Epiglottitis', 'Laryngeal oedema'];
            } else if (hypoxiaAusc === 'wheeze') {
                order = ['Asthma / COPD', 'Anaphylaxis', 'Cardiac wheeze (APO)', 'Aspiration', 'Bronchitis'];
            } else if (hypoxiaAusc === 'creps') {
                order = ['Pulmonary oedema', 'Pneumonia', 'Aspiration', 'Pulmonary fibrosis', 'ARDS'];
            } else if (hypoxiaAusc === 'reduced') {
                order = ['Pneumothorax', 'Pleural effusion', 'Collapse', 'Consolidation', 'Mucus plugging'];
            } else {
                // No auscultation yet - use history
                if (hypoxiaOnset === 'sudden') {
                    if (hypoxiaHx['chest-pain'] || hypoxiaHx['leg-swell']) {
                        order = ['PE', 'Pneumothorax', 'ACS / APO', 'Anaphylaxis', 'Aspiration'];
                    } else if (hypoxiaHx['allergy']) {
                        order = ['Anaphylaxis', 'TRALI', 'Drug reaction', 'Asthma', 'PE'];
                    } else {
                        order = ['PE', 'Pneumothorax', 'Anaphylaxis', 'Aspiration', 'Arrhythmia'];
                    }
                } else if (hypoxiaOnset === 'gradual') {
                    if (hypoxiaHx['fever']) {
                        order = ['Pneumonia', 'Sepsis', 'COPD infective exacerbation', 'Empyema', 'COVID'];
                    } else if (hypoxiaHx['orthopnoea']) {
                        order = ['Pulmonary oedema', 'Pleural effusion', 'COPD', 'Pulmonary fibrosis', 'Pneumonia'];
                    } else if (hypoxiaHx['resp-disease']) {
                        order = ['COPD exacerbation', 'Asthma', 'Pulmonary fibrosis', 'Pneumonia', 'PE'];
                    }
                }
            }

            // Update both lists
            ['diff-list-hypoxia-hx', 'diff-list-hypoxia-exam'].forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = order.map((name, i) =>
                        `<div class="diff-list-item${i < 2 ? ' top' : ''}">${name}</div>`
                    ).join('');
                }
            });
        }

        // RR counter for hypoxia page
        function tapRRHypoxia() {
            const now = Date.now();
            rrTapsHypoxia.push(now);
            rrTapsHypoxia = rrTapsHypoxia.filter(t => now - t < 30000);

            // Update button state
            document.getElementById('rr-tap-btn-hypoxia')?.classList.add('counting');

            if (rrTapsHypoxia.length >= 2) {
                const intervals = [];
                for (let i = 1; i < rrTapsHypoxia.length; i++) {
                    intervals.push(rrTapsHypoxia[i] - rrTapsHypoxia[i-1]);
                }
                const avgInterval = intervals.reduce((a,b) => a+b, 0) / intervals.length;
                const rr = Math.round(60000 / avgInterval);
                document.getElementById('rr-value-hypoxia').textContent = rr;
            }

            // Reset after 10 seconds of no taps
            clearTimeout(rrTimeoutHypoxia);
            rrTimeoutHypoxia = setTimeout(() => {
                document.getElementById('rr-tap-btn-hypoxia')?.classList.remove('counting');
            }, 10000);
        }

        function resetRRHypoxia() {
            rrTapsHypoxia = [];
            document.getElementById('rr-value-hypoxia').textContent = '—';
            document.getElementById('rr-tap-btn-hypoxia')?.classList.remove('counting');
            clearTimeout(rrTimeoutHypoxia);
        }

        function setHypoOnset(value) {
            hypoOnset = value;
            document.getElementById('btn-onset-sudden')?.classList.toggle('active', value === 'sudden');
            document.getElementById('btn-onset-progressive')?.classList.toggle('active', value === 'progressive');
            updateHypoDifferential();
        }

        function setHypoPeripheries(value) {
            hypoPeripheries = value;
            const warmBtn = document.getElementById('btn-periph-warm');
            const coolBtn = document.getElementById('btn-periph-cool');
            warmBtn?.classList.toggle('active', value === 'warm');
            coolBtn?.classList.toggle('active', value === 'cool');
            updateHypoDifferential();
        }

        function setRespDistress(isDistress) {
            hypoRespiratory = isDistress ? 'distress' : 'none';
            const yesBtn = document.getElementById('resp-distress-yes');
            const noBtn = document.getElementById('resp-distress-no');
            yesBtn?.classList.toggle('active', isDistress);
            yesBtn?.classList.toggle('warning', isDistress);
            noBtn?.classList.toggle('active', !isDistress);
            updateHypoDifferential();
        }

        // Legacy function for backwards compatibility
        function setHypoRespiratory(value) {
            setRespDistress(value === 'distress');
        }

        function updateHypoDifferential() {
            // Default order and number of top priorities (0 = no highlighting)
            let order = ['Distributive', 'Hypovolaemic', 'Cardiogenic', 'Obstructive', 'Endocrine'];
            let topCount = 0;

            // Check if any input has been provided
            const hasInput = hypoOnset || hypoPeripheries || hypoRespiratory === 'distress';

            if (!hasInput) {
                // No input yet - don't highlight anything
                topCount = 0;
            } else if (hypoPeripheries === 'warm') {
                // Warm = vasodilated = distributive (sepsis, anaphylaxis, neurogenic)
                order = ['Distributive', 'Hypovolaemic', 'Cardiogenic', 'Obstructive', 'Endocrine'];
                topCount = 1;
            } else if (hypoPeripheries === 'cool') {
                // Cool peripheries - need more info
                if (hypoRespiratory === 'distress') {
                    if (hypoOnset === 'sudden') {
                        // Cool + distress + sudden = PE, tension pneumo, massive MI
                        order = ['Obstructive', 'Cardiogenic', 'Hypovolaemic', 'Distributive', 'Endocrine'];
                        topCount = 2;
                    } else {
                        // Cool + distress + progressive = cardiogenic (CCF), late sepsis
                        order = ['Cardiogenic', 'Distributive', 'Obstructive', 'Hypovolaemic', 'Endocrine'];
                        topCount = 2;
                    }
                } else {
                    // Cool + no respiratory distress
                    if (hypoOnset === 'sudden') {
                        // Cool + no distress + sudden = haemorrhage, but also consider obstructive
                        order = ['Hypovolaemic', 'Obstructive', 'Cardiogenic', 'Distributive', 'Endocrine'];
                        topCount = 2;
                    } else {
                        // Cool + no distress + progressive = hypovolaemia (dehydration), adrenal
                        order = ['Hypovolaemic', 'Endocrine', 'Cardiogenic', 'Distributive', 'Obstructive'];
                        topCount = 1;
                    }
                }
            } else {
                // No peripheries selected yet - use onset and respiratory distress
                if (hypoRespiratory === 'distress') {
                    if (hypoOnset === 'sudden') {
                        // Distress + sudden = obstructive (PE, tension pneumo) or cardiogenic
                        order = ['Obstructive', 'Cardiogenic', 'Distributive', 'Hypovolaemic', 'Endocrine'];
                        topCount = 2;
                    } else if (hypoOnset === 'progressive') {
                        // Distress + progressive = cardiogenic (CCF) or distributive (sepsis)
                        order = ['Cardiogenic', 'Distributive', 'Obstructive', 'Hypovolaemic', 'Endocrine'];
                        topCount = 2;
                    } else {
                        // Distress only = think cardiogenic and obstructive
                        order = ['Cardiogenic', 'Obstructive', 'Distributive', 'Hypovolaemic', 'Endocrine'];
                        topCount = 2;
                    }
                } else if (hypoOnset === 'sudden') {
                    // Sudden WITHOUT other info: think obstructive and cardiogenic first
                    order = ['Obstructive', 'Cardiogenic', 'Hypovolaemic', 'Distributive', 'Endocrine'];
                    topCount = 2;
                } else if (hypoOnset === 'progressive') {
                    // Progressive WITHOUT other info: think distributive and hypovolaemic
                    order = ['Distributive', 'Hypovolaemic', 'Cardiogenic', 'Endocrine', 'Obstructive'];
                    topCount = 2;
                }
            }

            // Update DDx boxes on history and exam pages
            ['shock-ddx-box', 'shock-ddx-box-exam'].forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '<div class="ddx-label">DDX</div>' + order.map((name, i) =>
                        `<div class="ddx-item${i < topCount ? ' top' : ''}">${name}</div>`
                    ).join('');
                }
            });

            // Also update the navigation order for DDx pages
            const nameToKey = {
                'Distributive': 'dist',
                'Hypovolaemic': 'hypo',
                'Cardiogenic': 'card',
                'Obstructive': 'obst',
                'Endocrine': 'endo'
            };
            shockOrder = order.map(name => nameToKey[name]);

            // Update the DDx trackers on each page
            updateDDxTrackers();
        }

        function updateDDxTrackers() {
            const nameMap = {
                dist: 'Distributive',
                hypo: 'Hypovolaemic',
                card: 'Cardiogenic',
                obst: 'Obstructive',
                endo: 'Endocrine'
            };
            const pageMap = {
                dist: 'ddx-tracker-dist',
                hypo: 'ddx-tracker-hypo',
                card: 'ddx-tracker-card',
                obst: 'ddx-tracker-obst',
                endo: 'ddx-tracker-endo'
            };

            // For each DDx page, populate its tracker
            Object.keys(pageMap).forEach(pageKey => {
                const tracker = document.getElementById(pageMap[pageKey]);
                if (tracker) {
                    tracker.innerHTML = shockOrder.map(key => {
                        const isCurrent = key === pageKey;
                        return `<div class="ddx-tracker-item${isCurrent ? ' current' : ''}">
                            ${isCurrent ? '<span class="ddx-tracker-arrow">▶</span>' : ''}
                            ${nameMap[key]}
                        </div>`;
                    }).join('');
                }
            });
        }

        // RR Modal functions
        let rrModalTaps = [];

        function openRRModal() {
            const html = `
                <div style="display: flex; flex-direction: column; align-items: center; padding: 20px 0;">
                    <div style="font-size: 64px; font-weight: 700; color: var(--text);" id="rr-modal-value">—</div>
                    <div style="font-size: 16px; color: var(--text2); margin-bottom: 30px;">/min</div>

                    <button onclick="tapRRModal()" style="
                        width: 120px;
                        height: 120px;
                        border-radius: 60px;
                        background: var(--blue);
                        border: none;
                        color: #fff;
                        font-size: 18px;
                        font-weight: 600;
                        cursor: pointer;
                        margin-bottom: 20px;
                    ">TAP</button>

                    <div style="font-size: 13px; color: var(--text3); margin-bottom: 20px;">Tap on each inspiration</div>

                    <div style="display: flex; gap: 12px;">
                        <button onclick="resetRRModal()" style="
                            padding: 10px 20px;
                            border-radius: 8px;
                            border: 1px solid var(--border);
                            background: #fff;
                            font-size: 14px;
                            cursor: pointer;
                        ">Reset</button>
                        <button onclick="closeModal()" style="
                            padding: 10px 20px;
                            border-radius: 8px;
                            border: none;
                            background: var(--blue);
                            color: #fff;
                            font-size: 14px;
                            cursor: pointer;
                        ">Done</button>
                    </div>
                </div>
            `;
            rrModalTaps = [];
            showModal('Respiratory Rate', html);
        }

        function tapRRModal() {
            const now = Date.now();
            rrModalTaps.push(now);

            if (rrModalTaps.length >= 2) {
                const intervals = [];
                for (let i = 1; i < rrModalTaps.length; i++) {
                    intervals.push(rrModalTaps[i] - rrModalTaps[i-1]);
                }
                const avgInterval = intervals.reduce((a,b) => a+b, 0) / intervals.length;
                const rr = Math.round(60000 / avgInterval);
                document.getElementById('rr-modal-value').textContent = rr;
            }
        }

        function resetRRModal() {
            rrModalTaps = [];
            document.getElementById('rr-modal-value').textContent = '—';
        }

        // Info modal functions for killers
        function showTamponadeInfo() {
            showModal('Cardiac Tamponade', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Distended neck veins (JVP elevated)</li>
                        <li>Muffled heart sounds</li>
                        <li>Pulsus paradoxus (>10mmHg drop in SBP on inspiration)</li>
                        <li>Recent cardiac surgery, trauma, or pericarditis</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Confirm with:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Bedside echo — pericardial effusion with RV diastolic collapse</li>
                    </ul>
                </div>
            `);
        }

        function showTensionPneumoInfo() {
            showModal('Tension Pneumothorax', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Unilateral absent breath sounds</li>
                        <li>Tracheal deviation (late sign)</li>
                        <li>Hyper-resonance to percussion</li>
                        <li>Distended neck veins</li>
                        <li>Recent central line, ventilation, or trauma</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">This is a clinical diagnosis</strong> — do not delay for CXR if unstable.</p>
                </div>
            `);
        }

        function showAnaphylaxisShockInfo() {
            showModal('Anaphylaxis', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Urticaria, angioedema, flushing</li>
                        <li>Wheeze, stridor, respiratory distress</li>
                        <li>Known allergen exposure (drugs, food, contrast, blood products)</li>
                        <li>Rapid onset after exposure</li>
                    </ul>
                </div>
            `);
        }

        function showUnstableArrhythmiaInfo() {
            showModal('Unstable Arrhythmia', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Check the ECG for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>VT with pulse — wide complex, regular</li>
                        <li>SVT with hypotension — narrow complex, very fast</li>
                        <li>Complete heart block — bradycardia with AV dissociation</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Signs of instability:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Hypotension (SBP <90)</li>
                        <li>Altered conscious state</li>
                        <li>Chest pain</li>
                        <li>Signs of heart failure</li>
                    </ul>
                </div>
            `);
        }

        function showPEInfo() {
            showModal('Pulmonary Embolism', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Sudden dyspnoea, hypoxia out of proportion to CXR</li>
                        <li>DVT signs — leg swelling, calf tenderness</li>
                        <li>ECG: S1Q3T3, RBBB, TWI V1-4</li>
                        <li>Risk factors: immobility, malignancy, recent surgery</li>
                    </ul>
                </div>
            `);
        }

        function showACSInfo() {
            showModal('Abdominal Compartment Syndrome', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Tense, distended abdomen</li>
                        <li>Oliguria despite adequate fluid resuscitation</li>
                        <li>High peak airway pressures if ventilated</li>
                        <li>Bladder pressure >20 mmHg with organ dysfunction</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Risk factors:</strong> post-laparotomy, massive resuscitation, severe pancreatitis, abdominal trauma</p>
                </div>
            `);
        }

        function showLVOTInfo() {
            showModal('Dynamic LVOT Obstruction', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Consider in:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>HOCM (may be undiagnosed)</li>
                        <li>Systolic anterior motion (SAM) of mitral valve</li>
                        <li>Hypotension not responding to fluid/inotropes</li>
                        <li>New systolic murmur that increases with Valsalva</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--red);">Warning:</strong> Inotropes and vasodilators make this WORSE</p>
                </div>
            `);
        }

        function showSepsisInfo() {
            showModal('Sepsis', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for source:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Respiratory — cough, sputum, hypoxia</li>
                        <li>Urinary — dysuria, loin pain, indwelling catheter</li>
                        <li>Abdominal — pain, distension, recent surgery</li>
                        <li>Skin/soft tissue — cellulitis, wounds, lines</li>
                    </ul>
                </div>
            `);
        }

        function showNeurogenicInfo() {
            showModal('Neurogenic Shock', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Classic triad:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Hypotension</li>
                        <li>Bradycardia (loss of sympathetic tone)</li>
                        <li>Warm, dry skin (vasodilation)</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Causes:</strong> High spinal cord injury (above T6), severe head injury, spinal anaesthesia</p>
                </div>
            `);
        }

        function showLiverFailureInfo() {
            showModal('Liver Failure', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Mechanism:</strong> Cirrhosis causes profound vasodilation with splanchnic pooling and low SVR</p>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Known liver disease, ascites, jaundice</li>
                        <li>Spider naevi, palmar erythema</li>
                        <li>Hepatorenal syndrome</li>
                        <li>Often precipitated by infection (SBP)</li>
                    </ul>
                </div>
            `);
        }

        function showDrugInducedInfo() {
            showModal('Drug-Induced Hypotension', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Common causes:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Epidural/spinal anaesthesia — sympathetic block</li>
                        <li>Antihypertensives — ACEi, ARBs, CCBs, beta-blockers</li>
                        <li>Sedatives/anaesthetics — propofol, midazolam</li>
                        <li>Vasodilators — GTN, hydralazine</li>
                    </ul>
                </div>
            `);
        }

        function showValvularInfo() {
            showModal('Acute Valvular Dysfunction', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>New or changed murmur</li>
                        <li>Recent MI (papillary muscle rupture → acute MR)</li>
                        <li>Endocarditis features (fever, embolic phenomena)</li>
                        <li>Aortic dissection extending to aortic valve</li>
                    </ul>
                </div>
            `);
        }

        function showCardiomyopathyInfo() {
            showModal('Decompensated Cardiomyopathy', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Known heart failure, low EF</li>
                        <li>Pulmonary oedema, raised JVP, peripheral oedema</li>
                        <li>Medication non-compliance or recent fluid overload</li>
                        <li>New arrhythmia (often AF) as precipitant</li>
                    </ul>
                </div>
            `);
        }

        function showTakotsuboInfo() {
            showModal('Takotsubo Cardiomyopathy', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Aka:</strong> Stress cardiomyopathy, "broken heart syndrome"</p>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Classic presentation:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Chest pain, ECG changes mimicking STEMI</li>
                        <li>Apical ballooning on echo with preserved base</li>
                        <li>Mild troponin elevation (less than expected for STEMI)</li>
                    </ul>
                </div>
            `);
        }

        function showAdrenalInfo() {
            showModal('Adrenal Insufficiency', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Consider in:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Chronic steroid use — missed doses or stress without dose increase</li>
                        <li>Known Addison's disease</li>
                        <li>Recent pituitary surgery or head injury</li>
                        <li>Critically ill patients on prolonged steroids</li>
                    </ul>
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Clues:</strong> Hyperkalaemia + hyponatraemia, hypoglycaemia, eosinophilia</p>
                </div>
            `);
        }

        function showMyxoedemaInfo() {
            showModal('Myxoedema Crisis', `
                <div style="font-size:14px;color:var(--text2);line-height:1.6;">
                    <p style="margin-bottom:12px;"><strong style="color:var(--text);">Look for:</strong></p>
                    <ul style="margin-left:20px;margin-bottom:16px;">
                        <li>Hypothermia (often <35°C)</li>
                        <li>Bradycardia</li>
                        <li>Altered mental state → coma</li>
                        <li>Hyponatraemia, hypoglycaemia</li>
                        <li>Known hypothyroidism, non-compliance with thyroxine</li>
                    </ul>
                </div>
            `);
        }

        // Shock categorization based on clinical findings
        let peripheriesState = null; // 'warm' or 'cool'
        let isHypoxic = null;

        const shockCategories = {
            dist: { name: 'Distributive', page: 'page-dist' },
            hypo: { name: 'Hypovolaemic', page: 'page-hypo' },
            card: { name: 'Cardiogenic', page: 'page-card' },
            obst: { name: 'Obstructive', page: 'page-obst' },
            endo: { name: 'Endocrine', page: 'page-endo' }
        };

        function setPeripheries(state) {
            peripheriesState = state;
            
            // Update button states
            document.getElementById('btn-warm').classList.remove('selected', 'warm');
            document.getElementById('btn-cool').classList.remove('selected', 'cool');
            
            if (state === 'warm') {
                document.getElementById('btn-warm').classList.add('selected', 'warm');
                // Warm = distributive, show categories directly
                isHypoxic = null;
                document.getElementById('hypoxia-question').style.display = 'none';
                shockOrder = ['dist', 'hypo', 'card', 'obst', 'endo'];
                showShockCategories();
            } else {
                document.getElementById('btn-cool').classList.add('selected', 'cool');
                // Cool = need to ask about hypoxia
                document.getElementById('hypoxia-question').style.display = 'block';
                document.getElementById('shock-categories').style.display = 'none';
                document.getElementById('step-through-btn').style.display = 'none';
                // Reset hypoxia buttons
                document.getElementById('btn-hypoxic').classList.remove('selected');
                document.getElementById('btn-not-hypoxic').classList.remove('selected');
            }
        }

        function setHypoxic(hypoxic) {
            isHypoxic = hypoxic;
            
            // Update button states
            document.getElementById('btn-hypoxic').classList.remove('selected');
            document.getElementById('btn-not-hypoxic').classList.remove('selected');
            
            if (hypoxic) {
                document.getElementById('btn-hypoxic').classList.add('selected');
                // Cool + hypoxic = cardiogenic/obstructive first
                shockOrder = ['card', 'obst', 'hypo', 'dist', 'endo'];
            } else {
                document.getElementById('btn-not-hypoxic').classList.add('selected');
                // Cool + not hypoxic = hypovolaemic first, then endocrine
                shockOrder = ['hypo', 'endo', 'card', 'obst', 'dist'];
            }
            showShockCategories();
        }

        function showShockCategories() {
            const container = document.getElementById('category-list');
            container.innerHTML = '';
            
            shockOrder.forEach((key, index) => {
                const cat = shockCategories[key];
                // Only highlight categories that match the clinical picture
                const isHighlight = shouldHighlight(key);
                
                container.innerHTML += `
                    <div class="category-card ${isHighlight ? 'highlight' : ''}">
                        <span class="category-rank">${index + 1}</span>
                        <span class="category-name">${cat.name}</span>
                    </div>
                `;
            });
            
            document.getElementById('shock-categories').style.display = 'block';
            document.getElementById('step-through-btn').style.display = 'block';
        }

        function shouldHighlight(key) {
            if (peripheriesState === 'warm') {
                // Warm = distributive only
                return key === 'dist';
            }
            if (peripheriesState === 'cool') {
                if (isHypoxic) {
                    // Cool + hypoxic = cardiogenic, obstructive
                    return key === 'card' || key === 'obst';
                } else {
                    // Cool + not hypoxic = hypovolaemic, endocrine
                    return key === 'hypo' || key === 'endo';
                }
            }
            return false;
        }

        function stepThroughShock() {
            // Navigate to first category in the reordered list
            const firstCategory = shockCategories[shockOrder[0]];
            goToPage(firstCategory.page);
        }

        function goToFirstDDx() {
            // Navigate to first category based on current shockOrder
            const firstKey = shockOrder[0];
            goToPage(shockCategories[firstKey].page);
        }

        function getShockKeyFromPage(pageId) {
            for (const [key, cat] of Object.entries(shockCategories)) {
                if (cat.page === pageId) return key;
            }
            return null;
        }

        function goToNextShock(currentPageId) {
            const currentKey = getShockKeyFromPage(currentPageId);
            const currentIndex = shockOrder.indexOf(currentKey);
            if (currentIndex < shockOrder.length - 1) {
                const nextKey = shockOrder[currentIndex + 1];
                goToPage(shockCategories[nextKey].page);
            } else {
                // Last one - go to management page
                goToPage('page-hypo-mgmt');
            }
        }

        // Fluid resuscitation source tracking
        let fluidResusSource = 'tools';
        
        function goBackFromFluidResus() {
            if (fluidResusSource === 'shock') {
                goToPage('page-hypo-mgmt');
            } else if (fluidResusSource === 'gi') {
                goToPage('page-gi-assess');
                // Activate the management tab
                setTimeout(() => {
                    const page = document.getElementById('page-gi-assess');
                    page.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    page.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    page.querySelectorAll('.tab-btn').forEach(btn => {
                        if (btn.textContent.trim() === 'Mx') btn.classList.add('active');
                    });
                    document.getElementById('gi-tab-mx').classList.add('active');
                }, 50);
            } else {
                goToPage('page-tools');
            }
        }
        
        function goToPrevShock(currentPageId) {
            const currentKey = getShockKeyFromPage(currentPageId);
            const currentIndex = shockOrder.indexOf(currentKey);
            if (currentIndex > 0) {
                const prevKey = shockOrder[currentIndex - 1];
                goToPage(shockCategories[prevKey].page);
            } else {
                // First one - go back to exam page
                goToPage('page-hypo-exam');
            }
        }

        function getNextShockName(currentPageId) {
            const currentKey = getShockKeyFromPage(currentPageId);
            const currentIndex = shockOrder.indexOf(currentKey);
            if (currentIndex < shockOrder.length - 1) {
                const nextKey = shockOrder[currentIndex + 1];
                return shockCategories[nextKey].name;
            }
            return null;
        }

        function resetShockAssessment() {
            peripheriesState = null;
            isHypoxic = null;
            shockOrder = ['dist', 'hypo', 'card', 'obst', 'endo'];
            document.getElementById('btn-warm').classList.remove('selected', 'warm');
            document.getElementById('btn-cool').classList.remove('selected', 'cool');
            document.getElementById('btn-hypoxic').classList.remove('selected');
            document.getElementById('btn-not-hypoxic').classList.remove('selected');
            document.getElementById('hypoxia-question').style.display = 'none';
            document.getElementById('shock-categories').style.display = 'none';
            document.getElementById('step-through-btn').style.display = 'none';
        }

        // Hypoxia DDX navigation
        const hypoxiaDDxPages = ['page-hypoxia-airway', 'page-hypoxia-breathing', 'page-hypoxia-circ', 'page-hypoxia-disability', 'page-hypoxia-other'];
        const hypoxiaDDxNames = ['Airway', 'Breathing', 'Circulation', 'Disability', 'Other'];

        function goToNextHypoxiaDDx(currentPageId) {
            const currentIndex = hypoxiaDDxPages.indexOf(currentPageId);
            if (currentIndex < hypoxiaDDxPages.length - 1) {
                goToPage(hypoxiaDDxPages[currentIndex + 1]);
            } else {
                // Last one - go back to DDX overview
                goToPage('page-hypoxia-ddx');
            }
        }

        function goToPrevHypoxiaDDx(currentPageId) {
            const currentIndex = hypoxiaDDxPages.indexOf(currentPageId);
            if (currentIndex > 0) {
                goToPage(hypoxiaDDxPages[currentIndex - 1]);
            } else {
                // First one - go back to DDX overview
                goToPage('page-hypoxia-ddx');
            }
        }

        function getNextHypoxiaDDxName(currentPageId) {
            const currentIndex = hypoxiaDDxPages.indexOf(currentPageId);
            if (currentIndex < hypoxiaDDxPages.length - 1) {
                return hypoxiaDDxNames[currentIndex + 1];
            }
            return null;
        }

        let modalHistory = [];

        function showModal(title, body) {
            // Save current modal state if one is open
            const currentTitle = document.getElementById('modal-title').textContent;
            const currentBody = document.getElementById('modal-body').innerHTML;
            if (document.getElementById('modal').classList.contains('active') && currentTitle) {
                modalHistory.push({ title: currentTitle, body: currentBody });
            }
            
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = body;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            if (modalHistory.length > 0) {
                const prev = modalHistory.pop();
                document.getElementById('modal-title').textContent = prev.title;
                document.getElementById('modal-body').innerHTML = prev.body;
            } else {
                document.getElementById('modal').classList.remove('active');
            }
        }

        function closeModalFully() {
            modalHistory = [];
            document.getElementById('modal').classList.remove('active');
        }

        function showCannula() {
            showModal('Cannula Flow Rates', `
                <table class="fluid-table">
                    <tr><th>Gauge</th><th>1L bolus</th></tr>
                    <tr><td class="name">14G (orange)</td><td>~4 min</td></tr>
                    <tr><td class="name">16G (grey)</td><td>~6 min</td></tr>
                    <tr><td class="name">18G (green)</td><td>~10 min</td></tr>
                    <tr><td class="name">20G (pink)</td><td>~17 min</td></tr>
                    <tr><td class="name">22G (blue)</td><td>~30 min</td></tr>
                </table>
                <p style="font-size:11px;color:var(--text3);margin-top:12px;">Under gravity. Pressure bag speeds this up.</p>
            `);
        }

        function showFluidCaution() {
            const html = `
                <div class="caution-list">
                    <div class="caution-item">
                        <div class="caution-item-title">Cardiogenic shock with pulmonary oedema</div>
                        <div class="caution-item-sub">Fluid will worsen pulmonary congestion and hypoxia. These patients need afterload reduction ± inotropes, not volume.</div>
                    </div>
                    <div class="caution-item">
                        <div class="caution-item-title">RV failure</div>
                        <div class="caution-item-sub">Overdistension of the RV can worsen cardiac output via ventricular interdependence. Small fluid challenges with close monitoring may be appropriate.</div>
                    </div>
                    <div class="caution-item">
                        <div class="caution-item-title">Already had significant fluid resuscitation</div>
                        <div class="caution-item-sub">If patient has already received substantial volume and is not responding, further fluid is unlikely to help and may cause harm. Consider other causes and vasopressors.</div>
                    </div>
                </div>
            `;
            showModal('When to be cautious about a fluid bolus', html);
        }

        function showBPInfo() {
            const html = `
                <div class="bp-section">
                    <div class="bp-section-title">How oscillometric BP works</div>
                    <div class="bp-text">Automated machines detect oscillations in cuff pressure as it deflates. The point of <strong>maximal oscillation = MAP</strong> (most accurate). SBP and DBP are <strong>derived/calculated</strong> from this — less reliable.</div>
                </div>

                <div class="bp-section">
                    <div class="bp-section-title">When readings are unreliable</div>
                    <div class="bp-list">
                        <div class="bp-item"><strong>Arrhythmias</strong> — especially AF. Irregular R-R intervals cause variable oscillations.</div>
                        <div class="bp-item"><strong>Very low BP</strong> — weak oscillations may not be detected.</div>
                        <div class="bp-item"><strong>Movement/shivering</strong> — creates artefact.</div>
                        <div class="bp-item"><strong>Wrong cuff size</strong> — too small overestimates, too large underestimates.</div>
                        <div class="bp-item"><strong>Calcified/stiff vessels</strong> — may overestimate (pseudo-hypertension).</div>
                        <div class="bp-item"><strong>Extreme HR</strong> — very fast or slow rates affect accuracy.</div>
                    </div>
                </div>

                <div class="bp-pearl">
                    <strong>Clinical pearl:</strong> If the BP reading doesn't match the clinical picture, check it manually. A patient who "looks well" with a BP of 70 systolic may have a measurement error.
                </div>
            `;
            showModal('Automated BP Machines', html);
        }

        function showFluids() {
            showModal('Which fluid?', `
                <div style="font-size:13px;color:var(--text);margin-bottom:20px;line-height:1.5;padding:12px;background:var(--card);border-radius:8px;">
                    <strong>Balanced crystalloid is a reasonable default.</strong><br><br>Large trials show similar mortality; pooled Bayesian analyses suggest a high probability of a small benefit. Avoid in traumatic brain injury and severe hyperkalaemia.
                </div>
                <table class="fluid-table">
                    <tr><th>Fluid</th><th>Na⁺</th><th>K⁺</th><th>Cl⁻</th><th>Ca²⁺</th></tr>
                    <tr style="background:rgba(52,199,89,0.1);font-size:11px;font-style:italic;"><td class="name" style="font-weight:500;color:var(--green);">Serum (ref)</td><td>135-145</td><td>3.5-5</td><td>95-105</td><td>2.1-2.6</td></tr>
                    <tr><td class="name">0.9% NaCl</td><td>154</td><td>0</td><td class="warn">154</td><td>0</td></tr>
                    <tr><td class="name">CSL</td><td>131</td><td class="warn">5</td><td>111</td><td>2</td></tr>
                    <tr><td class="name">Albumin 5%</td><td>140</td><td>0</td><td>128</td><td>0</td></tr>
                    <tr><td class="name">Albumin 20%</td><td>48</td><td>0</td><td>—</td><td>0</td></tr>
                </table>
                <p style="font-size:12px;color:var(--text2);margin-top:12px;font-weight:500;">⚠ Albumin contraindicated in TBI</p>
            `);
        }

        function showFluidTypeInfo() {
            showModal('Balanced crystalloid vs 0.9% saline', `
                <div style="font-size:13px;color:var(--text);line-height:1.6;">
                    <p style="margin-bottom:12px;">Large pragmatic trials and meta-analyses suggest balanced crystalloids are at least as safe as saline, and may have a small renal and possibly mortality advantage in general ICU and ED populations.</p>
                    <p style="margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;"><strong>Practical take:</strong> Use balanced by default, but do not delay resuscitation if saline is what is immediately available.</p>
                    <div style="font-size:11px;color:var(--text3);line-height:1.5;">
                        <p style="margin-bottom:6px;">Self WH et al. NEJM 2018 (SALT-ED)</p>
                        <p style="margin-bottom:6px;">Semler MW et al. NEJM 2018 (SMART)</p>
                        <p style="margin-bottom:6px;">Hammond NE et al. NEJM Evidence 2022 (meta-analysis)</p>
                        <p>Finfer S et al. NEJM 2022 (PLUS)</p>
                    </div>
                </div>
            `);
        }

        function showChestDrainInfo() {
            showModal('Assessing Chest Drains', `
                <div style="font-size:13px;color:var(--text);line-height:1.7;">
                    <div style="margin-bottom:12px;"><strong>Kinked?</strong><br><span style="color:var(--text2);">Follow tubing from insertion site to bottle — unkink if needed</span></div>
                    <div style="margin-bottom:12px;"><strong>On suction?</strong><br><span style="color:var(--text2);">Check if suction is indicated — refer to team or notes</span></div>
                    <div style="margin-bottom:12px;"><strong>Swinging?</strong><br><span style="color:var(--text2);">Fluid level moves with respiration → drain is patent and in pleural space</span></div>
                    <div><strong>Bubbling?</strong><br><span style="color:var(--text2);">Continuous bubbling → ongoing air leak from lung</span></div>
                </div>
            `);
        }

        function showTBIFluidInfo() {
            showModal('TBI / raised ICP exception', `
                <div style="font-size:13px;color:var(--text);line-height:1.6;">
                    <p style="margin-bottom:12px;">Many "balanced" solutions have lower sodium than saline and can behave as effectively hypotonic once buffers are metabolised. In brain injury, that can worsen cerebral oedema.</p>
                    <p style="margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;"><strong>Practical take:</strong> The best current synthesis raises concern for worse outcomes with balanced crystalloids in traumatic brain injury compared with saline.</p>
                    <div style="font-size:11px;color:var(--text3);line-height:1.5;">
                        <p style="margin-bottom:6px;">Hammond NE et al. Crit Care Med 2023 (IPD meta-analysis)</p>
                        <p>Myburgh JA et al. NEJM 2007 (SAFE-TBI)</p>
                    </div>
                </div>
            `);
        }

        function showFluidVolumeInfo() {
            showModal('How much fluid?', `
                <div style="font-size:13px;color:var(--text);line-height:1.6;">
                    <p style="margin-bottom:12px;">No trial supports a fixed "magic volume" before escalation.</p>
                    <p style="margin-bottom:12px;">In <strong>CLOVERS</strong>, an early vasopressor, lower-fluid approach had similar survival to a liberal-fluid approach in early sepsis-induced hypotension.</p>
                    <p style="margin-bottom:16px;">In <strong>CLASSIC</strong>, restricting further IV fluids in ICU septic shock did not improve survival compared with usual care.</p>
                    <p style="margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;"><strong>Practical take:</strong> Give a bolus as a physiologic test, reassess immediately, and escalate early if non-responsive.</p>
                    <div style="font-size:11px;color:var(--text3);line-height:1.5;">
                        <p style="margin-bottom:6px;">CLOVERS Investigators. NEJM 2023</p>
                        <p style="margin-bottom:6px;">Meyhoff TS et al. NEJM 2022 (CLASSIC)</p>
                        <p>Meyhoff TS et al. Intensive Care Med 2023 (CLASSIC 1-year)</p>
                    </div>
                </div>
            `);
        }

        function showHighRiskFluidInfo() {
            showModal('High risk of fluid overload', `
                <div style="font-size:13px;color:var(--text);line-height:1.6;">
                    <p style="margin-bottom:12px;">A systematic review in sepsis patients with CHF, CKD, or cirrhosis (mostly observational data) found no consistent outcome difference between more conservative vs more liberal early fluid volumes.</p>
                    <p style="margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;"><strong>Evidence certainty is low.</strong> Use clinical judgment — smaller aliquots may be prudent in these patients.</p>
                    <div style="font-size:11px;color:var(--text3);line-height:1.5;">
                        <p style="margin-bottom:6px;">Bharwani A et al. J Crit Care 2023 (systematic review)</p>
                        <p>Acharya SP et al. Chest 2017</p>
                    </div>
                </div>
            `);
        }

        function showFluidRateInfo() {
            showModal('How fast?', `
                <div style="font-size:13px;color:var(--text);line-height:1.6;">
                    <p style="margin-bottom:12px;">In a large ICU trial (BaSICS), giving bolus fluids at a slower pump rate versus a faster pump rate did not change survival.</p>
                    <p style="margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;"><strong>Practical take:</strong> Do not slow boluses "to be safe." If you are giving a bolus for shock, deliver it fast enough to observe a response — otherwise you delay the decision to escalate.</p>
                    <div style="font-size:11px;color:var(--text3);line-height:1.5;">
                        <p>Zampieri FG et al. JAMA 2021 (BaSICS)</p>
                    </div>
                </div>
            `);
        }

        function showReassessInfo() {
            showModal('Why reassess after every aliquot?', `
                <div style="font-size:13px;color:var(--text);line-height:1.6;">
                    <p style="margin-bottom:12px;">Observational data show fluid challenges are commonly given, but response assessment is variable and additional fluid is sometimes given without clear benefit.</p>
                    <p style="margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;"><strong>Practical take:</strong> Assess response after each bolus. If no improvement, escalate rather than give more fluid.</p>
                    <div style="font-size:11px;color:var(--text3);line-height:1.5;">
                        <p style="margin-bottom:6px;">Cecconi M et al. Intensive Care Med 2015 (FENICE)</p>
                        <p style="margin-bottom:6px;">Douglas IS et al. Chest 2020 (FRESH)</p>
                        <p>Hernández G et al. JAMA 2019 (ANDROMEDA-SHOCK)</p>
                    </div>
                </div>
            `);
        }

        function showECGChoices() {
            const html = `
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button onclick="closeModal(); showRVStrainInfo()" style="
                        padding: 14px 16px;
                        background: #fff;
                        border: 1px solid var(--border);
                        border-radius: 10px;
                        font-size: 15px;
                        font-weight: 600;
                        text-align: left;
                        cursor: pointer;
                        color: var(--text);
                    ">RV strain</button>
                    <button onclick="closeModal(); showIschemiaInfo()" style="
                        padding: 14px 16px;
                        background: #fff;
                        border: 1px solid var(--border);
                        border-radius: 10px;
                        font-size: 15px;
                        font-weight: 600;
                        text-align: left;
                        cursor: pointer;
                        color: var(--text);
                    ">Ischaemia</button>
                </div>
            `;
            showModal('ECG: What to look for', html);
        }

        function showRVStrainInfo() {
            const html = `
                <div style="font-size: 13px; line-height: 1.6; color: var(--text2);">
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--text);">Classic findings (S1Q3T3)</strong>
                        <div style="margin-top: 6px;">
                            <div>• S wave in lead I</div>
                            <div>• Q wave in lead III</div>
                            <div>• T wave inversion in lead III</div>
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: var(--text3);">Present in only ~20% of PE — absence does not exclude</div>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--text);">Other RV strain patterns</strong>
                        <div style="margin-top: 6px;">
                            <div>• T wave inversions V1-V4 (anterior TWI)</div>
                            <div>• New RBBB (complete or incomplete)</div>
                            <div>• Right axis deviation</div>
                            <div>• Sinus tachycardia (most common finding)</div>
                        </div>
                    </div>
                    <div style="padding: 10px; background: rgba(255,149,0,0.1); border-radius: 8px; border: 1px solid rgba(255,149,0,0.3);">
                        <strong style="color: var(--orange); font-size: 12px;">Remember</strong>
                        <div style="margin-top: 4px; font-size: 12px;">A normal ECG does NOT exclude PE. These findings increase probability but are not sensitive.</div>
                    </div>
                </div>
            `;
            showModal('ECG: RV Strain Pattern', html);
        }

        function showIschemiaInfo() {
            const html = `
                <div class="ecg-dropdown" onclick="toggleDropdown(this)">
                    <div class="ecg-dropdown-header">
                        <span>Classic STEMI criteria</span>
                        <span class="ecg-dropdown-arrow">▼</span>
                    </div>
                    <div class="ecg-dropdown-content">
                        <div class="ecg-selector">
                            <div class="ecg-selector-title">Select patient:</div>
                            <div class="ecg-selector-btns">
                                <button class="ecg-btn active" onclick="event.stopPropagation();updateSTEMI('m-young')">Male <40</button>
                                <button class="ecg-btn" onclick="event.stopPropagation();updateSTEMI('m-old')">Male ≥40</button>
                                <button class="ecg-btn" onclick="event.stopPropagation();updateSTEMI('f')">Female</button>
                            </div>
                        </div>
                        <div class="ecg-criteria" id="stemi-criteria">
                            <div>≥2 contiguous leads with:</div>
                            <div class="ecg-item"><strong>V2-V3:</strong> ≥2.5 mm STE</div>
                            <div class="ecg-item"><strong>All other leads:</strong> ≥1 mm STE</div>
                            <div class="ecg-item"><strong>Posterior (V7-9):</strong> ≥0.5 mm STE</div>
                        </div>
                        <div class="ecg-notes">
                            <div class="ecg-note highlight">• 20% of STEMI have initially normal ECG — repeat, repeat, repeat!</div>
                        </div>
                    </div>
                </div>

                <div class="ecg-dropdown" onclick="toggleDropdown(this)">
                    <div class="ecg-dropdown-header">
                        <span>STEMI equivalents</span>
                        <span class="ecg-dropdown-arrow">▼</span>
                    </div>
                    <div class="ecg-dropdown-content">
                        <div class="ecg-equiv">
                            <div class="ecg-equiv-item">
                                <strong>Wellens</strong>
                                <span>V2/3 deep TWI or biphasic T waves</span>
                                <span class="ecg-meaning">→ Critical LAD stenosis (recent resolved chest pain)</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>De Winter</strong>
                                <span>Hyperacute T waves + upsloping STD >1mm, aVR 0.5-1mm STE</span>
                                <span class="ecg-meaning">→ Anterior STEMI equivalent</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>aVR STE + lateral STD</strong>
                                <span class="ecg-meaning">→ Global subendocardial ischaemia (left main, TVD, proximal LAD)</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>STE I, aVL, V2 + STD III</strong>
                                <span class="ecg-meaning">→ High lateral MI</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>V1-3 STD ≥0.5mm</strong>
                                <span class="ecg-meaning">→ Posterior MI — do posterior ECG</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>V1 STE ± V2 STD</strong>
                                <span class="ecg-meaning">→ Right sided MI — do right sided ECG</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ecg-dropdown" onclick="toggleDropdown(this)">
                    <div class="ecg-dropdown-header">
                        <span>Sgarbossa (LBBB / Paced)</span>
                        <span class="ecg-dropdown-arrow">▼</span>
                    </div>
                    <div class="ecg-dropdown-content">
                        <div class="ecg-note">• ≥1 lead with ≥1 mm concordant STE</div>
                        <div class="ecg-note">• ≥1 lead V1-V3 with ≥1 mm concordant STD</div>
                        <div class="ecg-note">• ≥1 lead with ≥5 mm discordant STE</div>
                    </div>
                </div>

                <div class="ecg-dropdown" onclick="toggleDropdown(this)">
                    <div class="ecg-dropdown-header">
                        <span>RV strain (PE / RV overload)</span>
                        <span class="ecg-dropdown-arrow">▼</span>
                    </div>
                    <div class="ecg-dropdown-content">
                        <div class="ecg-equiv">
                            <div class="ecg-equiv-item">
                                <strong>S1Q3T3</strong>
                                <span>S wave in I, Q wave and TWI in III</span>
                                <span class="ecg-meaning">→ Classic but not sensitive (~20%)</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>Right axis deviation</strong>
                                <span class="ecg-meaning">→ Acute RV pressure overload</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>RBBB (new)</strong>
                                <span class="ecg-meaning">→ RV strain, compare to prior ECG</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>TWI V1-V4</strong>
                                <span>Anterior T wave inversions</span>
                                <span class="ecg-meaning">→ RV strain pattern</span>
                            </div>
                            <div class="ecg-equiv-item">
                                <strong>Sinus tachycardia</strong>
                                <span class="ecg-meaning">→ Most common finding in PE</span>
                            </div>
                        </div>
                        <div class="ecg-notes" style="margin-top:12px;">
                            <div class="ecg-note highlight">• Normal ECG does NOT exclude PE</div>
                        </div>
                    </div>
                </div>
            `;
            showModal('ECG findings', html);
        }

        function toggleDropdown(el) {
            if (event.target.classList.contains('ecg-btn')) return;
            el.classList.toggle('open');
        }

        function updateSTEMI(type) {
            event.stopPropagation();
            document.querySelectorAll('.ecg-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            let criteria = '';
            if (type === 'm-young') {
                criteria = `
                    <div>≥2 contiguous leads with:</div>
                    <div class="ecg-item"><strong>V2-V3:</strong> ≥2.5 mm STE</div>
                    <div class="ecg-item"><strong>All other leads:</strong> ≥1 mm STE</div>
                    <div class="ecg-item"><strong>Posterior (V7-9):</strong> ≥0.5 mm STE</div>
                `;
            } else if (type === 'm-old') {
                criteria = `
                    <div>≥2 contiguous leads with:</div>
                    <div class="ecg-item"><strong>V2-V3:</strong> ≥2 mm STE</div>
                    <div class="ecg-item"><strong>All other leads:</strong> ≥1 mm STE</div>
                    <div class="ecg-item"><strong>Posterior (V7-9):</strong> ≥1 mm STE</div>
                `;
            } else {
                criteria = `
                    <div>≥2 contiguous leads with:</div>
                    <div class="ecg-item"><strong>V2-V3:</strong> ≥1.5 mm STE</div>
                    <div class="ecg-item"><strong>All other leads:</strong> ≥1 mm STE</div>
                    <div class="ecg-item"><strong>Posterior (V7-9):</strong> ≥0.5 mm STE</div>
                `;
            }
            document.getElementById('stemi-criteria').innerHTML = criteria;
        }

        function showAFInfo() {
            const html = `
                <div class="af-warning">
                    <strong>Think carefully before attributing shock to AF</strong>
                </div>
                
                <table class="af-table">
                    <tr>
                        <th></th>
                        <th class="af-col-bystander">AF is bystander</th>
                        <th class="af-col-cause">AF causing instability</th>
                    </tr>
                    <tr>
                        <td class="af-question">Heart rate?</td>
                        <td class="af-col-bystander">HR <150<br><span class="af-note">(diastolic filling likely adequate)</span></td>
                        <td class="af-col-cause">HR >>150</td>
                    </tr>
                    <tr>
                        <td class="af-question">AF history?</td>
                        <td class="af-col-bystander">Chronic AF</td>
                        <td class="af-col-cause">New-onset AF</td>
                    </tr>
                    <tr>
                        <td class="af-question">Timeline?</td>
                        <td class="af-col-bystander">Instability preceded AF</td>
                        <td class="af-col-cause">Deterioration after AF onset</td>
                    </tr>
                    <tr>
                        <td class="af-question">Other cause?</td>
                        <td class="af-col-bystander">Yes (sepsis, PE, pancreatitis...)</td>
                        <td class="af-col-cause">No other explanation</td>
                    </tr>
                    <tr>
                        <td class="af-question">Structural heart disease?</td>
                        <td class="af-col-bystander">No (structurally normal)</td>
                        <td class="af-col-cause">Yes:<br>• Pulmonary HTN<br>• Mitral stenosis<br>• Diastolic dysfunction<br>• Severe AS</td>
                    </tr>
                    <tr>
                        <td class="af-question">WPW?</td>
                        <td class="af-col-bystander">No</td>
                        <td class="af-col-cause">WPW is notorious for causing instability in AF</td>
                    </tr>
                </table>
            `;
            showModal('AF and Haemodynamic Instability', html);
        }

        function showHyperoxiaInfo() {
            const html = `
                <div class="hyperoxia-intro">
                    Hyperoxia (PaO₂ >100 mmHg) is associated with harm.
                </div>
                
                <div class="hyperoxia-section">
                    <div class="hyperoxia-title">Adverse effects of hyperoxia:</div>
                    <div class="hyperoxia-list">
                        <div class="hyperoxia-item">↑ Reactive oxygen species → inflammation and tissue damage</div>
                        <div class="hyperoxia-item">Damage to lung cilia</div>
                        <div class="hyperoxia-item">Reabsorption atelectasis</div>
                        <div class="hyperoxia-item">Inhibition of NO → microcirculatory vasoconstriction (including coronary)</div>
                        <div class="hyperoxia-item">Inhibition of hypoxic pulmonary vasoconstriction → worsening V/Q mismatch</div>
                    </div>
                </div>
            `;
            showModal('Why Avoid Hyperoxia?', html);
        }

        function showCO2RetainerRisk() {
            const html = `
                <div class="hyperoxia-list">
                    <div class="hyperoxia-item"><strong>Known CO₂ retainers</strong> — previous ABG with elevated PaCO₂, home NIV/CPAP for hypoventilation</div>
                    <div class="hyperoxia-item"><strong>Severe COPD</strong> — FEV₁ &lt;30% predicted, frequent exacerbations, or previous NIV</div>
                    <div class="hyperoxia-item"><strong>Obesity hypoventilation syndrome</strong> — BMI &gt;40 with daytime somnolence or known diagnosis</div>
                </div>
                <div class="cause-link" onclick="showCO2RetainerID()" style="margin-top:16px;">How to identify a possible CO₂ retainer ›</div>
                <div style="font-size:12px;color:var(--text3);margin-top:12px;font-style:italic;">
                    Ref: TSANZ Oxygen Guidelines for Acute Oxygen Use in Adults (2016)
                </div>
            `;
            showModal('Who Is at Risk of CO₂ Retention?', html);
        }

        function showCO2RetainerID() {
            const html = `
                <div class="hyperoxia-intro">
                    If the patient's history is unknown, admission bloods can help identify chronic CO₂ retention.
                </div>
                <div class="hyperoxia-section" style="margin-top:12px;">
                    <div class="hyperoxia-title">Elevated bicarbonate (HCO₃⁻ &gt;28 mmol/L)</div>
                    <div class="hyperoxia-list">
                        <div class="hyperoxia-item">Suggests metabolic compensation for chronic respiratory acidosis</div>
                        <div class="hyperoxia-item">Takes days to develop — indicates this is not a new problem</div>
                    </div>
                </div>
                <div class="hyperoxia-section" style="margin-top:12px;">
                    <div class="hyperoxia-title">⚠️ Caveats</div>
                    <div class="hyperoxia-list">
                        <div class="hyperoxia-item">Metabolic alkalosis also elevates HCO₃⁻ (vomiting, diuretics, NG losses) — check blood gas to differentiate</div>
                        <div class="hyperoxia-item">Normal HCO₃⁻ does not exclude acute-on-chronic hypercapnia</div>
                    </div>
                </div>
            `;
            showModal('Identifying Possible CO₂ Retainers', html);
        }

        function showO2MaxIndications() {
            const html = `
                <div class="hyperoxia-list">
                    <div class="hyperoxia-item">Carbon monoxide poisoning</div>
                    <div class="hyperoxia-item">Cyanide poisoning</div>
                    <div class="hyperoxia-item">Methaemoglobinaemia</div>
                    <div class="hyperoxia-item">Sickle cell crisis</div>
                    <div class="hyperoxia-item">Arterial gas embolism</div>
                    <div class="hyperoxia-item">Decompression sickness</div>
                    <div class="hyperoxia-item">Pneumothorax (accelerates reabsorption)</div>
                    <div class="hyperoxia-item">Cluster headache (high-flow O₂ is abortive therapy)</div>
                </div>
                <div style="font-size:12px;color:var(--text3);margin-top:16px;">
                    In these conditions, maximising oxygen content or delivery takes precedence over hyperoxia risks.
                </div>
            `;
            showModal('Indications for 100% SpO₂ Target', html);
        }

        function showMildHypoxiaDevices() {
            const html = `
                <div class="o2-device-section">
                    <div class="o2-device-title">Nasal prongs</div>
                    <div class="o2-device-fio2">FiO₂ ~24-44%</div>
                    <div class="o2-device-table" style="margin-top:8px;">
                        <div class="o2-device-row"><span>1 lpm</span><span>~24%</span></div>
                        <div class="o2-device-row"><span>2 lpm</span><span>~28%</span></div>
                        <div class="o2-device-row"><span>3 lpm</span><span>~32%</span></div>
                        <div class="o2-device-row"><span>4 lpm</span><span>~36%</span></div>
                        <div class="o2-device-row"><span>5-6 lpm</span><span>~40-44%</span></div>
                    </div>
                    <div style="font-size:12px;color:var(--text3);margin-top:8px;">
                        FiO₂ is approximate — depends on RR, tidal volume, and mouth breathing
                    </div>
                </div>
            `;
            showModal('Mild Hypoxia (SpO₂ 90-94%)', html);
        }

        function showModSevereHypoxiaDevices() {
            showModal('Moderate–Severe Hypoxia (SpO₂ <90%)', `
                <div class="o2-modal">
                    <div class="o2-device-card">
                        <div class="o2-device-header">
                            <span class="o2-device-name">Simple face mask</span>
                            <span class="o2-device-fio2">FiO₂ 40-60%</span>
                        </div>
                        <div class="o2-device-table">
                            <div class="o2-device-row">
                                <span class="o2-flow">5 lpm</span>
                                <span class="o2-percent">~40%</span>
                            </div>
                            <div class="o2-device-row">
                                <span class="o2-flow">6-7 lpm</span>
                                <span class="o2-percent">~50%</span>
                            </div>
                            <div class="o2-device-row">
                                <span class="o2-flow">8-10 lpm</span>
                                <span class="o2-percent">~60%</span>
                            </div>
                        </div>
                        <div class="o2-device-note">Minimum 5 lpm to prevent CO₂ rebreathing</div>
                    </div>

                    <div class="o2-device-card highlight">
                        <div class="o2-device-header">
                            <span class="o2-device-name">Non-rebreather mask</span>
                            <span class="o2-device-fio2">FiO₂ 60-80%</span>
                        </div>
                        <div class="o2-device-body">
                            Run at 15 lpm. Ensure reservoir bag stays inflated.
                        </div>
                    </div>

                    <div class="o2-device-card highlight">
                        <div class="o2-device-header">
                            <span class="o2-device-name">High-flow nasal prongs (HFNP)</span>
                            <span class="o2-device-fio2">FiO₂ 21-100%</span>
                        </div>
                        <div class="o2-device-body">
                            Heated, humidified O₂ up to 60 lpm. Provides small amount of PEEP. Washout of pharyngeal dead space.
                        </div>
                    </div>

                    <div class="o2-device-card">
                        <div class="o2-device-header">
                            <span class="o2-device-name">Bag valve mask (BVM)</span>
                            <span class="o2-device-fio2">FiO₂ ~100%</span>
                        </div>
                        <div class="o2-device-body">
                            15 lpm wall O₂ with reservoir. Can be used for assisted ventilation or as high-flow passive oxygenation.
                        </div>
                    </div>
                </div>
            `);
        }

        function showOSAAPODevices() {
            const html = `
                <div class="o2-device-section">
                    <div class="o2-device-title">CPAP</div>
                    <div class="o2-device-fio2">FiO₂ 21-100%</div>
                    <div style="font-size:13px;color:var(--text2);margin-top:8px;">
                        Continuous positive airway pressure. Recruits alveoli, reduces work of breathing, splints upper airway.
                    </div>
                    <div style="font-size:13px;color:var(--text2);margin-top:8px;">
                        <strong>Indications:</strong> OSA, acute pulmonary oedema
                    </div>
                    <div class="warning-box" style="margin-top:12px;">
                        <span class="warning-icon">⚠️</span>
                        <span>Requires senior input. Contraindicated if unable to protect airway, facial trauma, undrained pneumothorax, vomiting.</span>
                    </div>
                </div>
            `;
            showModal('OSA / Acute Pulmonary Oedema', html);
        }

        function showHypercapnicDevices() {
            const html = `
                <div class="o2-device-section" style="margin-bottom:16px;">
                    <div class="o2-device-title">Venturi mask</div>
                    <div class="o2-device-fio2">Fixed FiO₂ 24-60%</div>
                    <div style="font-size:13px;color:var(--text2);margin-top:4px;">
                        Colour-coded adaptors deliver precise FiO₂. Useful when accurate FiO₂ needed.
                    </div>
                    <div class="o2-device-table" style="margin-top:8px;">
                        <div class="o2-device-row"><span>Blue</span><span>24%</span></div>
                        <div class="o2-device-row"><span>White</span><span>28%</span></div>
                        <div class="o2-device-row"><span>Yellow</span><span>35%</span></div>
                        <div class="o2-device-row"><span>Red</span><span>40%</span></div>
                        <div class="o2-device-row"><span>Green</span><span>60%</span></div>
                    </div>
                </div>
                <div class="o2-device-section">
                    <div class="o2-device-title">BiPAP</div>
                    <div class="o2-device-fio2">FiO₂ 21-100%</div>
                    <div style="font-size:13px;color:var(--text2);margin-top:4px;">
                        Bilevel positive airway pressure. Adds inspiratory support to assist ventilation.
                    </div>
                    <div style="font-size:13px;color:var(--text2);margin-top:4px;">
                        <strong>Indications:</strong> COPD exacerbation, neuromuscular weakness
                    </div>
                    <div class="warning-box" style="margin-top:12px;">
                        <span class="warning-icon">⚠️</span>
                        <span>Requires senior input. Contraindicated if unable to protect airway, facial trauma, undrained pneumothorax, vomiting.</span>
                    </div>
                </div>
            `;
            showModal('Hypercapnic Respiratory Failure', html);
        }

        function calcPF() {
            const pao2 = parseFloat(document.getElementById('pao2').value);
            const fio2 = parseFloat(document.getElementById('fio2').value);
            const resultEl = document.getElementById('pf-result');
            
            if (!pao2 || !fio2 || fio2 === 0) {
                resultEl.textContent = '';
                resultEl.className = 'calc-result';
                return;
            }
            
            const pf = pao2 / (fio2 / 100);
            resultEl.textContent = 'P/F Ratio: ' + Math.round(pf);
            
            if (pf >= 400) {
                resultEl.className = 'calc-result normal';
            } else if (pf >= 300) {
                resultEl.className = 'calc-result impaired';
            } else if (pf >= 200) {
                resultEl.className = 'calc-result mild';
            } else if (pf >= 100) {
                resultEl.className = 'calc-result moderate';
            } else {
                resultEl.className = 'calc-result severe';
            }
        }

        function calcAA() {
            const age = parseFloat(document.getElementById('aa-age').value);
            const pao2 = parseFloat(document.getElementById('aa-pao2').value);
            const paco2 = parseFloat(document.getElementById('aa-paco2').value);
            const fio2 = parseFloat(document.getElementById('aa-fio2').value);
            const resultEl = document.getElementById('aa-result');
            
            if (!age || !pao2 || !paco2 || !fio2) {
                resultEl.textContent = '';
                resultEl.className = 'calc-result';
                return;
            }
            
            // A-a gradient calculation
            // PAO2 = (FiO2 × (Patm - PH2O)) - (PaCO2 / RQ)
            // Assuming Patm = 760, PH2O = 47, RQ = 0.8
            const pao2Alveolar = ((fio2 / 100) * (760 - 47)) - (paco2 / 0.8);
            const aaGradient = pao2Alveolar - pao2;
            const expectedAA = (age / 4) + 4;
            
            resultEl.innerHTML = 'A-a Gradient: ' + Math.round(aaGradient) + ' mmHg<br><span style="font-size:13px;font-weight:400;">Expected for age: ' + Math.round(expectedAA) + '</span>';
            
            if (aaGradient <= expectedAA + 5) {
                resultEl.className = 'calc-result normal';
            } else if (aaGradient <= expectedAA + 15) {
                resultEl.className = 'calc-result mild';
            } else {
                resultEl.className = 'calc-result severe';
            }
        }

        // Standalone RR Counter
        let rrBreathsStandalone = 0;
        let rrStartTimeStandalone = null;

        function handleRRTapStandalone() {
            const display = document.getElementById('rr-display-standalone');
            const status = document.getElementById('rr-status-standalone');
            
            if (!rrStartTimeStandalone) {
                rrStartTimeStandalone = Date.now();
                rrBreathsStandalone = 1;
                status.textContent = 'Counting... tap for each breath';
            } else {
                rrBreathsStandalone++;
            }
            
            display.textContent = rrBreathsStandalone;
            status.textContent = `${rrBreathsStandalone} breath${rrBreathsStandalone > 1 ? 's' : ''} counted`;
        }

        function calculateRRStandalone() {
            const display = document.getElementById('rr-display-standalone');
            const status = document.getElementById('rr-status-standalone');
            
            if (rrBreathsStandalone > 0 && rrStartTimeStandalone) {
                const elapsed = (Date.now() - rrStartTimeStandalone) / 1000;
                if (elapsed < 5) {
                    status.textContent = 'Count for at least 5 seconds';
                    return;
                }
                const rrPerMin = Math.round((rrBreathsStandalone / elapsed) * 60);
                display.textContent = rrPerMin;
                status.textContent = `${rrBreathsStandalone} breaths in ${Math.round(elapsed)}s`;
            }
        }

        function resetRRStandalone() {
            const display = document.getElementById('rr-display-standalone');
            const status = document.getElementById('rr-status-standalone');
            
            rrBreathsStandalone = 0;
            rrStartTimeStandalone = null;
            display.textContent = '—';
            status.textContent = 'Tap for each breath';
        }

        // FiO2 Calculator
        let currentDevice = 'room-air';
        let currentFlow = 2;

        const fio2Data = {
            'room-air': { fixed: 21 },
            'nasal-prongs': { base: 20, perLitre: 4, minFlow: 1, maxFlow: 6 },
            'hudson': { base: 10, perLitre: 5, minFlow: 5, maxFlow: 10 }
        };

        function selectFio2Device(btn, device) {
            document.querySelectorAll('.fio2-device-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentDevice = device;
            
            const flowSection = document.getElementById('fio2-flow-section');
            const data = fio2Data[device];
            
            if (data.fixed !== undefined && data.fixed !== null) {
                flowSection.style.display = 'none';
                updateFio2Result(data.fixed);
            } else if (data.perLitre) {
                flowSection.style.display = 'block';
                currentFlow = data.minFlow;
                document.getElementById('fio2-flow-value').textContent = currentFlow;
                calculateFio2();
            } else {
                flowSection.style.display = 'none';
                updateFio2Result('Variable');
            }
        }

        function adjustFlow(delta) {
            const data = fio2Data[currentDevice];
            if (!data.perLitre) return;
            
            currentFlow = Math.max(data.minFlow, Math.min(data.maxFlow, currentFlow + delta));
            document.getElementById('fio2-flow-value').textContent = currentFlow;
            calculateFio2();
        }

        function calculateFio2() {
            const data = fio2Data[currentDevice];
            if (data.perLitre) {
                const fio2 = Math.min(100, Math.round(data.base + (currentFlow * data.perLitre)));
                updateFio2Result(fio2 + '%');
            }
        }

        function updateFio2Result(value) {
            document.getElementById('fio2-result').textContent = typeof value === 'number' ? value + '%' : value;
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
    

        function showTXAResearch() {
            const html = `
                <div style="font-size:13px;line-height:1.6;color:var(--text2);">
                    <div style="margin-bottom:12px;">
                        <strong style="color:var(--text);">HALT-IT Trial (2020)</strong>
                        <div style="margin-top:6px;">Large RCT (n=12,009) found no mortality benefit and increased VTE risk with TXA in GI bleeding.</div>
                    </div>
                    <div style="margin-bottom:12px;">
                        <strong style="color:var(--text);">Bottom line</strong>
                        <div style="margin-top:6px;">TXA should not be used in GI bleeding.</div>
                    </div>
                </div>
            `;
            showModal('TXA in GI Bleeding', html);
        }

        function showPharyngealDeadspaceInfo() {
            const html = `
                <div style="font-size:13px;line-height:1.6;color:var(--text2);">
                    <div style="margin-bottom:16px;">
                        <strong style="color:var(--text);">What is pharyngeal dead space?</strong>
                        <div style="margin-top:6px;">The nasopharynx and oropharynx contain ~150 mL of gas that is re-breathed with each inspiration. This "dead space" gas has reduced O₂ and elevated CO₂ compared to fresh gas.</div>
                    </div>
                    <div style="margin-bottom:16px;">
                        <strong style="color:var(--text);">How does HFNP help?</strong>
                        <div style="margin-top:6px;">High gas flow (30–60 L/min) continuously flushes CO₂-rich gas from the pharynx and replaces it with fresh, oxygen-enriched gas. Each breath therefore starts with a higher FiO₂ and lower CO₂.</div>
                    </div>
                    <div style="padding:10px;background:rgba(0,122,255,0.08);border-radius:8px;border:1px solid rgba(0,122,255,0.2);">
                        <strong style="color:var(--blue);font-size:12px;">💡 Clinical relevance</strong>
                        <div style="margin-top:4px;font-size:12px;">This mechanism improves oxygenation efficiency and may help reduce CO₂ in hypercapnic patients, even without positive pressure.</div>
                    </div>
                </div>
            `;
            showModal('Pharyngeal Dead Space Washout', html);
        }

        function showHighFlowFiO2Info() {
            const html = `
                <div style="font-size:13px;line-height:1.6;color:var(--text2);">
                    <div style="margin-bottom:16px;">
                        <strong style="color:var(--text);">The problem with standard oxygen devices</strong>
                        <div style="margin-top:6px;">During normal inspiration, peak inspiratory flow can reach 30–60 L/min. Standard nasal prongs (2–6 L/min) or Hudson masks (10–15 L/min) deliver far less than this, so room air is entrained around the mask or through the nose/mouth to make up the difference.</div>
                    </div>
                    <div style="margin-bottom:16px;">
                        <strong style="color:var(--text);">Why room air entrainment matters</strong>
                        <div style="margin-top:6px;">Even if you set a device to deliver "100% O₂", the actual inspired FiO₂ is diluted by entrained room air (21% O₂). This is why a Hudson mask at 15 L/min only delivers ~60% FiO₂.</div>
                    </div>
                    <div style="margin-bottom:16px;">
                        <strong style="color:var(--text);">How HFNP solves this</strong>
                        <div style="margin-top:6px;">By delivering 30–60 L/min, HFNP matches or exceeds peak inspiratory flow. This minimises room air entrainment, so the set FiO₂ more closely matches the actual inspired FiO₂.</div>
                    </div>
                    <div style="padding:10px;background:rgba(0,122,255,0.08);border-radius:8px;border:1px solid rgba(0,122,255,0.2);">
                        <strong style="color:var(--blue);font-size:12px;">💡 Clinical tip</strong>
                        <div style="margin-top:4px;font-size:12px;">At 60 L/min flow with FiO₂ set to 1.0, delivered FiO₂ approaches true 100% — far more reliable than any mask system.</div>
                    </div>
                </div>
            `;
            showModal('FiO₂ Delivery & Room Air Entrainment', html);
        }

    </script>
</body>
</html>
